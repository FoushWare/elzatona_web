#!/usr/bin/env sh

echo "ğŸš€ Pre-push checks starting..."

# Get the current branch name
current_branch=$(git branch --show-current)

# Only run cleanup on development branches
if [[ "$current_branch" == "release/v1.0.0-main-website" ]] || [[ "$current_branch" == "develop" ]] || [[ "$current_branch" == "main" ]]; then
  echo "ğŸ”„ On main development branch, running pre-push cleanup..."
  
  # Quick build check
  echo "ğŸ—ï¸  Running quick build check..."
  npm run build:check
  
  if [ $? -ne 0 ]; then
    echo "âŒ Build check failed! Please fix build issues before pushing."
    exit 1
  fi
  
  # Clean up build files
  echo "ğŸ§¹ Cleaning up build files before push..."
  rm -rf .next
  rm -rf build
  rm -rf storybook-static
  rm -f tsconfig.tsbuildinfo
  
  echo "âœ… Pre-push cleanup completed!"
else
  echo "â„¹ï¸  On branch '$current_branch', skipping pre-push cleanup"
fi

echo "ğŸš€ Ready to push!"
