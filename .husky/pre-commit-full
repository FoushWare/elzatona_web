#!/usr/bin/env sh

echo "ğŸ” Running FULL pre-commit checks (including E2E tests)..."

# Run lint-staged first
echo "ğŸ“ Running lint-staged..."
npx lint-staged

# Check if lint-staged passed
if [ $? -ne 0 ]; then
  echo "âŒ Lint-staged failed. Please fix the issues before committing."
  exit 1
fi

# Run unit and integration tests
echo "ğŸ§ª Running unit and integration tests..."
npm run test:all

# Check if tests passed
if [ $? -ne 0 ]; then
  echo "âŒ Unit/Integration tests failed! Please fix the failing tests before committing."
  echo "ğŸ’¡ You can run 'npm run test:all' manually to see the specific test failures."
  exit 1
fi

# Run E2E tests (optional - can be slow)
echo "ğŸ­ Running E2E tests..."
npm run test:e2e

# Check if E2E tests passed
if [ $? -ne 0 ]; then
  echo "âŒ E2E tests failed! Please fix the failing E2E tests before committing."
  echo "ğŸ’¡ You can run 'npm run test:e2e' manually to see the specific test failures."
  exit 1
fi

# Run build check
echo "ğŸ—ï¸  Running build check..."
npm run build

# Check if build passed
if [ $? -ne 0 ]; then
  echo "âŒ Build failed! Please fix the build issues before committing."
  echo "ğŸ’¡ You can run 'npm run build' manually to see the specific errors."
  exit 1
fi

echo "âœ… All pre-commit checks passed! Tests (unit, integration, E2E), linting, and build are successful."
