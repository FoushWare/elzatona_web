#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "ğŸ” PRE-COMMIT HOOK STARTING..."
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# Step 1: Run Prettier formatting
echo "ğŸ¨ STEP 1: Running Prettier formatting..."
echo "   ğŸ“ Executing: npm run format"
echo ""

npm run format
PRETTIER_EXIT_CODE=$?

if [ $PRETTIER_EXIT_CODE -ne 0 ]; then
  echo "   âŒ Prettier formatting failed with exit code: $PRETTIER_EXIT_CODE"
  echo "   ğŸ’¡ Please fix formatting issues before committing"
  echo ""
  echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  echo "âŒ PRE-COMMIT HOOK FAILED - FORMATTING ERRORS DETECTED!"
  echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  echo ""
  exit 1
else
  echo "   âœ… Prettier formatting completed successfully!"
fi
echo ""

# Step 2: Run ESLint with auto-fix
echo "ğŸ” STEP 2: Running ESLint with auto-fix..."
echo "   ğŸ“ Executing: npm run lint:fix"
echo ""

npm run lint:fix || true  # Allow auto-fix to proceed even with warnings
LINT_FIX_EXIT_CODE=$?

if [ $LINT_FIX_EXIT_CODE -ne 0 ]; then
  echo "   âš ï¸  ESLint auto-fix completed with warnings"
else
  echo "   âœ… ESLint auto-fix completed successfully!"
fi
echo ""

# Step 3: Run ESLint check (after auto-fix)
echo "ğŸ” STEP 3: Running ESLint check (after auto-fix)..."
echo "   ğŸ“ Executing: npm run lint"
echo ""

npm run lint || true  # Allow warnings to pass
LINT_EXIT_CODE=$?

if [ $LINT_EXIT_CODE -ne 0 ]; then
  echo "   âš ï¸  ESLint found remaining issues (exit code: $LINT_EXIT_CODE)"
  echo "   ğŸ’¡ You can run 'npm run lint:fix' to auto-fix more issues"
  echo "   ğŸ“ Allowing commit to proceed (warnings only)"
else
  echo "   âœ… ESLint linting passed successfully!"
fi
echo ""

# Step 4: TypeScript type checking
echo "ğŸ“˜ STEP 4: Running TypeScript type checking..."
echo "   ğŸ“ Executing: npm run type-check"
echo ""

npm run type-check
TS_EXIT_CODE=$?

if [ $TS_EXIT_CODE -ne 0 ]; then
  echo "   âŒ TypeScript type checking failed with exit code: $TS_EXIT_CODE"
  echo "   ğŸ’¡ Please fix TypeScript errors before committing"
  echo ""
  echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  echo "âŒ PRE-COMMIT HOOK FAILED - TYPESCRIPT ERRORS DETECTED!"
  echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  echo ""
  exit 1
else
  echo "   âœ… TypeScript type checking passed successfully!"
fi
echo ""

# Step 5: Add formatted and auto-fixed files to staging
echo "ğŸ“¦ STEP 5: Adding formatted and auto-fixed files to staging..."
git add .
echo "   âœ… Formatted and auto-fixed files added to staging"
echo ""

# Step 6: Final status
echo "ğŸ“Š PRE-COMMIT SUMMARY:"
echo "   âœ… Prettier formatting completed"
echo "   âœ… ESLint auto-fix completed"
echo "   âœ… ESLint linting passed"
echo "   âœ… TypeScript type checking passed"
echo "   âœ… Files staged for commit"
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "âœ… PRE-COMMIT CHECKS COMPLETED SUCCESSFULLY!"
echo "ğŸš€ READY TO COMMIT!"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
