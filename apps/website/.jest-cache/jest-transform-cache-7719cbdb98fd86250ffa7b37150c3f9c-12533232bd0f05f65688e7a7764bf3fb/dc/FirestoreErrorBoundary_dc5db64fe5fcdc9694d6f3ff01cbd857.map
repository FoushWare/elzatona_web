{"version":3,"sources":["/Users/a.fouad/SideProjects/Elzatona-all/Elzatona-web/libs/shared-components/src/lib/common/FirestoreErrorBoundary.tsx"],"sourcesContent":["'use client';\n\nimport React, { Component, ReactNode, ErrorInfo } from 'react';\nimport { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env['NEXT_PUBLIC_SUPABASE_URL']!;\nconst supabaseServiceRoleKey = process.env['SUPABASE_SERVICE_ROLE_KEY']!;\nconst supabase = createClient(supabaseUrl, supabaseServiceRoleKey);\n\ninterface Props {\n  children: ReactNode;\n  fallback?: ReactNode;\n}\n\ninterface State {\n  hasError: boolean;\n  error?: Error;\n}\n\nclass FirestoreErrorBoundary extends Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = { hasError: false };\n  }\n\n  static getDerivedStateFromError(error: Error): State {\n    // Check if it's a Firestore internal assertion error\n    const isFirestoreError =\n      error.message &&\n      (error.message.includes('FIRESTORE') ||\n        error.message.includes('INTERNAL ASSERTION FAILED') ||\n        error.message.includes('Unexpected state') ||\n        error.message.includes('ID: b815') ||\n        error.message.includes('ID: ca9'));\n\n    if (isFirestoreError) {\n      // Suppress Firestore internal errors\n      console.warn(\n        '⚠️ Suppressed Firestore internal error in ErrorBoundary:',\n        error\n      );\n      return { hasError: false };\n    }\n\n    // For other errors, show the error boundary\n    return { hasError: true, error };\n  }\n\n  override componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n    // Check if it's a Firestore internal assertion error\n    const isFirestoreError =\n      error.message &&\n      (error.message.includes('FIRESTORE') ||\n        error.message.includes('INTERNAL ASSERTION FAILED') ||\n        error.message.includes('Unexpected state') ||\n        error.message.includes('ID: b815') ||\n        error.message.includes('ID: ca9'));\n\n    if (isFirestoreError) {\n      // Suppress Firestore internal errors\n      console.warn(\n        '⚠️ Suppressed Firestore internal error in componentDidCatch:',\n        error\n      );\n      return;\n    }\n\n    // Log other errors\n    console.error('ErrorBoundary caught an error:', error, errorInfo);\n  }\n\n  override render() {\n    if (this.state.hasError) {\n      return (\n        this.props.fallback || (\n          <div className='p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg'>\n            <h2 className='text-lg font-semibold text-red-800 dark:text-red-200 mb-2'>\n              Something went wrong\n            </h2>\n            <p className='text-red-600 dark:text-red-300'>\n              {this.state.error?.message || 'An unexpected error occurred'}\n            </p>\n            <button\n              onClick={() =>\n                this.setState({ hasError: false, error: undefined })\n              }\n              className='mt-2 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700'\n            >\n              Try again\n            </button>\n          </div>\n        )\n      );\n    }\n\n    return this.props.children;\n  }\n}\n\nexport default FirestoreErrorBoundary;\n"],"names":["supabaseUrl","process","env","supabaseServiceRoleKey","supabase","createClient","FirestoreErrorBoundary","Component","props","state","hasError","getDerivedStateFromError","error","isFirestoreError","message","includes","console","warn","componentDidCatch","errorInfo","render","fallback","div","className","h2","p","button","onClick","setState","undefined","children"],"mappings":"AAAA;;;;;+BAmGA;;;eAAA;;;;+DAjGuD;4BAC1B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAE7B,MAAMA,cAAcC,QAAQC,GAAG,CAAC,2BAA2B;AAC3D,MAAMC,yBAAyBF,QAAQC,GAAG,CAAC,4BAA4B;AACvE,MAAME,WAAWC,IAAAA,wBAAY,EAACL,aAAaG;AAY3C,MAAMG,+BAA+BC,gBAAS;IAC5C,YAAYC,KAAY,CAAE;QACxB,KAAK,CAACA;QACN,IAAI,CAACC,KAAK,GAAG;YAAEC,UAAU;QAAM;IACjC;IAEA,OAAOC,yBAAyBC,KAAY,EAAS;QACnD,qDAAqD;QACrD,MAAMC,mBACJD,MAAME,OAAO,IACZF,CAAAA,MAAME,OAAO,CAACC,QAAQ,CAAC,gBACtBH,MAAME,OAAO,CAACC,QAAQ,CAAC,gCACvBH,MAAME,OAAO,CAACC,QAAQ,CAAC,uBACvBH,MAAME,OAAO,CAACC,QAAQ,CAAC,eACvBH,MAAME,OAAO,CAACC,QAAQ,CAAC,UAAS;QAEpC,IAAIF,kBAAkB;YACpB,qCAAqC;YACrCG,QAAQC,IAAI,CACV,4DACAL;YAEF,OAAO;gBAAEF,UAAU;YAAM;QAC3B;QAEA,4CAA4C;QAC5C,OAAO;YAAEA,UAAU;YAAME;QAAM;IACjC;IAESM,kBAAkBN,KAAY,EAAEO,SAAoB,EAAE;QAC7D,qDAAqD;QACrD,MAAMN,mBACJD,MAAME,OAAO,IACZF,CAAAA,MAAME,OAAO,CAACC,QAAQ,CAAC,gBACtBH,MAAME,OAAO,CAACC,QAAQ,CAAC,gCACvBH,MAAME,OAAO,CAACC,QAAQ,CAAC,uBACvBH,MAAME,OAAO,CAACC,QAAQ,CAAC,eACvBH,MAAME,OAAO,CAACC,QAAQ,CAAC,UAAS;QAEpC,IAAIF,kBAAkB;YACpB,qCAAqC;YACrCG,QAAQC,IAAI,CACV,gEACAL;YAEF;QACF;QAEA,mBAAmB;QACnBI,QAAQJ,KAAK,CAAC,kCAAkCA,OAAOO;IACzD;IAESC,SAAS;QAChB,IAAI,IAAI,CAACX,KAAK,CAACC,QAAQ,EAAE;YACvB,OACE,IAAI,CAACF,KAAK,CAACa,QAAQ,kBACjB,sBAACC;gBAAIC,WAAU;;kCACb,qBAACC;wBAAGD,WAAU;kCAA4D;;kCAG1E,qBAACE;wBAAEF,WAAU;kCACV,IAAI,CAACd,KAAK,CAACG,KAAK,EAAEE,WAAW;;kCAEhC,qBAACY;wBACCC,SAAS,IACP,IAAI,CAACC,QAAQ,CAAC;gCAAElB,UAAU;gCAAOE,OAAOiB;4BAAU;wBAEpDN,WAAU;kCACX;;;;QAMT;QAEA,OAAO,IAAI,CAACf,KAAK,CAACsB,QAAQ;IAC5B;AACF;MAEA,WAAexB"}