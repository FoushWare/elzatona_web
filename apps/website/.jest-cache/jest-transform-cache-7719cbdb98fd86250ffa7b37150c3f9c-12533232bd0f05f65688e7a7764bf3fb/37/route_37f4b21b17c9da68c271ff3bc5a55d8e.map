{"version":3,"sources":["/Users/a.fouad/SideProjects/Elzatona-all/Elzatona-web/apps/website/src/app/api/admin/frontend-tasks/route.ts"],"sourcesContent":["// v1.0 - API routes for frontend tasks CRUD operations\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport {\n  FrontendTask,\n  FrontendTaskFormData,\n  ApiResponse,\n  PaginatedResponse,\n} from '@/types/admin';\nimport { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;\nconst supabase = createClient(supabaseUrl, supabaseServiceRoleKey);\n\n// GET /api/admin/frontend-tasks - List all frontend tasks\nexport async function GET(request: NextRequest) {\n  try {\n    console.log('üîÑ API: Fetching frontend tasks...');\n\n    const { searchParams } = new URL(request.url);\n    const page = parseInt(searchParams.get('page') || '1');\n    const limit = parseInt(searchParams.get('limit') || '10');\n    const search = searchParams.get('search') || '';\n    const category = searchParams.get('category') || '';\n    const difficulty = searchParams.get('difficulty') || '';\n\n    // Fetch tasks from Supabase\n    let query = supabase.from('frontendTasks').select('*');\n\n    // Apply filters\n    if (category) {\n      query = query.eq('category', category);\n    }\n    if (difficulty) {\n      query = query.eq('difficulty', difficulty);\n    }\n\n    // Apply ordering\n    query = query.order('createdAt', { ascending: false });\n\n    const { data: tasks, error } = await query;\n\n    if (error) {\n      throw error;\n    }\n\n    let data: FrontendTask[] = tasks || [];\n\n    // Apply search filter (client-side since Supabase doesn't support full-text search)\n    if (search) {\n      const lowerSearch = search.toLowerCase();\n      data = data.filter(\n        task =>\n          task.title.toLowerCase().includes(lowerSearch) ||\n          task.description.toLowerCase().includes(lowerSearch) ||\n          task.category.toLowerCase().includes(lowerSearch) ||\n          task.tags.some(tag => tag.toLowerCase().includes(lowerSearch))\n      );\n    }\n\n    // Client-side pagination\n    const startIndex = (page - 1) * limit;\n    const endIndex = startIndex + limit;\n    const paginatedData = data.slice(startIndex, endIndex);\n\n    console.log(\n      `üìä API: Frontend tasks fetched: ${data.length} total, ${paginatedData.length} returned`\n    );\n\n    const response: PaginatedResponse<FrontendTask> = {\n      success: true,\n      data: paginatedData,\n      total: data.length,\n      page,\n      limit,\n      hasMore: endIndex < data.length,\n    };\n\n    return NextResponse.json(response);\n  } catch (error) {\n    console.error('‚ùå API: Error fetching frontend tasks:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to fetch frontend tasks' },\n      { status: 500 }\n    );\n  }\n}\n\n// POST /api/admin/frontend-tasks - Create new frontend task\nexport async function POST(request: NextRequest) {\n  try {\n    console.log('üîÑ API: Creating new frontend task...');\n\n    const body: FrontendTaskFormData = await request.json();\n\n    // Validate required fields\n    if (!body.title || !body.description || !body.category) {\n      return NextResponse.json(\n        { success: false, error: 'Missing required fields' },\n        { status: 400 }\n      );\n    }\n\n    // Create the task data\n    const taskData = {\n      ...body,\n      is_active: true,\n      created_at: new Date().toISOString(),\n      updated_at: new Date().toISOString(),\n    };\n\n    // Add to Supabase\n    const { data: newTask, error } = await supabase\n      .from('frontendTasks')\n      .insert(taskData)\n      .select()\n      .single();\n\n    if (error) {\n      throw error;\n    }\n\n    console.log(`‚úÖ API: Frontend task created with ID: ${newTask.id}`);\n\n    const response: ApiResponse<{ id: string }> = {\n      success: true,\n      data: { id: newTask.id },\n    };\n\n    return NextResponse.json(response, { status: 201 });\n  } catch (error) {\n    console.error('‚ùå API: Error creating frontend task:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to create frontend task' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":["GET","POST","supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","supabaseServiceRoleKey","SUPABASE_SERVICE_ROLE_KEY","supabase","createClient","request","console","log","searchParams","URL","url","page","parseInt","get","limit","search","category","difficulty","query","from","select","eq","order","ascending","data","tasks","error","lowerSearch","toLowerCase","filter","task","title","includes","description","tags","some","tag","startIndex","endIndex","paginatedData","slice","length","response","success","total","hasMore","NextResponse","json","status","body","taskData","is_active","created_at","Date","toISOString","updated_at","newTask","insert","single","id"],"mappings":"AAAA,uDAAuD;;;;;;;;;;;;QAgBjCA;eAAAA;;QA0EAC;eAAAA;;;wBAxFoB;4BAOb;AAE7B,MAAMC,cAAcC,QAAQC,GAAG,CAACC,wBAAwB;AACxD,MAAMC,yBAAyBH,QAAQC,GAAG,CAACG,yBAAyB;AACpE,MAAMC,WAAWC,IAAAA,wBAAY,EAACP,aAAaI;AAGpC,eAAeN,IAAIU,OAAoB;IAC5C,IAAI;QACFC,QAAQC,GAAG,CAAC;QAEZ,MAAM,EAAEC,YAAY,EAAE,GAAG,IAAIC,IAAIJ,QAAQK,GAAG;QAC5C,MAAMC,OAAOC,SAASJ,aAAaK,GAAG,CAAC,WAAW;QAClD,MAAMC,QAAQF,SAASJ,aAAaK,GAAG,CAAC,YAAY;QACpD,MAAME,SAASP,aAAaK,GAAG,CAAC,aAAa;QAC7C,MAAMG,WAAWR,aAAaK,GAAG,CAAC,eAAe;QACjD,MAAMI,aAAaT,aAAaK,GAAG,CAAC,iBAAiB;QAErD,4BAA4B;QAC5B,IAAIK,QAAQf,SAASgB,IAAI,CAAC,iBAAiBC,MAAM,CAAC;QAElD,gBAAgB;QAChB,IAAIJ,UAAU;YACZE,QAAQA,MAAMG,EAAE,CAAC,YAAYL;QAC/B;QACA,IAAIC,YAAY;YACdC,QAAQA,MAAMG,EAAE,CAAC,cAAcJ;QACjC;QAEA,iBAAiB;QACjBC,QAAQA,MAAMI,KAAK,CAAC,aAAa;YAAEC,WAAW;QAAM;QAEpD,MAAM,EAAEC,MAAMC,KAAK,EAAEC,KAAK,EAAE,GAAG,MAAMR;QAErC,IAAIQ,OAAO;YACT,MAAMA;QACR;QAEA,IAAIF,OAAuBC,SAAS,EAAE;QAEtC,oFAAoF;QACpF,IAAIV,QAAQ;YACV,MAAMY,cAAcZ,OAAOa,WAAW;YACtCJ,OAAOA,KAAKK,MAAM,CAChBC,CAAAA,OACEA,KAAKC,KAAK,CAACH,WAAW,GAAGI,QAAQ,CAACL,gBAClCG,KAAKG,WAAW,CAACL,WAAW,GAAGI,QAAQ,CAACL,gBACxCG,KAAKd,QAAQ,CAACY,WAAW,GAAGI,QAAQ,CAACL,gBACrCG,KAAKI,IAAI,CAACC,IAAI,CAACC,CAAAA,MAAOA,IAAIR,WAAW,GAAGI,QAAQ,CAACL;QAEvD;QAEA,yBAAyB;QACzB,MAAMU,aAAa,AAAC1B,CAAAA,OAAO,CAAA,IAAKG;QAChC,MAAMwB,WAAWD,aAAavB;QAC9B,MAAMyB,gBAAgBf,KAAKgB,KAAK,CAACH,YAAYC;QAE7ChC,QAAQC,GAAG,CACT,CAAC,gCAAgC,EAAEiB,KAAKiB,MAAM,CAAC,QAAQ,EAAEF,cAAcE,MAAM,CAAC,SAAS,CAAC;QAG1F,MAAMC,WAA4C;YAChDC,SAAS;YACTnB,MAAMe;YACNK,OAAOpB,KAAKiB,MAAM;YAClB9B;YACAG;YACA+B,SAASP,WAAWd,KAAKiB,MAAM;QACjC;QAEA,OAAOK,oBAAY,CAACC,IAAI,CAACL;IAC3B,EAAE,OAAOhB,OAAO;QACdpB,QAAQoB,KAAK,CAAC,yCAAyCA;QACvD,OAAOoB,oBAAY,CAACC,IAAI,CACtB;YAAEJ,SAAS;YAAOjB,OAAO;QAAiC,GAC1D;YAAEsB,QAAQ;QAAI;IAElB;AACF;AAGO,eAAepD,KAAKS,OAAoB;IAC7C,IAAI;QACFC,QAAQC,GAAG,CAAC;QAEZ,MAAM0C,OAA6B,MAAM5C,QAAQ0C,IAAI;QAErD,2BAA2B;QAC3B,IAAI,CAACE,KAAKlB,KAAK,IAAI,CAACkB,KAAKhB,WAAW,IAAI,CAACgB,KAAKjC,QAAQ,EAAE;YACtD,OAAO8B,oBAAY,CAACC,IAAI,CACtB;gBAAEJ,SAAS;gBAAOjB,OAAO;YAA0B,GACnD;gBAAEsB,QAAQ;YAAI;QAElB;QAEA,uBAAuB;QACvB,MAAME,WAAW;YACf,GAAGD,IAAI;YACPE,WAAW;YACXC,YAAY,IAAIC,OAAOC,WAAW;YAClCC,YAAY,IAAIF,OAAOC,WAAW;QACpC;QAEA,kBAAkB;QAClB,MAAM,EAAE9B,MAAMgC,OAAO,EAAE9B,KAAK,EAAE,GAAG,MAAMvB,SACpCgB,IAAI,CAAC,iBACLsC,MAAM,CAACP,UACP9B,MAAM,GACNsC,MAAM;QAET,IAAIhC,OAAO;YACT,MAAMA;QACR;QAEApB,QAAQC,GAAG,CAAC,CAAC,sCAAsC,EAAEiD,QAAQG,EAAE,EAAE;QAEjE,MAAMjB,WAAwC;YAC5CC,SAAS;YACTnB,MAAM;gBAAEmC,IAAIH,QAAQG,EAAE;YAAC;QACzB;QAEA,OAAOb,oBAAY,CAACC,IAAI,CAACL,UAAU;YAAEM,QAAQ;QAAI;IACnD,EAAE,OAAOtB,OAAO;QACdpB,QAAQoB,KAAK,CAAC,wCAAwCA;QACtD,OAAOoB,oBAAY,CAACC,IAAI,CACtB;YAAEJ,SAAS;YAAOjB,OAAO;QAAiC,GAC1D;YAAEsB,QAAQ;QAAI;IAElB;AACF"}