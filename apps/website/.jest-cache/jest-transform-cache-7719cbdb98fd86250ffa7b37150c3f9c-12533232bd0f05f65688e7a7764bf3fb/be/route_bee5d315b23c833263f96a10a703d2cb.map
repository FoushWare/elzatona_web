<<<<<<< HEAD
{"version":3,"sources":["/Users/a.fouad/SideProjects/Elzatona-all/Elzatona-web/apps/website/src/app/api/plans/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { createClient } from '@supabase/supabase-js';\n\n// Helper function to create Supabase client\nfunction createSupabaseClient() {\n  const supabaseUrl =\n    process.env.NEXT_PUBLIC_SUPABASE_URL ||\n    'https://hpnewqkvpnthpohvxcmq.supabase.co';\n  const supabaseAnonKey =\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY ||\n    'YOUR_SUPABASE_KEY_HERE.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhwbmV3cWt2cG50aHBvaHZ4Y21xIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2NjA0MTgsImV4cCI6MjA3NjIzNjQxOH0.UMmriJb5HRr9W_56GilNNDWksvlFEb1V9c_PuBK-H3s';\n\n  if (!supabaseUrl || !supabaseAnonKey) {\n    throw new Error('Supabase credentials are missing');\n  }\n\n  return createClient(supabaseUrl, supabaseAnonKey);\n}\n\n// GET /api/plans - Get all learning plans\nexport async function GET(request: NextRequest) {\n  try {\n    console.log('ðŸ” API Debug: Starting GET /api/plans');\n\n    const supabase = createSupabaseClient();\n    console.log('ðŸ” API Debug: Supabase client created');\n\n    const { data: plans, error } = await supabase\n      .from('learning_plans')\n      .select('*')\n      .order('created_at', { ascending: true });\n\n    console.log('ðŸ” API Debug: Plans query result:', {\n      plansCount: plans?.length || 0,\n      plans:\n        plans?.map(p => ({ id: p.id, name: p.name, title: p.title })) || [],\n      error: error?.message || null,\n    });\n\n    if (error) {\n      console.error('âŒ Error fetching plans:', error);\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'Failed to fetch plans from database',\n          details: error.message,\n        },\n        { status: 500 }\n      );\n    }\n\n    console.log(\n      'âœ… API Debug: Successfully returning',\n      plans?.length || 0,\n      'plans'\n    );\n\n    return NextResponse.json({\n      success: true,\n      data: plans || [],\n      count: plans?.length || 0,\n    });\n  } catch (error) {\n    console.error('âŒ Error in GET /api/plans:', error);\n    const errorMessage =\n      error instanceof Error ? error.message : 'Unknown error';\n    const isFetchError =\n      errorMessage.includes('fetch') || errorMessage.includes('network');\n\n    return NextResponse.json(\n      {\n        success: false,\n        error: isFetchError\n          ? 'Failed to connect to database. Please check your network connection and Supabase configuration.'\n          : 'Failed to fetch plans from database',\n        details: errorMessage,\n      },\n      { status: 500 }\n    );\n  }\n}\n\n// POST /api/plans - Create a new learning plan\nexport async function POST(request: NextRequest) {\n  try {\n    const planData = await request.json();\n\n    const supabase = createSupabaseClient();\n\n    const planWithTimestamps = {\n      ...planData,\n      created_at: new Date().toISOString(),\n      updated_at: new Date().toISOString(),\n      created_by: 'admin',\n      updated_by: 'admin',\n      is_active: true,\n    };\n\n    const { data: newPlan, error } = await supabase\n      .from('learning_plans')\n      .insert(planWithTimestamps)\n      .select()\n      .single();\n\n    if (error) {\n      console.error('âŒ Error creating plan:', error);\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'Failed to create plan in database',\n          details: error.message,\n        },\n        { status: 500 }\n      );\n    }\n\n    return NextResponse.json({\n      success: true,\n      data: newPlan,\n      message: 'Plan created successfully',\n    });\n  } catch (error) {\n    console.error('âŒ Error in POST /api/plans:', error);\n    const errorMessage =\n      error instanceof Error ? error.message : 'Unknown error';\n    return NextResponse.json(\n      {\n        success: false,\n        error: 'Failed to create plan',\n        details: errorMessage,\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":["GET","POST","createSupabaseClient","supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","supabaseAnonKey","NEXT_PUBLIC_SUPABASE_ANON_KEY","Error","createClient","request","console","log","supabase","data","plans","error","from","select","order","ascending","plansCount","length","map","p","id","name","title","message","NextResponse","json","success","details","status","count","errorMessage","isFetchError","includes","planData","planWithTimestamps","created_at","Date","toISOString","updated_at","created_by","updated_by","is_active","newPlan","insert","single"],"mappings":"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"}
=======
{"version":3,"sources":["/Users/a.fouad/SideProjects/Elzatona-all/Elzatona-web/apps/website/src/app/api/plans/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { createClient } from '@supabase/supabase-js';\n\n// Helper function to create Supabase client\nfunction createSupabaseClient() {\n  const supabaseUrl =\n    process.env.NEXT_PUBLIC_SUPABASE_URL ||\n    'https://hpnewqkvpnthpohvxcmq.supabase.co';\n  const supabaseAnonKey =\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY ||\n    'SUPABASE_SERVICE_ROLE_KEY_REDACTED';\n\n  if (!supabaseUrl || !supabaseAnonKey) {\n    throw new Error('Supabase credentials are missing');\n  }\n\n  return createClient(supabaseUrl, supabaseAnonKey);\n}\n\n// GET /api/plans - Get all learning plans\nexport async function GET(request: NextRequest) {\n  try {\n    console.log('ðŸ” API Debug: Starting GET /api/plans');\n\n    const supabase = createSupabaseClient();\n    console.log('ðŸ” API Debug: Supabase client created');\n\n    const { data: plans, error } = await supabase\n      .from('learning_plans')\n      .select('*')\n      .order('created_at', { ascending: true });\n\n    console.log('ðŸ” API Debug: Plans query result:', {\n      plansCount: plans?.length || 0,\n      plans:\n        plans?.map(p => ({ id: p.id, name: p.name, title: p.title })) || [],\n      error: error?.message || null,\n    });\n\n    if (error) {\n      console.error('âŒ Error fetching plans:', error);\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'Failed to fetch plans from database',\n          details: error.message,\n        },\n        { status: 500 }\n      );\n    }\n\n    console.log(\n      'âœ… API Debug: Successfully returning',\n      plans?.length || 0,\n      'plans'\n    );\n\n    return NextResponse.json({\n      success: true,\n      data: plans || [],\n      count: plans?.length || 0,\n    });\n  } catch (error) {\n    console.error('âŒ Error in GET /api/plans:', error);\n    const errorMessage =\n      error instanceof Error ? error.message : 'Unknown error';\n    const isFetchError =\n      errorMessage.includes('fetch') || errorMessage.includes('network');\n\n    return NextResponse.json(\n      {\n        success: false,\n        error: isFetchError\n          ? 'Failed to connect to database. Please check your network connection and Supabase configuration.'\n          : 'Failed to fetch plans from database',\n        details: errorMessage,\n      },\n      { status: 500 }\n    );\n  }\n}\n\n// POST /api/plans - Create a new learning plan\nexport async function POST(request: NextRequest) {\n  try {\n    const planData = await request.json();\n\n    const supabase = createSupabaseClient();\n\n    const planWithTimestamps = {\n      ...planData,\n      created_at: new Date().toISOString(),\n      updated_at: new Date().toISOString(),\n      created_by: 'admin',\n      updated_by: 'admin',\n      is_active: true,\n    };\n\n    const { data: newPlan, error } = await supabase\n      .from('learning_plans')\n      .insert(planWithTimestamps)\n      .select()\n      .single();\n\n    if (error) {\n      console.error('âŒ Error creating plan:', error);\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'Failed to create plan in database',\n          details: error.message,\n        },\n        { status: 500 }\n      );\n    }\n\n    return NextResponse.json({\n      success: true,\n      data: newPlan,\n      message: 'Plan created successfully',\n    });\n  } catch (error) {\n    console.error('âŒ Error in POST /api/plans:', error);\n    const errorMessage =\n      error instanceof Error ? error.message : 'Unknown error';\n    return NextResponse.json(\n      {\n        success: false,\n        error: 'Failed to create plan',\n        details: errorMessage,\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":["GET","POST","createSupabaseClient","supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","supabaseAnonKey","NEXT_PUBLIC_SUPABASE_ANON_KEY","Error","createClient","request","console","log","supabase","data","plans","error","from","select","order","ascending","plansCount","length","map","p","id","name","title","message","NextResponse","json","success","details","status","count","errorMessage","isFetchError","includes","planData","planWithTimestamps","created_at","Date","toISOString","updated_at","created_by","updated_by","is_active","newPlan","insert","single"],"mappings":"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"}
>>>>>>> origin/security/fix-gitleaks-config
