{"version":3,"sources":["/Users/a.fouad/SideProjects/Elzatona-all/Elzatona-web/apps/website/src/__tests__/learning-type-context.test.tsx"],"sourcesContent":["// v1.0\nimport React from 'react';\nimport { render, screen, act } from '@testing-library/react';\nimport '@testing-library/jest-dom';\njest.mock('@/lib/supabase-client', () => ({\n  supabaseClient: {\n    auth: {\n      getSession: jest\n        .fn()\n        .mockResolvedValue({ data: { session: { user: { id: 'user_123' } } } }),\n      getUser: jest.fn().mockResolvedValue({ data: { user: null } }),\n      onAuthStateChange: jest.fn(() => ({\n        data: { subscription: { unsubscribe: () => {} } },\n      })),\n    },\n  },\n}));\nimport {\n  LearningTypeProvider,\n  useLearningType,\n} from '../context/LearningTypeContext';\n\nfunction Consumer() {\n  const { learningType, setLearningType } = useLearningType();\n  return (\n    <div>\n      <span data-testid='type'>{learningType}</span>\n      <button onClick={() => setLearningType('free-style')}>set-free</button>\n    </div>\n  );\n}\n\ndescribe('LearningTypeContext (app colocated)', () => {\n  beforeEach(() => {\n    window.localStorage.clear();\n    window.sessionStorage.clear();\n  });\n\n  it('provides default guided type', () => {\n    render(\n      <LearningTypeProvider>\n        <Consumer />\n      </LearningTypeProvider>\n    );\n    expect(screen.getByTestId('type').textContent).toBe('guided');\n  });\n\n  it('updates learning type', async () => {\n    render(\n      <LearningTypeProvider>\n        <Consumer />\n      </LearningTypeProvider>\n    );\n    await act(async () => {\n      screen.getByText('set-free').click();\n    });\n    expect(screen.getByTestId('type')).toHaveTextContent('free-style');\n  });\n\n  it('persists learning type under user-scoped key when session exists', async () => {\n    render(\n      <LearningTypeProvider>\n        <Consumer />\n      </LearningTypeProvider>\n    );\n    // wait a tick for provider to initialize userId via getSession\n    await act(async () => {});\n    await act(async () => {\n      screen.getByText('set-free').click();\n    });\n    expect(\n      window.localStorage.getItem('learning-preferences:user_123:type')\n    ).toBe('free-style');\n  });\n});\n"],"names":["jest","mock","supabaseClient","auth","getSession","fn","mockResolvedValue","data","session","user","id","getUser","onAuthStateChange","subscription","unsubscribe","Consumer","learningType","setLearningType","useLearningType","div","span","data-testid","button","onClick","describe","beforeEach","window","localStorage","clear","sessionStorage","it","render","LearningTypeProvider","expect","screen","getByTestId","textContent","toBe","act","getByText","click","toHaveTextContent","getItem"],"mappings":"AAAA,OAAO;;AAIPA,KAAKC,IAAI,CAAC,yBAAyB,IAAO,CAAA;QACxCC,gBAAgB;YACdC,MAAM;gBACJC,YAAYJ,KACTK,EAAE,GACFC,iBAAiB,CAAC;oBAAEC,MAAM;wBAAEC,SAAS;4BAAEC,MAAM;gCAAEC,IAAI;4BAAW;wBAAE;oBAAE;gBAAE;gBACvEC,SAASX,KAAKK,EAAE,GAAGC,iBAAiB,CAAC;oBAAEC,MAAM;wBAAEE,MAAM;oBAAK;gBAAE;gBAC5DG,mBAAmBZ,KAAKK,EAAE,CAAC,IAAO,CAAA;wBAChCE,MAAM;4BAAEM,cAAc;gCAAEC,aAAa,KAAO;4BAAE;wBAAE;oBAClD,CAAA;YACF;QACF;IACF,CAAA;;;;;8DAfkB;wBACkB;QAC7B;qCAiBA;;;;;;AAEP,SAASC;IACP,MAAM,EAAEC,YAAY,EAAEC,eAAe,EAAE,GAAGC,IAAAA,oCAAe;IACzD,qBACE,sBAACC;;0BACC,qBAACC;gBAAKC,eAAY;0BAAQL;;0BAC1B,qBAACM;gBAAOC,SAAS,IAAMN,gBAAgB;0BAAe;;;;AAG5D;AAEAO,SAAS,uCAAuC;IAC9CC,WAAW;QACTC,OAAOC,YAAY,CAACC,KAAK;QACzBF,OAAOG,cAAc,CAACD,KAAK;IAC7B;IAEAE,GAAG,gCAAgC;QACjCC,IAAAA,cAAM,gBACJ,qBAACC,yCAAoB;sBACnB,cAAA,qBAACjB;;QAGLkB,OAAOC,cAAM,CAACC,WAAW,CAAC,QAAQC,WAAW,EAAEC,IAAI,CAAC;IACtD;IAEAP,GAAG,yBAAyB;QAC1BC,IAAAA,cAAM,gBACJ,qBAACC,yCAAoB;sBACnB,cAAA,qBAACjB;;QAGL,MAAMuB,IAAAA,WAAG,EAAC;YACRJ,cAAM,CAACK,SAAS,CAAC,YAAYC,KAAK;QACpC;QACAP,OAAOC,cAAM,CAACC,WAAW,CAAC,SAASM,iBAAiB,CAAC;IACvD;IAEAX,GAAG,oEAAoE;QACrEC,IAAAA,cAAM,gBACJ,qBAACC,yCAAoB;sBACnB,cAAA,qBAACjB;;QAGL,+DAA+D;QAC/D,MAAMuB,IAAAA,WAAG,EAAC,WAAa;QACvB,MAAMA,IAAAA,WAAG,EAAC;YACRJ,cAAM,CAACK,SAAS,CAAC,YAAYC,KAAK;QACpC;QACAP,OACEP,OAAOC,YAAY,CAACe,OAAO,CAAC,uCAC5BL,IAAI,CAAC;IACT;AACF"}