4b4a0de01297d688e9ab99348868f94c
// v1.0
"use strict";
jest.mock('@/lib/supabase-client', ()=>({
        supabaseClient: {
            auth: {
                getSession: jest.fn().mockResolvedValue({
                    data: {
                        session: {
                            user: {
                                id: 'user_123'
                            }
                        }
                    }
                }),
                getUser: jest.fn().mockResolvedValue({
                    data: {
                        user: null
                    }
                }),
                onAuthStateChange: jest.fn(()=>({
                        data: {
                            subscription: {
                                unsubscribe: ()=>{}
                            }
                        }
                    }))
            }
        }
    }));
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _jsxruntime = require("react/jsx-runtime");
const _react = /*#__PURE__*/ _interop_require_default(require("react"));
const _react1 = require("@testing-library/react");
require("@testing-library/jest-dom");
const _LearningTypeContext = require("../context/LearningTypeContext");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function Consumer() {
    const { learningType, setLearningType } = (0, _LearningTypeContext.useLearningType)();
    return /*#__PURE__*/ (0, _jsxruntime.jsxs)("div", {
        children: [
            /*#__PURE__*/ (0, _jsxruntime.jsx)("span", {
                "data-testid": "type",
                children: learningType
            }),
            /*#__PURE__*/ (0, _jsxruntime.jsx)("button", {
                onClick: ()=>setLearningType('free-style'),
                children: "set-free"
            })
        ]
    });
}
describe('LearningTypeContext (app colocated)', ()=>{
    beforeEach(()=>{
        window.localStorage.clear();
        window.sessionStorage.clear();
    });
    it('provides default guided type', ()=>{
        (0, _react1.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_LearningTypeContext.LearningTypeProvider, {
            children: /*#__PURE__*/ (0, _jsxruntime.jsx)(Consumer, {})
        }));
        expect(_react1.screen.getByTestId('type').textContent).toBe('guided');
    });
    it('updates learning type', async ()=>{
        (0, _react1.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_LearningTypeContext.LearningTypeProvider, {
            children: /*#__PURE__*/ (0, _jsxruntime.jsx)(Consumer, {})
        }));
        await (0, _react1.act)(async ()=>{
            _react1.screen.getByText('set-free').click();
        });
        expect(_react1.screen.getByTestId('type')).toHaveTextContent('free-style');
    });
    it('persists learning type under user-scoped key when session exists', async ()=>{
        (0, _react1.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_LearningTypeContext.LearningTypeProvider, {
            children: /*#__PURE__*/ (0, _jsxruntime.jsx)(Consumer, {})
        }));
        // wait a tick for provider to initialize userId via getSession
        await (0, _react1.act)(async ()=>{});
        await (0, _react1.act)(async ()=>{
            _react1.screen.getByText('set-free').click();
        });
        expect(window.localStorage.getItem('learning-preferences:user_123:type')).toBe('free-style');
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hLmZvdWFkL1NpZGVQcm9qZWN0cy9FbHphdG9uYS1hbGwvRWx6YXRvbmEtd2ViL2FwcHMvd2Vic2l0ZS9zcmMvX190ZXN0c19fL2xlYXJuaW5nLXR5cGUtY29udGV4dC50ZXN0LnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyB2MS4wXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgcmVuZGVyLCBzY3JlZW4sIGFjdCB9IGZyb20gJ0B0ZXN0aW5nLWxpYnJhcnkvcmVhY3QnO1xuaW1wb3J0ICdAdGVzdGluZy1saWJyYXJ5L2plc3QtZG9tJztcbmplc3QubW9jaygnQC9saWIvc3VwYWJhc2UtY2xpZW50JywgKCkgPT4gKHtcbiAgc3VwYWJhc2VDbGllbnQ6IHtcbiAgICBhdXRoOiB7XG4gICAgICBnZXRTZXNzaW9uOiBqZXN0XG4gICAgICAgIC5mbigpXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGRhdGE6IHsgc2Vzc2lvbjogeyB1c2VyOiB7IGlkOiAndXNlcl8xMjMnIH0gfSB9IH0pLFxuICAgICAgZ2V0VXNlcjogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZGF0YTogeyB1c2VyOiBudWxsIH0gfSksXG4gICAgICBvbkF1dGhTdGF0ZUNoYW5nZTogamVzdC5mbigoKSA9PiAoe1xuICAgICAgICBkYXRhOiB7IHN1YnNjcmlwdGlvbjogeyB1bnN1YnNjcmliZTogKCkgPT4ge30gfSB9LFxuICAgICAgfSkpLFxuICAgIH0sXG4gIH0sXG59KSk7XG5pbXBvcnQge1xuICBMZWFybmluZ1R5cGVQcm92aWRlcixcbiAgdXNlTGVhcm5pbmdUeXBlLFxufSBmcm9tICcuLi9jb250ZXh0L0xlYXJuaW5nVHlwZUNvbnRleHQnO1xuXG5mdW5jdGlvbiBDb25zdW1lcigpIHtcbiAgY29uc3QgeyBsZWFybmluZ1R5cGUsIHNldExlYXJuaW5nVHlwZSB9ID0gdXNlTGVhcm5pbmdUeXBlKCk7XG4gIHJldHVybiAoXG4gICAgPGRpdj5cbiAgICAgIDxzcGFuIGRhdGEtdGVzdGlkPSd0eXBlJz57bGVhcm5pbmdUeXBlfTwvc3Bhbj5cbiAgICAgIDxidXR0b24gb25DbGljaz17KCkgPT4gc2V0TGVhcm5pbmdUeXBlKCdmcmVlLXN0eWxlJyl9PnNldC1mcmVlPC9idXR0b24+XG4gICAgPC9kaXY+XG4gICk7XG59XG5cbmRlc2NyaWJlKCdMZWFybmluZ1R5cGVDb250ZXh0IChhcHAgY29sb2NhdGVkKScsICgpID0+IHtcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgd2luZG93LmxvY2FsU3RvcmFnZS5jbGVhcigpO1xuICAgIHdpbmRvdy5zZXNzaW9uU3RvcmFnZS5jbGVhcigpO1xuICB9KTtcblxuICBpdCgncHJvdmlkZXMgZGVmYXVsdCBndWlkZWQgdHlwZScsICgpID0+IHtcbiAgICByZW5kZXIoXG4gICAgICA8TGVhcm5pbmdUeXBlUHJvdmlkZXI+XG4gICAgICAgIDxDb25zdW1lciAvPlxuICAgICAgPC9MZWFybmluZ1R5cGVQcm92aWRlcj5cbiAgICApO1xuICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ3R5cGUnKS50ZXh0Q29udGVudCkudG9CZSgnZ3VpZGVkJyk7XG4gIH0pO1xuXG4gIGl0KCd1cGRhdGVzIGxlYXJuaW5nIHR5cGUnLCBhc3luYyAoKSA9PiB7XG4gICAgcmVuZGVyKFxuICAgICAgPExlYXJuaW5nVHlwZVByb3ZpZGVyPlxuICAgICAgICA8Q29uc3VtZXIgLz5cbiAgICAgIDwvTGVhcm5pbmdUeXBlUHJvdmlkZXI+XG4gICAgKTtcbiAgICBhd2FpdCBhY3QoYXN5bmMgKCkgPT4ge1xuICAgICAgc2NyZWVuLmdldEJ5VGV4dCgnc2V0LWZyZWUnKS5jbGljaygpO1xuICAgIH0pO1xuICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ3R5cGUnKSkudG9IYXZlVGV4dENvbnRlbnQoJ2ZyZWUtc3R5bGUnKTtcbiAgfSk7XG5cbiAgaXQoJ3BlcnNpc3RzIGxlYXJuaW5nIHR5cGUgdW5kZXIgdXNlci1zY29wZWQga2V5IHdoZW4gc2Vzc2lvbiBleGlzdHMnLCBhc3luYyAoKSA9PiB7XG4gICAgcmVuZGVyKFxuICAgICAgPExlYXJuaW5nVHlwZVByb3ZpZGVyPlxuICAgICAgICA8Q29uc3VtZXIgLz5cbiAgICAgIDwvTGVhcm5pbmdUeXBlUHJvdmlkZXI+XG4gICAgKTtcbiAgICAvLyB3YWl0IGEgdGljayBmb3IgcHJvdmlkZXIgdG8gaW5pdGlhbGl6ZSB1c2VySWQgdmlhIGdldFNlc3Npb25cbiAgICBhd2FpdCBhY3QoYXN5bmMgKCkgPT4ge30pO1xuICAgIGF3YWl0IGFjdChhc3luYyAoKSA9PiB7XG4gICAgICBzY3JlZW4uZ2V0QnlUZXh0KCdzZXQtZnJlZScpLmNsaWNrKCk7XG4gICAgfSk7XG4gICAgZXhwZWN0KFxuICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKCdsZWFybmluZy1wcmVmZXJlbmNlczp1c2VyXzEyMzp0eXBlJylcbiAgICApLnRvQmUoJ2ZyZWUtc3R5bGUnKTtcbiAgfSk7XG59KTtcbiJdLCJuYW1lcyI6WyJqZXN0IiwibW9jayIsInN1cGFiYXNlQ2xpZW50IiwiYXV0aCIsImdldFNlc3Npb24iLCJmbiIsIm1vY2tSZXNvbHZlZFZhbHVlIiwiZGF0YSIsInNlc3Npb24iLCJ1c2VyIiwiaWQiLCJnZXRVc2VyIiwib25BdXRoU3RhdGVDaGFuZ2UiLCJzdWJzY3JpcHRpb24iLCJ1bnN1YnNjcmliZSIsIkNvbnN1bWVyIiwibGVhcm5pbmdUeXBlIiwic2V0TGVhcm5pbmdUeXBlIiwidXNlTGVhcm5pbmdUeXBlIiwiZGl2Iiwic3BhbiIsImRhdGEtdGVzdGlkIiwiYnV0dG9uIiwib25DbGljayIsImRlc2NyaWJlIiwiYmVmb3JlRWFjaCIsIndpbmRvdyIsImxvY2FsU3RvcmFnZSIsImNsZWFyIiwic2Vzc2lvblN0b3JhZ2UiLCJpdCIsInJlbmRlciIsIkxlYXJuaW5nVHlwZVByb3ZpZGVyIiwiZXhwZWN0Iiwic2NyZWVuIiwiZ2V0QnlUZXN0SWQiLCJ0ZXh0Q29udGVudCIsInRvQmUiLCJhY3QiLCJnZXRCeVRleHQiLCJjbGljayIsInRvSGF2ZVRleHRDb250ZW50IiwiZ2V0SXRlbSJdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTzs7QUFJUEEsS0FBS0MsSUFBSSxDQUFDLHlCQUF5QixJQUFPLENBQUE7UUFDeENDLGdCQUFnQjtZQUNkQyxNQUFNO2dCQUNKQyxZQUFZSixLQUNUSyxFQUFFLEdBQ0ZDLGlCQUFpQixDQUFDO29CQUFFQyxNQUFNO3dCQUFFQyxTQUFTOzRCQUFFQyxNQUFNO2dDQUFFQyxJQUFJOzRCQUFXO3dCQUFFO29CQUFFO2dCQUFFO2dCQUN2RUMsU0FBU1gsS0FBS0ssRUFBRSxHQUFHQyxpQkFBaUIsQ0FBQztvQkFBRUMsTUFBTTt3QkFBRUUsTUFBTTtvQkFBSztnQkFBRTtnQkFDNURHLG1CQUFtQlosS0FBS0ssRUFBRSxDQUFDLElBQU8sQ0FBQTt3QkFDaENFLE1BQU07NEJBQUVNLGNBQWM7Z0NBQUVDLGFBQWEsS0FBTzs0QkFBRTt3QkFBRTtvQkFDbEQsQ0FBQTtZQUNGO1FBQ0Y7SUFDRixDQUFBOzs7Ozs4REFma0I7d0JBQ2tCO1FBQzdCO3FDQWlCQTs7Ozs7O0FBRVAsU0FBU0M7SUFDUCxNQUFNLEVBQUVDLFlBQVksRUFBRUMsZUFBZSxFQUFFLEdBQUdDLElBQUFBLG9DQUFlO0lBQ3pELHFCQUNFLHNCQUFDQzs7MEJBQ0MscUJBQUNDO2dCQUFLQyxlQUFZOzBCQUFRTDs7MEJBQzFCLHFCQUFDTTtnQkFBT0MsU0FBUyxJQUFNTixnQkFBZ0I7MEJBQWU7Ozs7QUFHNUQ7QUFFQU8sU0FBUyx1Q0FBdUM7SUFDOUNDLFdBQVc7UUFDVEMsT0FBT0MsWUFBWSxDQUFDQyxLQUFLO1FBQ3pCRixPQUFPRyxjQUFjLENBQUNELEtBQUs7SUFDN0I7SUFFQUUsR0FBRyxnQ0FBZ0M7UUFDakNDLElBQUFBLGNBQU0sZ0JBQ0oscUJBQUNDLHlDQUFvQjtzQkFDbkIsY0FBQSxxQkFBQ2pCOztRQUdMa0IsT0FBT0MsY0FBTSxDQUFDQyxXQUFXLENBQUMsUUFBUUMsV0FBVyxFQUFFQyxJQUFJLENBQUM7SUFDdEQ7SUFFQVAsR0FBRyx5QkFBeUI7UUFDMUJDLElBQUFBLGNBQU0sZ0JBQ0oscUJBQUNDLHlDQUFvQjtzQkFDbkIsY0FBQSxxQkFBQ2pCOztRQUdMLE1BQU11QixJQUFBQSxXQUFHLEVBQUM7WUFDUkosY0FBTSxDQUFDSyxTQUFTLENBQUMsWUFBWUMsS0FBSztRQUNwQztRQUNBUCxPQUFPQyxjQUFNLENBQUNDLFdBQVcsQ0FBQyxTQUFTTSxpQkFBaUIsQ0FBQztJQUN2RDtJQUVBWCxHQUFHLG9FQUFvRTtRQUNyRUMsSUFBQUEsY0FBTSxnQkFDSixxQkFBQ0MseUNBQW9CO3NCQUNuQixjQUFBLHFCQUFDakI7O1FBR0wsK0RBQStEO1FBQy9ELE1BQU11QixJQUFBQSxXQUFHLEVBQUMsV0FBYTtRQUN2QixNQUFNQSxJQUFBQSxXQUFHLEVBQUM7WUFDUkosY0FBTSxDQUFDSyxTQUFTLENBQUMsWUFBWUMsS0FBSztRQUNwQztRQUNBUCxPQUNFUCxPQUFPQyxZQUFZLENBQUNlLE9BQU8sQ0FBQyx1Q0FDNUJMLElBQUksQ0FBQztJQUNUO0FBQ0YifQ==