{"version":3,"sources":["/Users/a.fouad/SideProjects/Elzatona-all/Elzatona-web/apps/website/src/app/api/cards/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { supabaseOperations } from '../../../lib/supabase-server';\nimport { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;\nconst supabase = createClient(supabaseUrl, supabaseServiceRoleKey);\n\n/**\n * @swagger\n * /api/cards:\n *   get:\n *     summary: Get all learning cards\n *     description: Retrieve all learning cards ordered by their order field\n *     tags: [Learning Cards]\n *     responses:\n *       200:\n *         description: Successfully retrieved learning cards\n *         content:\n *           application/json:\n *             schema:\n *               type: object\n *               properties:\n *                 success:\n *                   type: boolean\n *                   example: true\n *                 data:\n *                   type: array\n *                   items:\n *                     $ref: '#/components/schemas/LearningCard'\n *                 count:\n *                   type: number\n *                   example: 5\n *       500:\n *         description: Internal server error\n *         content:\n *           application/json:\n *             schema:\n *               $ref: '#/components/schemas/Error'\n */\n// GET /api/cards - Get all learning cards\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const type = searchParams.get('type');\n    const isActive = searchParams.get('isActive');\n    const limit = searchParams.get('limit');\n\n    const filters = {\n      type: type || undefined,\n      is_active: isActive ? isActive === 'true' : undefined,\n      limit: limit ? parseInt(limit, 10) : undefined,\n      orderBy: 'order_index',\n      orderDirection: 'asc' as const,\n    };\n\n    const { data: cards, error } =\n      await supabaseOperations.getLearningCards(filters);\n\n    if (error) {\n      throw new Error(error.message);\n    }\n\n    // Transform data to match expected format\n    const transformedCards = (cards || []).map((card: any) => ({\n      id: card.id,\n      title: card.title,\n      name: card.title, // For backward compatibility\n      type: card.type,\n      description: card.description,\n      color: card.color,\n      icon: card.icon,\n      order: card.order_index,\n      order_index: card.order_index,\n      is_active: card.is_active,\n      created_at: card.created_at,\n      updated_at: card.updated_at,\n    }));\n\n    return NextResponse.json({\n      success: true,\n      data: transformedCards,\n      count: transformedCards.length,\n    });\n  } catch (error) {\n    console.error('Error fetching cards:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to fetch cards' },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * @swagger\n * /api/cards:\n *   post:\n *     summary: Create a new learning card\n *     description: Create a new learning card with the provided data\n *     tags: [Learning Cards]\n *     requestBody:\n *       required: true\n *       content:\n *         application/json:\n *           schema:\n *             type: object\n *             required:\n *               - name\n *               - description\n *               - type\n *             properties:\n *               name:\n *                 type: string\n *                 example: \"Core Technologies\"\n *               description:\n *                 type: string\n *                 example: \"Fundamental web technologies\"\n *               type:\n *                 type: string\n *                 enum: [core-technologies, framework-questions, problem-solving, system-design, frontend-tasks]\n *                 example: \"core-technologies\"\n *               color:\n *                 type: string\n *                 example: \"#3B82F6\"\n *               icon:\n *                 type: string\n *                 example: \"Code\"\n *               order:\n *                 type: number\n *                 example: 1\n *     responses:\n *       200:\n *         description: Learning card created successfully\n *         content:\n *           application/json:\n *             schema:\n *               type: object\n *               properties:\n *                 success:\n *                   type: boolean\n *                   example: true\n *                 data:\n *                   $ref: '#/components/schemas/LearningCard'\n *                 message:\n *                   type: string\n *                   example: \"Card created successfully\"\n *       500:\n *         description: Internal server error\n *         content:\n *           application/json:\n *             schema:\n *               $ref: '#/components/schemas/Error'\n */\n// POST /api/cards - Create a new learning card\nexport async function POST(request: NextRequest) {\n  try {\n    const cardData = await request.json();\n\n    // Transform data to match Supabase schema\n    const supabaseCardData = {\n      title: cardData.name || cardData.title,\n      type: cardData.type,\n      description: cardData.description,\n      color: cardData.color || '#3B82F6',\n      icon: cardData.icon || 'code',\n      order_index: cardData.order || cardData.order_index || 0,\n      is_active: cardData.isActive !== false,\n    };\n\n    const { data: newCard, error } = await supabase\n      .from('learning_cards')\n      .insert(supabaseCardData)\n      .select()\n      .single();\n\n    if (error) {\n      throw new Error(error.message);\n    }\n\n    if (!newCard) {\n      throw new Error('No card was created');\n    }\n\n    // Transform response to match expected format\n    const transformedCard = {\n      id: newCard.id,\n      title: newCard.title,\n      name: newCard.title, // For backward compatibility\n      type: newCard.type,\n      description: newCard.description,\n      color: newCard.color,\n      icon: newCard.icon,\n      order: newCard.order_index,\n      order_index: newCard.order_index,\n      is_active: newCard.is_active,\n      created_at: newCard.created_at,\n      updated_at: newCard.updated_at,\n    };\n\n    return NextResponse.json({\n      success: true,\n      data: transformedCard,\n      message: 'Card created successfully',\n    });\n  } catch (error) {\n    console.error('Error creating card:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to create card' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":["GET","POST","supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","supabaseServiceRoleKey","SUPABASE_SERVICE_ROLE_KEY","supabase","createClient","request","searchParams","URL","url","type","get","isActive","limit","filters","undefined","is_active","parseInt","orderBy","orderDirection","data","cards","error","supabaseOperations","getLearningCards","Error","message","transformedCards","map","card","id","title","name","description","color","icon","order","order_index","created_at","updated_at","NextResponse","json","success","count","length","console","status","cardData","supabaseCardData","newCard","from","insert","select","single","transformedCard"],"mappings":"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"}