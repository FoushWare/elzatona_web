{"version":3,"sources":["/Users/a.fouad/SideProjects/Elzatona-all/Elzatona-web/libs/shared-contexts/src/lib/UserPreferencesContext.tsx"],"sourcesContent":["'use client';\n\nimport {\n  createContext,\n  useContext,\n  useState,\n  useEffect,\n  ReactNode,\n} from 'react';\nimport type { SupabaseClient } from '@supabase/supabase-js';\n\n// Only create Supabase client if environment variables are available\nlet supabase: SupabaseClient | null = null;\nif (\n  process.env['NEXT_PUBLIC_SUPABASE_URL'] &&\n  process.env['SUPABASE_SERVICE_ROLE_KEY']\n) {\n  // Dynamic import to avoid SSR issues\n  import('@supabase/supabase-js').then(({ createClient }) => {\n    const supabaseUrl = process.env['NEXT_PUBLIC_SUPABASE_URL'] as string;\n    const supabaseServiceRoleKey = process.env[\n      'SUPABASE_SERVICE_ROLE_KEY'\n    ] as string;\n    supabase = createClient(supabaseUrl, supabaseServiceRoleKey);\n  });\n}\n\ninterface UserPreferences {\n  theme: 'light' | 'dark' | 'system';\n  notifications: boolean;\n  language: string;\n  learningMode: 'guided' | 'freestyle';\n  dailyGoal: number;\n  reminderTime: string;\n  difficulty: 'easy' | 'medium' | 'hard' | 'mixed';\n  autoSave: boolean;\n}\n\ninterface UserPreferencesContextType {\n  preferences: UserPreferences;\n  updatePreferences: (updates: Partial<UserPreferences>) => Promise<void>;\n  isLoading: boolean;\n}\n\nconst defaultPreferences: UserPreferences = {\n  theme: 'system',\n  notifications: true,\n  language: 'en',\n  learningMode: 'guided',\n  dailyGoal: 10,\n  reminderTime: '09:00',\n  difficulty: 'mixed',\n  autoSave: true,\n};\n\nconst UserPreferencesContext = createContext<\n  UserPreferencesContextType | undefined\n>(undefined);\n\nexport function useUserPreferences() {\n  const context = useContext(UserPreferencesContext);\n  if (context === undefined) {\n    throw new Error(\n      'useUserPreferences must be used within a UserPreferencesProvider'\n    );\n  }\n  return context;\n}\n\ninterface UserPreferencesProviderProps {\n  children: ReactNode;\n}\n\nexport function UserPreferencesProvider({\n  children,\n}: UserPreferencesProviderProps) {\n  const [user] = useState<{ id: string } | null>(null);\n  const updateUserProfile = async (data: { preferences: UserPreferences }) => {\n    // Placeholder for user profile update\n    console.log('User profile update:', data);\n    // If supabase is available, update user preferences in database\n    if (supabase && user) {\n      // Future implementation: update user preferences in Supabase\n    }\n  };\n  const [preferences, setPreferences] =\n    useState<UserPreferences>(defaultPreferences);\n  const [isLoading, setIsLoading] = useState(true);\n\n  // Load preferences from user data or localStorage\n  useEffect(() => {\n    const loadPreferences = () => {\n      try {\n        // Load from localStorage\n        const savedPreferences = localStorage.getItem('user-preferences');\n        if (savedPreferences) {\n          const parsed = JSON.parse(savedPreferences);\n          setPreferences({\n            ...defaultPreferences,\n            ...parsed,\n          });\n        }\n      } catch (error) {\n        console.error('Error loading preferences:', error);\n        setPreferences(defaultPreferences);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    loadPreferences();\n  }, [user]);\n\n  // Save preferences to localStorage and Firebase\n  const updatePreferences = async (updates: Partial<UserPreferences>) => {\n    try {\n      const newPreferences = { ...preferences, ...updates };\n      setPreferences(newPreferences);\n\n      // Save to localStorage immediately\n      localStorage.setItem('user-preferences', JSON.stringify(newPreferences));\n\n      // Save to Firebase if user is authenticated\n      if (user) {\n        await updateUserProfile({\n          preferences: newPreferences,\n        });\n      }\n    } catch (error) {\n      console.error('Error updating preferences:', error);\n      throw error;\n    }\n  };\n\n  // Apply theme preference\n  useEffect(() => {\n    const applyTheme = () => {\n      const { theme } = preferences;\n\n      if (theme === 'system') {\n        // Use system preference\n        const systemTheme = window.matchMedia('(prefers-color-scheme: dark)')\n          .matches\n          ? 'dark'\n          : 'light';\n        document.documentElement.classList.toggle(\n          'dark',\n          systemTheme === 'dark'\n        );\n      } else {\n        // Use user preference\n        document.documentElement.classList.toggle('dark', theme === 'dark');\n      }\n    };\n\n    if (!isLoading) {\n      applyTheme();\n    }\n  }, [preferences.theme, isLoading]);\n\n  // Listen for system theme changes when using system preference\n  useEffect(() => {\n    if (preferences.theme === 'system') {\n      const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n      const handleChange = () => {\n        document.documentElement.classList.toggle('dark', mediaQuery.matches);\n      };\n\n      mediaQuery.addEventListener('change', handleChange);\n      return () => mediaQuery.removeEventListener('change', handleChange);\n    }\n    return undefined;\n  }, [preferences.theme]);\n\n  const value: UserPreferencesContextType = {\n    preferences,\n    updatePreferences,\n    isLoading,\n  };\n\n  return (\n    <UserPreferencesContext.Provider value={value}>\n      {children}\n    </UserPreferencesContext.Provider>\n  );\n}\n"],"names":["UserPreferencesProvider","useUserPreferences","supabase","process","env","then","createClient","supabaseUrl","supabaseServiceRoleKey","defaultPreferences","theme","notifications","language","learningMode","dailyGoal","reminderTime","difficulty","autoSave","UserPreferencesContext","createContext","undefined","context","useContext","Error","children","user","useState","updateUserProfile","data","console","log","preferences","setPreferences","isLoading","setIsLoading","useEffect","loadPreferences","savedPreferences","localStorage","getItem","parsed","JSON","parse","error","updatePreferences","updates","newPreferences","setItem","stringify","applyTheme","systemTheme","window","matchMedia","matches","document","documentElement","classList","toggle","mediaQuery","handleChange","addEventListener","removeEventListener","value","Provider"],"mappings":"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"}