{"version":3,"sources":["/Users/a.fouad/SideProjects/Elzatona-all/Elzatona-web/apps/website/src/app/admin/login/page.integration.test.tsx"],"sourcesContent":["/**\n * Integration Tests for Admin Login (A-IT-010, A-IT-011, A-IT-012)\n * Task: A-002 - Admin Login\n */\n\nimport React from 'react';\nimport { render, screen, fireEvent, waitFor, act } from '@testing-library/react';\nimport '@testing-library/jest-dom';\nimport AdminLoginPage from './page';\nimport * as sharedContexts from '@elzatona/shared-contexts';\n\n// Mock shared contexts\njest.mock('@elzatona/shared-contexts', () => {\n  const actual = jest.requireActual('../../../../test-utils/mocks/shared-contexts');\n  return {\n    ...actual,\n    useAdminAuth: jest.fn(),\n  };\n});\n\n// Mock shared components\njest.mock('@elzatona/shared-components', () => ({\n  AdminLoginNavbar: () => <nav data-testid=\"admin-login-navbar\">Admin Navbar</nav>,\n}));\n\njest.mock('next/link', () => {\n  return ({ children, href }: { children: React.ReactNode; href: string }) => {\n    return <a href={href}>{children}</a>;\n  };\n});\n\nconst mockPush = jest.fn();\nconst mockReplace = jest.fn();\nconst mockLogin = jest.fn();\n\njest.mock('next/navigation', () => ({\n  useRouter: () => ({\n    push: mockPush,\n    replace: mockReplace,\n    prefetch: jest.fn(),\n  }),\n  usePathname: () => '/admin/login',\n}));\n\ndescribe('A-IT-010: Login API Call', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    \n    (sharedContexts.useAdminAuth as jest.Mock).mockReturnValue({\n      isAuthenticated: false,\n      isLoading: false,\n      login: mockLogin,\n      logout: jest.fn(),\n      user: null,\n    });\n  });\n\n  it('should call login API with correct credentials', async () => {\n    mockLogin.mockResolvedValue({ success: true });\n    \n    render(<AdminLoginPage />);\n    const emailInput = screen.getByLabelText(/Email Address/i);\n    const passwordInput = screen.getByLabelText(/Password/i);\n    const submitButton = screen.getByRole('button', { name: /Sign In/i });\n    const form = submitButton.closest('form');\n    \n    await act(async () => {\n      fireEvent.change(emailInput, { target: { value: 'admin@example.com' } });\n      fireEvent.change(passwordInput, { target: { value: 'password123' } });\n      fireEvent.submit(form!);\n    });\n    \n    await waitFor(() => {\n      expect(mockLogin).toHaveBeenCalledWith('admin@example.com', 'password123');\n    });\n  });\n\n  it('should handle successful login response', async () => {\n    mockLogin.mockResolvedValue({ success: true });\n    \n    (sharedContexts.useAdminAuth as jest.Mock).mockReturnValue({\n      isAuthenticated: true,\n      isLoading: false,\n      login: mockLogin,\n      logout: jest.fn(),\n      user: { id: '1', email: 'admin@example.com', role: 'super_admin' },\n    });\n    \n    render(<AdminLoginPage />);\n    const emailInput = screen.getByLabelText(/Email Address/i);\n    const passwordInput = screen.getByLabelText(/Password/i);\n    const submitButton = screen.getByRole('button', { name: /Sign In/i });\n    const form = submitButton.closest('form');\n    \n    await act(async () => {\n      fireEvent.change(emailInput, { target: { value: 'admin@example.com' } });\n      fireEvent.change(passwordInput, { target: { value: 'password123' } });\n      fireEvent.submit(form!);\n    });\n    \n    await waitFor(() => {\n      expect(mockLogin).toHaveBeenCalled();\n    });\n  });\n\n  it('should handle login API error', async () => {\n    mockLogin.mockResolvedValue({\n      success: false,\n      error: 'Invalid email or password',\n    });\n    \n    render(<AdminLoginPage />);\n    const emailInput = screen.getByLabelText(/Email Address/i);\n    const passwordInput = screen.getByLabelText(/Password/i);\n    const submitButton = screen.getByRole('button', { name: /Sign In/i });\n    const form = submitButton.closest('form');\n    \n    await act(async () => {\n      fireEvent.change(emailInput, { target: { value: 'wrong@example.com' } });\n      fireEvent.change(passwordInput, { target: { value: 'wrongpass' } });\n      fireEvent.submit(form!);\n    });\n    \n    await waitFor(() => {\n      expect(screen.getByText(/Invalid email or password|Login failed/i)).toBeInTheDocument();\n    });\n  });\n});\n\ndescribe('A-IT-011: Redirect After Login', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    mockLogin.mockResolvedValue({ success: true });\n  });\n\n  it('should redirect authenticated users away from login page', () => {\n    (sharedContexts.useAdminAuth as jest.Mock).mockReturnValue({\n      isAuthenticated: true,\n      isLoading: false,\n      login: mockLogin,\n      logout: jest.fn(),\n      user: { id: '1', email: 'admin@example.com' },\n    });\n    \n    render(<AdminLoginPage />);\n    \n    // AdminAuthContext should handle redirect via useEffect\n    // This is tested in the context itself\n    expect(mockReplace).toHaveBeenCalledWith('/admin/dashboard');\n  });\n\n  it('should not redirect unauthenticated users', () => {\n    (sharedContexts.useAdminAuth as jest.Mock).mockReturnValue({\n      isAuthenticated: false,\n      isLoading: false,\n      login: mockLogin,\n      logout: jest.fn(),\n      user: null,\n    });\n    \n    render(<AdminLoginPage />);\n    \n    // Should not redirect if not authenticated\n    expect(mockReplace).not.toHaveBeenCalled();\n  });\n});\n\ndescribe('A-IT-012: Session Management', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    \n    // Mock localStorage\n    Storage.prototype.getItem = jest.fn(() => null);\n    Storage.prototype.setItem = jest.fn();\n    Storage.prototype.removeItem = jest.fn();\n  });\n\n  it('should persist session after successful login', async () => {\n    mockLogin.mockResolvedValue({ success: true });\n    \n    (sharedContexts.useAdminAuth as jest.Mock).mockReturnValue({\n      isAuthenticated: true,\n      isLoading: false,\n      login: mockLogin,\n      logout: jest.fn(),\n      user: { id: '1', email: 'admin@example.com' },\n    });\n    \n    render(<AdminLoginPage />);\n    \n    // Session should be persisted (handled by AdminAuthContext)\n    expect(Storage.prototype.setItem).toHaveBeenCalled();\n  });\n\n  it('should check existing session on mount', () => {\n    Storage.prototype.getItem = jest.fn(() => JSON.stringify({\n      user: { id: '1', email: 'admin@example.com' },\n      session: { access_token: 'token' },\n    }));\n    \n    (sharedContexts.useAdminAuth as jest.Mock).mockReturnValue({\n      isAuthenticated: true,\n      isLoading: false,\n      login: mockLogin,\n      logout: jest.fn(),\n      user: { id: '1', email: 'admin@example.com' },\n    });\n    \n    render(<AdminLoginPage />);\n    \n    // Should check localStorage for existing session\n    expect(Storage.prototype.getItem).toHaveBeenCalled();\n  });\n});\n"],"names":["jest","mock","actual","requireActual","useAdminAuth","fn","AdminLoginNavbar","nav","data-testid","children","href","a","useRouter","push","mockPush","replace","mockReplace","prefetch","usePathname","mockLogin","describe","beforeEach","clearAllMocks","sharedContexts","mockReturnValue","isAuthenticated","isLoading","login","logout","user","it","mockResolvedValue","success","render","AdminLoginPage","emailInput","screen","getByLabelText","passwordInput","submitButton","getByRole","name","form","closest","act","fireEvent","change","target","value","submit","waitFor","expect","toHaveBeenCalledWith","id","email","role","toHaveBeenCalled","error","getByText","toBeInTheDocument","not","Storage","prototype","getItem","setItem","removeItem","JSON","stringify","session","access_token"],"mappings":"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"}