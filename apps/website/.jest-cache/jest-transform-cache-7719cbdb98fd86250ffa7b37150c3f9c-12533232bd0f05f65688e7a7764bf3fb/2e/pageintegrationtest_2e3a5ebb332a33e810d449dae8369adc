b5e69ab4863b104bd3c76efa3902aa94
/**
 * Integration Tests for Admin Login (A-IT-010, A-IT-011, A-IT-012)
 * Task: A-002 - Admin Login
 */ "use strict";
// Mock shared contexts
jest.mock('@elzatona/shared-contexts', ()=>{
    const actual = jest.requireActual('../../../../test-utils/mocks/shared-contexts');
    return {
        ...actual,
        useAdminAuth: jest.fn()
    };
});
// Mock shared components
jest.mock('@elzatona/shared-components', ()=>({
        AdminLoginNavbar: ()=>/*#__PURE__*/ (0, _jsxruntime.jsx)("nav", {
                "data-testid": "admin-login-navbar",
                children: "Admin Navbar"
            })
    }));
jest.mock('next/link', ()=>{
    return ({ children, href })=>{
        return /*#__PURE__*/ (0, _jsxruntime.jsx)("a", {
            href: href,
            children: children
        });
    };
});
jest.mock('next/navigation', ()=>({
        useRouter: ()=>({
                push: mockPush,
                replace: mockReplace,
                prefetch: jest.fn()
            }),
        usePathname: ()=>'/admin/login'
    }));
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _jsxruntime = require("react/jsx-runtime");
const _react = /*#__PURE__*/ _interop_require_default(require("react"));
const _react1 = require("@testing-library/react");
require("@testing-library/jest-dom");
const _page = /*#__PURE__*/ _interop_require_default(require("./page"));
const _sharedcontexts = /*#__PURE__*/ _interop_require_wildcard(require("../../../../../../libs/shared-contexts/src"));
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
const mockPush = jest.fn();
const mockReplace = jest.fn();
const mockLogin = jest.fn();
describe('A-IT-010: Login API Call', ()=>{
    beforeEach(()=>{
        jest.clearAllMocks();
        _sharedcontexts.useAdminAuth.mockReturnValue({
            isAuthenticated: false,
            isLoading: false,
            login: mockLogin,
            logout: jest.fn(),
            user: null
        });
    });
    it('should call login API with correct credentials', async ()=>{
        mockLogin.mockResolvedValue({
            success: true
        });
        (0, _react1.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_page.default, {}));
        const emailInput = _react1.screen.getByLabelText(/Email Address/i);
        const passwordInput = _react1.screen.getByLabelText(/Password/i);
        const submitButton = _react1.screen.getByRole('button', {
            name: /Sign In/i
        });
        const form = submitButton.closest('form');
        await (0, _react1.act)(async ()=>{
            _react1.fireEvent.change(emailInput, {
                target: {
                    value: 'admin@example.com'
                }
            });
            _react1.fireEvent.change(passwordInput, {
                target: {
                    value: 'password123'
                }
            });
            _react1.fireEvent.submit(form);
        });
        await (0, _react1.waitFor)(()=>{
            expect(mockLogin).toHaveBeenCalledWith('admin@example.com', 'password123');
        });
    });
    it('should handle successful login response', async ()=>{
        mockLogin.mockResolvedValue({
            success: true
        });
        _sharedcontexts.useAdminAuth.mockReturnValue({
            isAuthenticated: true,
            isLoading: false,
            login: mockLogin,
            logout: jest.fn(),
            user: {
                id: '1',
                email: 'admin@example.com',
                role: 'super_admin'
            }
        });
        (0, _react1.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_page.default, {}));
        const emailInput = _react1.screen.getByLabelText(/Email Address/i);
        const passwordInput = _react1.screen.getByLabelText(/Password/i);
        const submitButton = _react1.screen.getByRole('button', {
            name: /Sign In/i
        });
        const form = submitButton.closest('form');
        await (0, _react1.act)(async ()=>{
            _react1.fireEvent.change(emailInput, {
                target: {
                    value: 'admin@example.com'
                }
            });
            _react1.fireEvent.change(passwordInput, {
                target: {
                    value: 'password123'
                }
            });
            _react1.fireEvent.submit(form);
        });
        await (0, _react1.waitFor)(()=>{
            expect(mockLogin).toHaveBeenCalled();
        });
    });
    it('should handle login API error', async ()=>{
        mockLogin.mockResolvedValue({
            success: false,
            error: 'Invalid email or password'
        });
        (0, _react1.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_page.default, {}));
        const emailInput = _react1.screen.getByLabelText(/Email Address/i);
        const passwordInput = _react1.screen.getByLabelText(/Password/i);
        const submitButton = _react1.screen.getByRole('button', {
            name: /Sign In/i
        });
        const form = submitButton.closest('form');
        await (0, _react1.act)(async ()=>{
            _react1.fireEvent.change(emailInput, {
                target: {
                    value: 'wrong@example.com'
                }
            });
            _react1.fireEvent.change(passwordInput, {
                target: {
                    value: 'wrongpass'
                }
            });
            _react1.fireEvent.submit(form);
        });
        await (0, _react1.waitFor)(()=>{
            expect(_react1.screen.getByText(/Invalid email or password|Login failed/i)).toBeInTheDocument();
        });
    });
});
describe('A-IT-011: Redirect After Login', ()=>{
    beforeEach(()=>{
        jest.clearAllMocks();
        mockLogin.mockResolvedValue({
            success: true
        });
    });
    it('should redirect authenticated users away from login page', ()=>{
        _sharedcontexts.useAdminAuth.mockReturnValue({
            isAuthenticated: true,
            isLoading: false,
            login: mockLogin,
            logout: jest.fn(),
            user: {
                id: '1',
                email: 'admin@example.com'
            }
        });
        (0, _react1.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_page.default, {}));
        // AdminAuthContext should handle redirect via useEffect
        // This is tested in the context itself
        expect(mockReplace).toHaveBeenCalledWith('/admin/dashboard');
    });
    it('should not redirect unauthenticated users', ()=>{
        _sharedcontexts.useAdminAuth.mockReturnValue({
            isAuthenticated: false,
            isLoading: false,
            login: mockLogin,
            logout: jest.fn(),
            user: null
        });
        (0, _react1.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_page.default, {}));
        // Should not redirect if not authenticated
        expect(mockReplace).not.toHaveBeenCalled();
    });
});
describe('A-IT-012: Session Management', ()=>{
    beforeEach(()=>{
        jest.clearAllMocks();
        // Mock localStorage
        Storage.prototype.getItem = jest.fn(()=>null);
        Storage.prototype.setItem = jest.fn();
        Storage.prototype.removeItem = jest.fn();
    });
    it('should persist session after successful login', async ()=>{
        mockLogin.mockResolvedValue({
            success: true
        });
        _sharedcontexts.useAdminAuth.mockReturnValue({
            isAuthenticated: true,
            isLoading: false,
            login: mockLogin,
            logout: jest.fn(),
            user: {
                id: '1',
                email: 'admin@example.com'
            }
        });
        (0, _react1.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_page.default, {}));
        // Session should be persisted (handled by AdminAuthContext)
        expect(Storage.prototype.setItem).toHaveBeenCalled();
    });
    it('should check existing session on mount', ()=>{
        Storage.prototype.getItem = jest.fn(()=>JSON.stringify({
                user: {
                    id: '1',
                    email: 'admin@example.com'
                },
                session: {
                    access_token: 'token'
                }
            }));
        _sharedcontexts.useAdminAuth.mockReturnValue({
            isAuthenticated: true,
            isLoading: false,
            login: mockLogin,
            logout: jest.fn(),
            user: {
                id: '1',
                email: 'admin@example.com'
            }
        });
        (0, _react1.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_page.default, {}));
        // Should check localStorage for existing session
        expect(Storage.prototype.getItem).toHaveBeenCalled();
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hLmZvdWFkL1NpZGVQcm9qZWN0cy9FbHphdG9uYS1hbGwvRWx6YXRvbmEtd2ViL2FwcHMvd2Vic2l0ZS9zcmMvYXBwL2FkbWluL2xvZ2luL3BhZ2UuaW50ZWdyYXRpb24udGVzdC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBJbnRlZ3JhdGlvbiBUZXN0cyBmb3IgQWRtaW4gTG9naW4gKEEtSVQtMDEwLCBBLUlULTAxMSwgQS1JVC0wMTIpXG4gKiBUYXNrOiBBLTAwMiAtIEFkbWluIExvZ2luXG4gKi9cblxuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IHJlbmRlciwgc2NyZWVuLCBmaXJlRXZlbnQsIHdhaXRGb3IsIGFjdCB9IGZyb20gJ0B0ZXN0aW5nLWxpYnJhcnkvcmVhY3QnO1xuaW1wb3J0ICdAdGVzdGluZy1saWJyYXJ5L2plc3QtZG9tJztcbmltcG9ydCBBZG1pbkxvZ2luUGFnZSBmcm9tICcuL3BhZ2UnO1xuaW1wb3J0ICogYXMgc2hhcmVkQ29udGV4dHMgZnJvbSAnQGVsemF0b25hL3NoYXJlZC1jb250ZXh0cyc7XG5cbi8vIE1vY2sgc2hhcmVkIGNvbnRleHRzXG5qZXN0Lm1vY2soJ0BlbHphdG9uYS9zaGFyZWQtY29udGV4dHMnLCAoKSA9PiB7XG4gIGNvbnN0IGFjdHVhbCA9IGplc3QucmVxdWlyZUFjdHVhbCgnLi4vLi4vLi4vLi4vdGVzdC11dGlscy9tb2Nrcy9zaGFyZWQtY29udGV4dHMnKTtcbiAgcmV0dXJuIHtcbiAgICAuLi5hY3R1YWwsXG4gICAgdXNlQWRtaW5BdXRoOiBqZXN0LmZuKCksXG4gIH07XG59KTtcblxuLy8gTW9jayBzaGFyZWQgY29tcG9uZW50c1xuamVzdC5tb2NrKCdAZWx6YXRvbmEvc2hhcmVkLWNvbXBvbmVudHMnLCAoKSA9PiAoe1xuICBBZG1pbkxvZ2luTmF2YmFyOiAoKSA9PiA8bmF2IGRhdGEtdGVzdGlkPVwiYWRtaW4tbG9naW4tbmF2YmFyXCI+QWRtaW4gTmF2YmFyPC9uYXY+LFxufSkpO1xuXG5qZXN0Lm1vY2soJ25leHQvbGluaycsICgpID0+IHtcbiAgcmV0dXJuICh7IGNoaWxkcmVuLCBocmVmIH06IHsgY2hpbGRyZW46IFJlYWN0LlJlYWN0Tm9kZTsgaHJlZjogc3RyaW5nIH0pID0+IHtcbiAgICByZXR1cm4gPGEgaHJlZj17aHJlZn0+e2NoaWxkcmVufTwvYT47XG4gIH07XG59KTtcblxuY29uc3QgbW9ja1B1c2ggPSBqZXN0LmZuKCk7XG5jb25zdCBtb2NrUmVwbGFjZSA9IGplc3QuZm4oKTtcbmNvbnN0IG1vY2tMb2dpbiA9IGplc3QuZm4oKTtcblxuamVzdC5tb2NrKCduZXh0L25hdmlnYXRpb24nLCAoKSA9PiAoe1xuICB1c2VSb3V0ZXI6ICgpID0+ICh7XG4gICAgcHVzaDogbW9ja1B1c2gsXG4gICAgcmVwbGFjZTogbW9ja1JlcGxhY2UsXG4gICAgcHJlZmV0Y2g6IGplc3QuZm4oKSxcbiAgfSksXG4gIHVzZVBhdGhuYW1lOiAoKSA9PiAnL2FkbWluL2xvZ2luJyxcbn0pKTtcblxuZGVzY3JpYmUoJ0EtSVQtMDEwOiBMb2dpbiBBUEkgQ2FsbCcsICgpID0+IHtcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgXG4gICAgKHNoYXJlZENvbnRleHRzLnVzZUFkbWluQXV0aCBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICBpc0F1dGhlbnRpY2F0ZWQ6IGZhbHNlLFxuICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcbiAgICAgIGxvZ2luOiBtb2NrTG9naW4sXG4gICAgICBsb2dvdXQ6IGplc3QuZm4oKSxcbiAgICAgIHVzZXI6IG51bGwsXG4gICAgfSk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgY2FsbCBsb2dpbiBBUEkgd2l0aCBjb3JyZWN0IGNyZWRlbnRpYWxzJywgYXN5bmMgKCkgPT4ge1xuICAgIG1vY2tMb2dpbi5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHN1Y2Nlc3M6IHRydWUgfSk7XG4gICAgXG4gICAgcmVuZGVyKDxBZG1pbkxvZ2luUGFnZSAvPik7XG4gICAgY29uc3QgZW1haWxJbnB1dCA9IHNjcmVlbi5nZXRCeUxhYmVsVGV4dCgvRW1haWwgQWRkcmVzcy9pKTtcbiAgICBjb25zdCBwYXNzd29yZElucHV0ID0gc2NyZWVuLmdldEJ5TGFiZWxUZXh0KC9QYXNzd29yZC9pKTtcbiAgICBjb25zdCBzdWJtaXRCdXR0b24gPSBzY3JlZW4uZ2V0QnlSb2xlKCdidXR0b24nLCB7IG5hbWU6IC9TaWduIEluL2kgfSk7XG4gICAgY29uc3QgZm9ybSA9IHN1Ym1pdEJ1dHRvbi5jbG9zZXN0KCdmb3JtJyk7XG4gICAgXG4gICAgYXdhaXQgYWN0KGFzeW5jICgpID0+IHtcbiAgICAgIGZpcmVFdmVudC5jaGFuZ2UoZW1haWxJbnB1dCwgeyB0YXJnZXQ6IHsgdmFsdWU6ICdhZG1pbkBleGFtcGxlLmNvbScgfSB9KTtcbiAgICAgIGZpcmVFdmVudC5jaGFuZ2UocGFzc3dvcmRJbnB1dCwgeyB0YXJnZXQ6IHsgdmFsdWU6ICdwYXNzd29yZDEyMycgfSB9KTtcbiAgICAgIGZpcmVFdmVudC5zdWJtaXQoZm9ybSEpO1xuICAgIH0pO1xuICAgIFxuICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgZXhwZWN0KG1vY2tMb2dpbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2FkbWluQGV4YW1wbGUuY29tJywgJ3Bhc3N3b3JkMTIzJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgaGFuZGxlIHN1Y2Nlc3NmdWwgbG9naW4gcmVzcG9uc2UnLCBhc3luYyAoKSA9PiB7XG4gICAgbW9ja0xvZ2luLm1vY2tSZXNvbHZlZFZhbHVlKHsgc3VjY2VzczogdHJ1ZSB9KTtcbiAgICBcbiAgICAoc2hhcmVkQ29udGV4dHMudXNlQWRtaW5BdXRoIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKHtcbiAgICAgIGlzQXV0aGVudGljYXRlZDogdHJ1ZSxcbiAgICAgIGlzTG9hZGluZzogZmFsc2UsXG4gICAgICBsb2dpbjogbW9ja0xvZ2luLFxuICAgICAgbG9nb3V0OiBqZXN0LmZuKCksXG4gICAgICB1c2VyOiB7IGlkOiAnMScsIGVtYWlsOiAnYWRtaW5AZXhhbXBsZS5jb20nLCByb2xlOiAnc3VwZXJfYWRtaW4nIH0sXG4gICAgfSk7XG4gICAgXG4gICAgcmVuZGVyKDxBZG1pbkxvZ2luUGFnZSAvPik7XG4gICAgY29uc3QgZW1haWxJbnB1dCA9IHNjcmVlbi5nZXRCeUxhYmVsVGV4dCgvRW1haWwgQWRkcmVzcy9pKTtcbiAgICBjb25zdCBwYXNzd29yZElucHV0ID0gc2NyZWVuLmdldEJ5TGFiZWxUZXh0KC9QYXNzd29yZC9pKTtcbiAgICBjb25zdCBzdWJtaXRCdXR0b24gPSBzY3JlZW4uZ2V0QnlSb2xlKCdidXR0b24nLCB7IG5hbWU6IC9TaWduIEluL2kgfSk7XG4gICAgY29uc3QgZm9ybSA9IHN1Ym1pdEJ1dHRvbi5jbG9zZXN0KCdmb3JtJyk7XG4gICAgXG4gICAgYXdhaXQgYWN0KGFzeW5jICgpID0+IHtcbiAgICAgIGZpcmVFdmVudC5jaGFuZ2UoZW1haWxJbnB1dCwgeyB0YXJnZXQ6IHsgdmFsdWU6ICdhZG1pbkBleGFtcGxlLmNvbScgfSB9KTtcbiAgICAgIGZpcmVFdmVudC5jaGFuZ2UocGFzc3dvcmRJbnB1dCwgeyB0YXJnZXQ6IHsgdmFsdWU6ICdwYXNzd29yZDEyMycgfSB9KTtcbiAgICAgIGZpcmVFdmVudC5zdWJtaXQoZm9ybSEpO1xuICAgIH0pO1xuICAgIFxuICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgZXhwZWN0KG1vY2tMb2dpbikudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGhhbmRsZSBsb2dpbiBBUEkgZXJyb3InLCBhc3luYyAoKSA9PiB7XG4gICAgbW9ja0xvZ2luLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6ICdJbnZhbGlkIGVtYWlsIG9yIHBhc3N3b3JkJyxcbiAgICB9KTtcbiAgICBcbiAgICByZW5kZXIoPEFkbWluTG9naW5QYWdlIC8+KTtcbiAgICBjb25zdCBlbWFpbElucHV0ID0gc2NyZWVuLmdldEJ5TGFiZWxUZXh0KC9FbWFpbCBBZGRyZXNzL2kpO1xuICAgIGNvbnN0IHBhc3N3b3JkSW5wdXQgPSBzY3JlZW4uZ2V0QnlMYWJlbFRleHQoL1Bhc3N3b3JkL2kpO1xuICAgIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IHNjcmVlbi5nZXRCeVJvbGUoJ2J1dHRvbicsIHsgbmFtZTogL1NpZ24gSW4vaSB9KTtcbiAgICBjb25zdCBmb3JtID0gc3VibWl0QnV0dG9uLmNsb3Nlc3QoJ2Zvcm0nKTtcbiAgICBcbiAgICBhd2FpdCBhY3QoYXN5bmMgKCkgPT4ge1xuICAgICAgZmlyZUV2ZW50LmNoYW5nZShlbWFpbElucHV0LCB7IHRhcmdldDogeyB2YWx1ZTogJ3dyb25nQGV4YW1wbGUuY29tJyB9IH0pO1xuICAgICAgZmlyZUV2ZW50LmNoYW5nZShwYXNzd29yZElucHV0LCB7IHRhcmdldDogeyB2YWx1ZTogJ3dyb25ncGFzcycgfSB9KTtcbiAgICAgIGZpcmVFdmVudC5zdWJtaXQoZm9ybSEpO1xuICAgIH0pO1xuICAgIFxuICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRleHQoL0ludmFsaWQgZW1haWwgb3IgcGFzc3dvcmR8TG9naW4gZmFpbGVkL2kpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnQS1JVC0wMTE6IFJlZGlyZWN0IEFmdGVyIExvZ2luJywgKCkgPT4ge1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgICBtb2NrTG9naW4ubW9ja1Jlc29sdmVkVmFsdWUoeyBzdWNjZXNzOiB0cnVlIH0pO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHJlZGlyZWN0IGF1dGhlbnRpY2F0ZWQgdXNlcnMgYXdheSBmcm9tIGxvZ2luIHBhZ2UnLCAoKSA9PiB7XG4gICAgKHNoYXJlZENvbnRleHRzLnVzZUFkbWluQXV0aCBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICBpc0F1dGhlbnRpY2F0ZWQ6IHRydWUsXG4gICAgICBpc0xvYWRpbmc6IGZhbHNlLFxuICAgICAgbG9naW46IG1vY2tMb2dpbixcbiAgICAgIGxvZ291dDogamVzdC5mbigpLFxuICAgICAgdXNlcjogeyBpZDogJzEnLCBlbWFpbDogJ2FkbWluQGV4YW1wbGUuY29tJyB9LFxuICAgIH0pO1xuICAgIFxuICAgIHJlbmRlcig8QWRtaW5Mb2dpblBhZ2UgLz4pO1xuICAgIFxuICAgIC8vIEFkbWluQXV0aENvbnRleHQgc2hvdWxkIGhhbmRsZSByZWRpcmVjdCB2aWEgdXNlRWZmZWN0XG4gICAgLy8gVGhpcyBpcyB0ZXN0ZWQgaW4gdGhlIGNvbnRleHQgaXRzZWxmXG4gICAgZXhwZWN0KG1vY2tSZXBsYWNlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnL2FkbWluL2Rhc2hib2FyZCcpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIG5vdCByZWRpcmVjdCB1bmF1dGhlbnRpY2F0ZWQgdXNlcnMnLCAoKSA9PiB7XG4gICAgKHNoYXJlZENvbnRleHRzLnVzZUFkbWluQXV0aCBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICBpc0F1dGhlbnRpY2F0ZWQ6IGZhbHNlLFxuICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcbiAgICAgIGxvZ2luOiBtb2NrTG9naW4sXG4gICAgICBsb2dvdXQ6IGplc3QuZm4oKSxcbiAgICAgIHVzZXI6IG51bGwsXG4gICAgfSk7XG4gICAgXG4gICAgcmVuZGVyKDxBZG1pbkxvZ2luUGFnZSAvPik7XG4gICAgXG4gICAgLy8gU2hvdWxkIG5vdCByZWRpcmVjdCBpZiBub3QgYXV0aGVudGljYXRlZFxuICAgIGV4cGVjdChtb2NrUmVwbGFjZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ0EtSVQtMDEyOiBTZXNzaW9uIE1hbmFnZW1lbnQnLCAoKSA9PiB7XG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIFxuICAgIC8vIE1vY2sgbG9jYWxTdG9yYWdlXG4gICAgU3RvcmFnZS5wcm90b3R5cGUuZ2V0SXRlbSA9IGplc3QuZm4oKCkgPT4gbnVsbCk7XG4gICAgU3RvcmFnZS5wcm90b3R5cGUuc2V0SXRlbSA9IGplc3QuZm4oKTtcbiAgICBTdG9yYWdlLnByb3RvdHlwZS5yZW1vdmVJdGVtID0gamVzdC5mbigpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHBlcnNpc3Qgc2Vzc2lvbiBhZnRlciBzdWNjZXNzZnVsIGxvZ2luJywgYXN5bmMgKCkgPT4ge1xuICAgIG1vY2tMb2dpbi5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHN1Y2Nlc3M6IHRydWUgfSk7XG4gICAgXG4gICAgKHNoYXJlZENvbnRleHRzLnVzZUFkbWluQXV0aCBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICBpc0F1dGhlbnRpY2F0ZWQ6IHRydWUsXG4gICAgICBpc0xvYWRpbmc6IGZhbHNlLFxuICAgICAgbG9naW46IG1vY2tMb2dpbixcbiAgICAgIGxvZ291dDogamVzdC5mbigpLFxuICAgICAgdXNlcjogeyBpZDogJzEnLCBlbWFpbDogJ2FkbWluQGV4YW1wbGUuY29tJyB9LFxuICAgIH0pO1xuICAgIFxuICAgIHJlbmRlcig8QWRtaW5Mb2dpblBhZ2UgLz4pO1xuICAgIFxuICAgIC8vIFNlc3Npb24gc2hvdWxkIGJlIHBlcnNpc3RlZCAoaGFuZGxlZCBieSBBZG1pbkF1dGhDb250ZXh0KVxuICAgIGV4cGVjdChTdG9yYWdlLnByb3RvdHlwZS5zZXRJdGVtKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgY2hlY2sgZXhpc3Rpbmcgc2Vzc2lvbiBvbiBtb3VudCcsICgpID0+IHtcbiAgICBTdG9yYWdlLnByb3RvdHlwZS5nZXRJdGVtID0gamVzdC5mbigoKSA9PiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICB1c2VyOiB7IGlkOiAnMScsIGVtYWlsOiAnYWRtaW5AZXhhbXBsZS5jb20nIH0sXG4gICAgICBzZXNzaW9uOiB7IGFjY2Vzc190b2tlbjogJ3Rva2VuJyB9LFxuICAgIH0pKTtcbiAgICBcbiAgICAoc2hhcmVkQ29udGV4dHMudXNlQWRtaW5BdXRoIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKHtcbiAgICAgIGlzQXV0aGVudGljYXRlZDogdHJ1ZSxcbiAgICAgIGlzTG9hZGluZzogZmFsc2UsXG4gICAgICBsb2dpbjogbW9ja0xvZ2luLFxuICAgICAgbG9nb3V0OiBqZXN0LmZuKCksXG4gICAgICB1c2VyOiB7IGlkOiAnMScsIGVtYWlsOiAnYWRtaW5AZXhhbXBsZS5jb20nIH0sXG4gICAgfSk7XG4gICAgXG4gICAgcmVuZGVyKDxBZG1pbkxvZ2luUGFnZSAvPik7XG4gICAgXG4gICAgLy8gU2hvdWxkIGNoZWNrIGxvY2FsU3RvcmFnZSBmb3IgZXhpc3Rpbmcgc2Vzc2lvblxuICAgIGV4cGVjdChTdG9yYWdlLnByb3RvdHlwZS5nZXRJdGVtKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gIH0pO1xufSk7XG4iXSwibmFtZXMiOlsiamVzdCIsIm1vY2siLCJhY3R1YWwiLCJyZXF1aXJlQWN0dWFsIiwidXNlQWRtaW5BdXRoIiwiZm4iLCJBZG1pbkxvZ2luTmF2YmFyIiwibmF2IiwiZGF0YS10ZXN0aWQiLCJjaGlsZHJlbiIsImhyZWYiLCJhIiwidXNlUm91dGVyIiwicHVzaCIsIm1vY2tQdXNoIiwicmVwbGFjZSIsIm1vY2tSZXBsYWNlIiwicHJlZmV0Y2giLCJ1c2VQYXRobmFtZSIsIm1vY2tMb2dpbiIsImRlc2NyaWJlIiwiYmVmb3JlRWFjaCIsImNsZWFyQWxsTW9ja3MiLCJzaGFyZWRDb250ZXh0cyIsIm1vY2tSZXR1cm5WYWx1ZSIsImlzQXV0aGVudGljYXRlZCIsImlzTG9hZGluZyIsImxvZ2luIiwibG9nb3V0IiwidXNlciIsIml0IiwibW9ja1Jlc29sdmVkVmFsdWUiLCJzdWNjZXNzIiwicmVuZGVyIiwiQWRtaW5Mb2dpblBhZ2UiLCJlbWFpbElucHV0Iiwic2NyZWVuIiwiZ2V0QnlMYWJlbFRleHQiLCJwYXNzd29yZElucHV0Iiwic3VibWl0QnV0dG9uIiwiZ2V0QnlSb2xlIiwibmFtZSIsImZvcm0iLCJjbG9zZXN0IiwiYWN0IiwiZmlyZUV2ZW50IiwiY2hhbmdlIiwidGFyZ2V0IiwidmFsdWUiLCJzdWJtaXQiLCJ3YWl0Rm9yIiwiZXhwZWN0IiwidG9IYXZlQmVlbkNhbGxlZFdpdGgiLCJpZCIsImVtYWlsIiwicm9sZSIsInRvSGF2ZUJlZW5DYWxsZWQiLCJlcnJvciIsImdldEJ5VGV4dCIsInRvQmVJblRoZURvY3VtZW50Iiwibm90IiwiU3RvcmFnZSIsInByb3RvdHlwZSIsImdldEl0ZW0iLCJzZXRJdGVtIiwicmVtb3ZlSXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJzZXNzaW9uIiwiYWNjZXNzX3Rva2VuIl0sIm1hcHBpbmdzIjoiQUFBQTs7O0NBR0M7QUFRRCx1QkFBdUI7QUFDdkJBLEtBQUtDLElBQUksQ0FBQyw2QkFBNkI7SUFDckMsTUFBTUMsU0FBU0YsS0FBS0csYUFBYSxDQUFDO0lBQ2xDLE9BQU87UUFDTCxHQUFHRCxNQUFNO1FBQ1RFLGNBQWNKLEtBQUtLLEVBQUU7SUFDdkI7QUFDRjtBQUVBLHlCQUF5QjtBQUN6QkwsS0FBS0MsSUFBSSxDQUFDLCtCQUErQixJQUFPLENBQUE7UUFDOUNLLGtCQUFrQixrQkFBTSxxQkFBQ0M7Z0JBQUlDLGVBQVk7MEJBQXFCOztJQUNoRSxDQUFBO0FBRUFSLEtBQUtDLElBQUksQ0FBQyxhQUFhO0lBQ3JCLE9BQU8sQ0FBQyxFQUFFUSxRQUFRLEVBQUVDLElBQUksRUFBK0M7UUFDckUscUJBQU8scUJBQUNDO1lBQUVELE1BQU1BO3NCQUFPRDs7SUFDekI7QUFDRjtBQU1BVCxLQUFLQyxJQUFJLENB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