{"version":3,"sources":["/Users/a.fouad/SideProjects/Elzatona-all/Elzatona-web/apps/website/src/app/api/admin/problem-solving/route.ts"],"sourcesContent":["// v1.0 - API routes for problem solving tasks CRUD operations\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;\nconst supabase = createClient(supabaseUrl, supabaseServiceRoleKey);\nimport {\n  ProblemSolvingTask,\n  ProblemSolvingTaskFormData,\n  ApiResponse,\n  PaginatedResponse,\n} from '../../../../types/admin';\n\n// GET /api/admin/problem-solving - List all problem solving tasks\nexport async function GET(request: NextRequest) {\n  try {\n    console.log('üîÑ API: Fetching problem solving tasks...');\n\n    const { searchParams } = new URL(request.url);\n    const page = parseInt(searchParams.get('page') || '1');\n    const limit = parseInt(searchParams.get('limit') || '10');\n    const search = searchParams.get('search') || '';\n    const category = searchParams.get('category') || '';\n    const difficulty = searchParams.get('difficulty') || '';\n\n    // Fetch tasks from Supabase\n    let query = supabase\n      .from('problem_solving')\n      .select('*')\n      .order('created_at', { ascending: false });\n\n    // Apply filters\n    if (category) {\n      query = query.eq('category', category);\n    }\n    if (difficulty) {\n      query = query.eq('difficulty', difficulty);\n    }\n\n    const { data: snapshot, error } = await query;\n\n    if (error) {\n      throw error;\n    }\n\n    let data: ProblemSolvingTask[] = snapshot.map(doc => ({\n      id: doc.id,\n      ...doc,\n    })) as ProblemSolvingTask[];\n\n    // Apply search filter (client-side since Supabase doesn't support full-text search)\n    if (search) {\n      const lowerSearch = search.toLowerCase();\n      data = data.filter(\n        task =>\n          task.title.toLowerCase().includes(lowerSearch) ||\n          task.description.toLowerCase().includes(lowerSearch) ||\n          task.category.toLowerCase().includes(lowerSearch) ||\n          task.tags.some(tag => tag.toLowerCase().includes(lowerSearch))\n      );\n    }\n\n    // Client-side pagination\n    const startIndex = (page - 1) * limit;\n    const endIndex = startIndex + limit;\n    const paginatedData = data.slice(startIndex, endIndex);\n\n    console.log(\n      `üìä API: Problem solving tasks fetched: ${data.length} total, ${paginatedData.length} returned`\n    );\n\n    const response: PaginatedResponse<ProblemSolvingTask> = {\n      success: true,\n      data: paginatedData,\n      total: data.length,\n      page,\n      limit,\n      hasMore: endIndex < data.length,\n    };\n\n    return NextResponse.json(response);\n  } catch (error) {\n    console.error('‚ùå API: Error fetching problem solving tasks:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to fetch problem solving tasks' },\n      { status: 500 }\n    );\n  }\n}\n\n// POST /api/admin/problem-solving - Create new problem solving task\nexport async function POST(request: NextRequest) {\n  try {\n    console.log('üîÑ API: Creating new problem solving task...');\n\n    const body: ProblemSolvingTaskFormData = await request.json();\n\n    // Validate required fields\n    if (\n      !body.title ||\n      !body.description ||\n      !body.category ||\n      !body.functionName\n    ) {\n      return NextResponse.json(\n        { success: false, error: 'Missing required fields' },\n        { status: 400 }\n      );\n    }\n\n    // Validate test cases\n    if (!body.testCases || body.testCases.length === 0) {\n      return NextResponse.json(\n        { success: false, error: 'At least one test case is required' },\n        { status: 400 }\n      );\n    }\n\n    // Create the task data\n    const taskData = {\n      ...body,\n      is_active: true,\n      created_at: new Date().toISOString(),\n      updated_at: new Date().toISOString(),\n    };\n\n    // Add to Supabase\n    const { data: newTask, error } = await supabase\n      .from('problem_solving')\n      .insert(taskData)\n      .select()\n      .single();\n\n    if (error) {\n      throw error;\n    }\n\n    console.log(`‚úÖ API: Problem solving task created with ID: ${newTask.id}`);\n\n    const response: ApiResponse<{ id: string }> = {\n      success: true,\n      data: { id: newTask.id },\n    };\n\n    return NextResponse.json(response, { status: 201 });\n  } catch (error) {\n    console.error('‚ùå API: Error creating problem solving task:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to create problem solving task' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":["GET","POST","supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","supabaseServiceRoleKey","SUPABASE_SERVICE_ROLE_KEY","supabase","createClient","request","console","log","searchParams","URL","url","page","parseInt","get","limit","search","category","difficulty","query","from","select","order","ascending","eq","data","snapshot","error","map","doc","id","lowerSearch","toLowerCase","filter","task","title","includes","description","tags","some","tag","startIndex","endIndex","paginatedData","slice","length","response","success","total","hasMore","NextResponse","json","status","body","functionName","testCases","taskData","is_active","created_at","Date","toISOString","updated_at","newTask","insert","single"],"mappings":"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"}