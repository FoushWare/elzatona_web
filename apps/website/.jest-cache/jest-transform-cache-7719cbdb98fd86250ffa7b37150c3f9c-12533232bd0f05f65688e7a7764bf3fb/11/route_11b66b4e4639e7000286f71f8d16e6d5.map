{"version":3,"sources":["/Users/a.fouad/SideProjects/Elzatona-all/Elzatona-web/apps/website/src/app/api/admin/problem-solving/[id]/route.ts"],"sourcesContent":["// v1.0 - API routes for individual problem solving task operations\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;\nconst supabase = createClient(supabaseUrl, supabaseServiceRoleKey);\nimport {\n  ProblemSolvingTask,\n  ProblemSolvingTaskFormData,\n  ApiResponse,\n} from '../../../../../types/admin';\n\n// GET /api/admin/problem-solving/[id] - Get specific problem solving task\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    console.log('üîÑ API: Fetching problem solving task by ID...');\n\n    const { id } = await params;\n\n    if (!id) {\n      return NextResponse.json(\n        { success: false, error: 'Task ID is required' },\n        { status: 400 }\n      );\n    }\n\n    // Fetch task from Supabase\n    const { data: taskDoc, error } = await supabase\n      .from('problem_solving')\n      .select()\n      .eq('id', id)\n      .single();\n\n    if (error || !taskDoc) {\n      return NextResponse.json(\n        { success: false, error: 'Task not found' },\n        { status: 404 }\n      );\n    }\n\n    const taskData = {\n      id: taskDoc.id,\n      ...taskDoc,\n    } as ProblemSolvingTask;\n\n    console.log(`‚úÖ API: Problem solving task fetched: ${taskData.title}`);\n\n    const response: ApiResponse<ProblemSolvingTask> = {\n      success: true,\n      data: taskData,\n    };\n\n    return NextResponse.json(response);\n  } catch (error) {\n    console.error('‚ùå API: Error fetching problem solving task:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to fetch problem solving task' },\n      { status: 500 }\n    );\n  }\n}\n\n// PUT /api/admin/problem-solving/[id] - Update problem solving task\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    console.log('üîÑ API: Updating problem solving task...');\n\n    const { id } = await params;\n    const body: Partial<ProblemSolvingTaskFormData> = await request.json();\n\n    if (!id) {\n      return NextResponse.json(\n        { success: false, error: 'Task ID is required' },\n        { status: 400 }\n      );\n    }\n\n    // Check if task exists\n    const { data: taskDoc, error } = await supabase\n      .from('problem_solving')\n      .select()\n      .eq('id', id)\n      .single();\n\n    if (error || !taskDoc) {\n      return NextResponse.json(\n        { success: false, error: 'Task not found' },\n        { status: 404 }\n      );\n    }\n\n    // Update task in Supabase\n    const { error: updateError } = await supabase\n      .from('problem_solving')\n      .update({\n        ...body,\n        updated_at: new Date().toISOString(),\n      })\n      .eq('id', id);\n\n    if (updateError) {\n      throw updateError;\n    }\n\n    console.log(`‚úÖ API: Problem solving task updated: ${id}`);\n\n    const response: ApiResponse<{ id: string }> = {\n      success: true,\n      data: { id },\n    };\n\n    return NextResponse.json(response);\n  } catch (error) {\n    console.error('‚ùå API: Error updating problem solving task:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to update problem solving task' },\n      { status: 500 }\n    );\n  }\n}\n\n// DELETE /api/admin/problem-solving/[id] - Delete problem solving task (soft delete)\nexport async function DELETE(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    console.log('üîÑ API: Deleting problem solving task...');\n\n    const { id } = await params;\n\n    if (!id) {\n      return NextResponse.json(\n        { success: false, error: 'Task ID is required' },\n        { status: 400 }\n      );\n    }\n\n    // Check if task exists\n    const { data: taskDoc, error } = await supabase\n      .from('problem_solving')\n      .select()\n      .eq('id', id)\n      .single();\n\n    if (error || !taskDoc) {\n      return NextResponse.json(\n        { success: false, error: 'Task not found' },\n        { status: 404 }\n      );\n    }\n\n    // Soft delete by setting is_active to false\n    const { error: updateError } = await supabase\n      .from('problem_solving')\n      .update({\n        is_active: false,\n        updated_at: new Date().toISOString(),\n      })\n      .eq('id', id);\n\n    if (updateError) {\n      throw updateError;\n    }\n\n    console.log(`‚úÖ API: Problem solving task deleted: ${id}`);\n\n    const response: ApiResponse<{ id: string }> = {\n      success: true,\n      data: { id },\n    };\n\n    return NextResponse.json(response);\n  } catch (error) {\n    console.error('‚ùå API: Error deleting problem solving task:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to delete problem solving task' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":["DELETE","GET","PUT","supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","supabaseServiceRoleKey","SUPABASE_SERVICE_ROLE_KEY","supabase","createClient","request","params","console","log","id","NextResponse","json","success","error","status","data","taskDoc","from","select","eq","single","taskData","title","response","body","updateError","update","updated_at","Date","toISOString","is_active"],"mappings":"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"}