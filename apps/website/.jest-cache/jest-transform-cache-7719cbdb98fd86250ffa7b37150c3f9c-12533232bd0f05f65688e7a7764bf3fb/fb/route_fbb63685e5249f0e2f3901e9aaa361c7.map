{"version":3,"sources":["/Users/a.fouad/SideProjects/Elzatona-all/Elzatona-web/apps/website/src/app/api/categories/route.ts"],"sourcesContent":["// Categories API Route\n// v1.0 - Category management for topics and questions\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { supabaseOperations } from '../../../lib/supabase-server';\nimport { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;\nconst supabase = createClient(supabaseUrl, supabaseServiceRoleKey);\n\nexport interface Category {\n  id: string;\n  name: string;\n  description?: string;\n  color?: string;\n  created_at: Date;\n  updated_at: Date;\n}\n\n// GET /api/categories - Get all categories\nexport async function GET() {\n  try {\n    const { data: categories, error } = await supabase\n      .from('categories')\n      .select('*')\n      .eq('is_active', true)\n      .order('order_index', { ascending: true });\n\n    if (error) {\n      throw new Error(error.message);\n    }\n\n    // Transform data to match expected format\n    const transformedCategories =\n      categories?.map(category => ({\n        id: category.id,\n        name: category.name,\n        description: category.description,\n        color: category.color,\n        icon: category.icon,\n        orderIndex: category.order_index,\n        is_active: category.is_active,\n        learning_card_id: category.learning_card_id || null,\n        card_type: category.card_type || null,\n        cardType: category.card_type || null, // Also include camelCase for compatibility\n        created_at: new Date(category.created_at),\n        updated_at: new Date(category.updated_at),\n      })) || [];\n\n    return NextResponse.json({\n      success: true,\n      data: transformedCategories,\n      count: transformedCategories.length,\n    });\n  } catch (error) {\n    console.error('Error fetching categories:', error);\n    return NextResponse.json(\n      {\n        success: false,\n        error: 'Failed to fetch categories',\n      },\n      { status: 500 }\n    );\n  }\n}\n\n// POST /api/categories - Create a new category\nexport async function POST(request: NextRequest) {\n  try {\n    const categoryData = await request.json();\n\n    // Validate required fields\n    if (!categoryData.name || categoryData.name.trim() === '') {\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'Category name is required',\n        },\n        { status: 400 }\n      );\n    }\n\n    // Transform data to match Supabase schema\n    const supabaseCategoryData = {\n      name: categoryData.name,\n      description: categoryData.description || '',\n      slug:\n        categoryData.slug ||\n        categoryData.name.toLowerCase().replace(/\\s+/g, '-'),\n      icon: categoryData.icon || 'üìÅ',\n      color: categoryData.color || '#3B82F6',\n      order_index: categoryData.orderIndex || categoryData.order_index || 0,\n      is_active: categoryData.isActive !== false,\n    };\n\n    const { data: newCategory, error } = await supabase\n      .from('categories')\n      .insert(supabaseCategoryData)\n      .select()\n      .single();\n\n    if (error) {\n      throw new Error(error.message);\n    }\n\n    if (!newCategory) {\n      throw new Error('No category was created');\n    }\n\n    // Transform response to match expected format\n    const transformedCategory = {\n      id: newCategory.id,\n      name: newCategory.name,\n      description: newCategory.description,\n      color: newCategory.color,\n      icon: newCategory.icon,\n      orderIndex: newCategory.order_index,\n      is_active: newCategory.is_active,\n      created_at: new Date(newCategory.created_at),\n      updated_at: new Date(newCategory.updated_at),\n    };\n\n    return NextResponse.json({\n      success: true,\n      data: transformedCategory,\n      message: 'Category created successfully',\n    });\n  } catch (error) {\n    console.error('Error creating category:', error);\n    return NextResponse.json(\n      {\n        success: false,\n        error:\n          error instanceof Error ? error.message : 'Failed to create category',\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":["GET","POST","supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","supabaseServiceRoleKey","SUPABASE_SERVICE_ROLE_KEY","supabase","createClient","data","categories","error","from","select","eq","order","ascending","Error","message","transformedCategories","map","category","id","name","description","color","icon","orderIndex","order_index","is_active","learning_card_id","card_type","cardType","created_at","Date","updated_at","NextResponse","json","success","count","length","console","status","request","categoryData","trim","supabaseCategoryData","slug","toLowerCase","replace","isActive","newCategory","insert","single","transformedCategory"],"mappings":"AAAA,uBAAuB;AACvB,sDAAsD;;;;;;;;;;;;QAoBhCA;eAAAA;;QA+CAC;eAAAA;;;wBAjEoB;4BAEb;AAE7B,MAAMC,cAAcC,QAAQC,GAAG,CAACC,wBAAwB;AACxD,MAAMC,yBAAyBH,QAAQC,GAAG,CAACG,yBAAyB;AACpE,MAAMC,WAAWC,IAAAA,wBAAY,EAACP,aAAaI;AAYpC,eAAeN;IACpB,IAAI;QACF,MAAM,EAAEU,MAAMC,UAAU,EAAEC,KAAK,EAAE,GAAG,MAAMJ,SACvCK,IAAI,CAAC,cACLC,MAAM,CAAC,KACPC,EAAE,CAAC,aAAa,MAChBC,KAAK,CAAC,eAAe;YAAEC,WAAW;QAAK;QAE1C,IAAIL,OAAO;YACT,MAAM,IAAIM,MAAMN,MAAMO,OAAO;QAC/B;QAEA,0CAA0C;QAC1C,MAAMC,wBACJT,YAAYU,IAAIC,CAAAA,WAAa,CAAA;gBAC3BC,IAAID,SAASC,EAAE;gBACfC,MAAMF,SAASE,IAAI;gBACnBC,aAAaH,SAASG,WAAW;gBACjCC,OAAOJ,SAASI,KAAK;gBACrBC,MAAML,SAASK,IAAI;gBACnBC,YAAYN,SAASO,WAAW;gBAChCC,WAAWR,SAASQ,SAAS;gBAC7BC,kBAAkBT,SAASS,gBAAgB,IAAI;gBAC/CC,WAAWV,SAASU,SAAS,IAAI;gBACjCC,UAAUX,SAASU,SAAS,IAAI;gBAChCE,YAAY,IAAIC,KAAKb,SAASY,UAAU;gBACxCE,YAAY,IAAID,KAAKb,SAASc,UAAU;YAC1C,CAAA,MAAO,EAAE;QAEX,OAAOC,oBAAY,CAACC,IAAI,CAAC;YACvBC,SAAS;YACT7B,MAAMU;YACNoB,OAAOpB,sBAAsBqB,MAAM;QACrC;IACF,EAAE,OAAO7B,OAAO;QACd8B,QAAQ9B,KAAK,CAAC,8BAA8BA;QAC5C,OAAOyB,oBAAY,CAACC,IAAI,CACtB;YACEC,SAAS;YACT3B,OAAO;QACT,GACA;YAAE+B,QAAQ;QAAI;IAElB;AACF;AAGO,eAAe1C,KAAK2C,OAAoB;IAC7C,IAAI;QACF,MAAMC,eAAe,MAAMD,QAAQN,IAAI;QAEvC,2BAA2B;QAC3B,IAAI,CAACO,aAAarB,IAAI,IAAIqB,aAAarB,IAAI,CAACsB,IAAI,OAAO,IAAI;YACzD,OAAOT,oBAAY,CAACC,IAAI,CACtB;gBACEC,SAAS;gBACT3B,OAAO;YACT,GACA;gBAAE+B,QAAQ;YAAI;QAElB;QAEA,0CAA0C;QAC1C,MAAMI,uBAAuB;YAC3BvB,MAAMqB,aAAarB,IAAI;YACvBC,aAAaoB,aAAapB,WAAW,IAAI;YACzCuB,MACEH,aAAaG,IAAI,IACjBH,aAAarB,IAAI,CAACyB,WAAW,GAAGC,OAAO,CAAC,QAAQ;YAClDvB,MAAMkB,aAAalB,IAAI,IAAI;YAC3BD,OAAOmB,aAAanB,KAAK,IAAI;YAC7BG,aAAagB,aAAajB,UAAU,IAAIiB,aAAahB,WAAW,IAAI;YACpEC,WAAWe,aAAaM,QAAQ,KAAK;QACvC;QAEA,MAAM,EAAEzC,MAAM0C,WAAW,EAAExC,KAAK,EAAE,GAAG,MAAMJ,SACxCK,IAAI,CAAC,cACLwC,MAAM,CAACN,sBACPjC,MAAM,GACNwC,MAAM;QAET,IAAI1C,OAAO;YACT,MAAM,IAAIM,MAAMN,MAAMO,OAAO;QAC/B;QAEA,IAAI,CAACiC,aAAa;YAChB,MAAM,IAAIlC,MAAM;QAClB;QAEA,8CAA8C;QAC9C,MAAMqC,sBAAsB;YAC1BhC,IAAI6B,YAAY7B,EAAE;YAClBC,MAAM4B,YAAY5B,IAAI;YACtBC,aAAa2B,YAAY3B,WAAW;YACpCC,OAAO0B,YAAY1B,KAAK;YACxBC,MAAMyB,YAAYzB,IAAI;YACtBC,YAAYwB,YAAYvB,WAAW;YACnCC,WAAWsB,YAAYtB,SAAS;YAChCI,YAAY,IAAIC,KAAKiB,YAAYlB,UAAU;YAC3CE,YAAY,IAAID,KAAKiB,YAAYhB,UAAU;QAC7C;QAEA,OAAOC,oBAAY,CAACC,IAAI,CAAC;YACvBC,SAAS;YACT7B,MAAM6C;YACNpC,SAAS;QACX;IACF,EAAE,OAAOP,OAAO;QACd8B,QAAQ9B,KAAK,CAAC,4BAA4BA;QAC1C,OAAOyB,oBAAY,CAACC,IAAI,CACtB;YACEC,SAAS;YACT3B,OACEA,iBAAiBM,QAAQN,MAAMO,OAAO,GAAG;QAC7C,GACA;YAAEwB,QAAQ;QAAI;IAElB;AACF"}