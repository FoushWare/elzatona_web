{"version":3,"sources":["/Users/a.fouad/SideProjects/Elzatona-all/Elzatona-web/apps/website/src/app/api/topics/route.ts"],"sourcesContent":["// Topics API Route\n// v2.0 - Enhanced topic management\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { supabaseOperations } from '../../../lib/supabase-server';\n\n// GET /api/topics - Get all topics\nexport async function GET() {\n  try {\n    console.log('üîÑ API: Fetching topics...');\n\n    const { data: topics, error } = await supabaseOperations.getTopics({\n      isActive: true,\n      orderBy: 'order_index',\n      orderDirection: 'asc',\n    });\n\n    if (error) {\n      throw new Error(error.message);\n    }\n\n    // Transform data to match expected format\n    const transformedTopics =\n      (topics as any[])?.map(topic => ({\n        id: topic.id,\n        name: topic.name,\n        slug: topic.slug,\n        description: topic.description,\n        category: topic.category_id,\n        categoryId: topic.category_id,\n        orderIndex: topic.order_index,\n        is_active: topic.is_active,\n        created_at: new Date(topic.created_at),\n        updated_at: new Date(topic.updated_at),\n      })) || [];\n\n    console.log('üìä API: Topics fetched:', transformedTopics.length, 'topics');\n    console.log('üìä API: Topics data:', transformedTopics);\n\n    return NextResponse.json({\n      success: true,\n      data: transformedTopics,\n      count: transformedTopics.length,\n    });\n  } catch (error) {\n    console.error('‚ùå API: Error fetching topics:', error);\n    return NextResponse.json(\n      {\n        success: false,\n        error: 'Failed to fetch topics',\n      },\n      { status: 500 }\n    );\n  }\n}\n\n// POST /api/topics - Create a new topic\nexport async function POST(request: NextRequest) {\n  try {\n    const topicData = await request.json();\n    console.log('üîÑ API: Creating topic with data:', topicData);\n\n    // Validate required fields\n    const requiredFields = ['name', 'description'];\n    for (const field of requiredFields) {\n      if (!topicData[field]) {\n        console.error('‚ùå API: Missing required field:', field);\n        return NextResponse.json(\n          {\n            success: false,\n            error: `Missing required field: ${field}`,\n          },\n          { status: 400 }\n        );\n      }\n    }\n\n    console.log('‚úÖ API: All required fields present, creating topic...');\n\n    // Transform data to match Supabase schema\n    const supabaseTopicData = {\n      name: topicData.name,\n      description: topicData.description,\n      category_id: topicData.category || topicData.categoryId || null,\n      order_index: topicData.orderIndex || 0,\n      is_active: topicData.isActive !== false,\n    };\n\n    const { data: newTopic, error } =\n      await supabaseOperations.createTopic(supabaseTopicData);\n\n    if (error) {\n      throw new Error(error.message);\n    }\n\n    console.log('‚úÖ API: Topic created with ID:', (newTopic as any).id);\n\n    // Transform response to match expected format\n    const transformedTopic = {\n      id: (newTopic as any).id,\n      name: (newTopic as any).name,\n      description: (newTopic as any).description,\n      category: (newTopic as any).category_id,\n      categoryId: (newTopic as any).category_id,\n      orderIndex: (newTopic as any).order_index,\n      is_active: (newTopic as any).is_active,\n      created_at: new Date((newTopic as any).created_at),\n      updated_at: new Date((newTopic as any).updated_at),\n    };\n\n    return NextResponse.json({\n      success: true,\n      data: transformedTopic,\n      message: 'Topic created successfully',\n    });\n  } catch (error) {\n    console.error('‚ùå API: Error creating topic:', error);\n    return NextResponse.json(\n      {\n        success: false,\n        error:\n          error instanceof Error ? error.message : 'Failed to create topic',\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":["GET","POST","console","log","data","topics","error","supabaseOperations","getTopics","isActive","orderBy","orderDirection","Error","message","transformedTopics","map","topic","id","name","slug","description","category","category_id","categoryId","orderIndex","order_index","is_active","created_at","Date","updated_at","length","NextResponse","json","success","count","status","request","topicData","requiredFields","field","supabaseTopicData","newTopic","createTopic","transformedTopic"],"mappings":"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"}