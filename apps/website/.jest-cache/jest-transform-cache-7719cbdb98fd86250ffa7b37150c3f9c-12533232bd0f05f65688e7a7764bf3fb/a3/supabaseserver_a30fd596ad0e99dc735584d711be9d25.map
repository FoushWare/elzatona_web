{"version":3,"sources":["/Users/a.fouad/SideProjects/Elzatona-all/Elzatona-web/apps/website/src/lib/supabase-server.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\n// Server-side Supabase configuration for Next.js 15 compatibility\n// This file uses 'any' types for Supabase query builder operations\nimport { createClient } from '@supabase/supabase-js';\n\n// Supabase configuration\nconst supabaseUrl =\n  process.env['NEXT_PUBLIC_SUPABASE_URL'] ||\n  'https://hpnewqkvpnthpohvxcmq.supabase.co';\nconst supabaseServiceRoleKey =\n  process.env['SUPABASE_SERVICE_ROLE_KEY'] ||\n  'SUPABASE_SERVICE_ROLE_KEY_REDACTED';\n\n// Initialize Supabase client (server-side with service role key)\nlet supabase: ReturnType<typeof createClient> | null = null;\n\ntry {\n  supabase = createClient(supabaseUrl, supabaseServiceRoleKey, {\n    auth: {\n      autoRefreshToken: false,\n      persistSession: false,\n    },\n  });\n  console.log(\n    '‚úÖ Supabase server initialized successfully with service role key!'\n  );\n} catch (error) {\n  console.error('‚ùå Supabase server initialization failed:', error);\n}\n\n// Export Supabase client for server-side use\nexport { supabase };\n\n// Export common Supabase operations for easy migration\nexport const supabaseOperations = {\n  // Learning Cards\n  async getLearningCards(filters?: {\n    type?: string;\n    isActive?: boolean;\n    limit?: number;\n    orderBy?: string;\n    orderDirection?: 'asc' | 'desc';\n  }) {\n    if (!supabase) throw new Error('Supabase not initialized');\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    let query = (supabase as any).from('learning_cards').select('*');\n\n    if (filters?.type) {\n      query = query.eq('type', filters.type);\n    }\n    if (filters?.isActive !== undefined) {\n      query = query.eq('is_active', filters.isActive);\n    }\n    if (filters?.orderBy) {\n      query = query.order(filters.orderBy, {\n        ascending: filters.orderDirection === 'asc',\n      });\n    }\n    if (filters?.limit) {\n      query = query.limit(filters.limit);\n    }\n\n    return await query;\n  },\n\n  async createLearningCard(cardData: {\n    title: string;\n    type: string;\n    description: string;\n    color?: string;\n    icon?: string;\n    order_index?: number;\n    is_active?: boolean;\n  }) {\n    if (!supabase) throw new Error('Supabase not initialized');\n\n    const data = {\n      ...cardData,\n      created_at: new Date().toISOString(),\n      updated_at: new Date().toISOString(),\n      is_active: cardData.is_active !== false,\n    };\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    return await (supabase as any)\n      .from('learning_cards')\n      .insert(data)\n      .select()\n      .single();\n  },\n\n  async updateLearningCard(\n    id: string,\n    updates: Partial<{\n      title: string;\n      type: string;\n      description: string;\n      color: string;\n      icon: string;\n      order_index: number;\n      is_active: boolean;\n    }>\n  ) {\n    if (!supabase) throw new Error('Supabase not initialized');\n\n    const data = {\n      ...updates,\n      updated_at: new Date().toISOString(),\n    };\n\n    return await (supabase as any)\n      .from('learning_cards')\n      .update(data)\n      .eq('id', id)\n      .select()\n      .single();\n  },\n\n  async deleteLearningCard(id: string) {\n    if (!supabase) throw new Error('Supabase not initialized');\n    return await (supabase as any).from('learning_cards').delete().eq('id', id);\n  },\n\n  // Categories\n  async getCategories(filters?: {\n    isActive?: boolean;\n    orderBy?: string;\n    orderDirection?: 'asc' | 'desc';\n  }) {\n    if (!supabase) throw new Error('Supabase not initialized');\n\n    let query = (supabase as any).from('categories').select('*');\n\n    if (filters?.isActive !== undefined) {\n      query = query.eq('is_active', filters.isActive);\n    }\n    if (filters?.orderBy) {\n      query = query.order(filters.orderBy, {\n        ascending: filters.orderDirection === 'asc',\n      });\n    }\n\n    return await query;\n  },\n\n  async createCategory(categoryData: {\n    name: string;\n    description: string;\n    slug?: string;\n    card_type?: string;\n    icon?: string;\n    color?: string;\n    order_index?: number;\n    is_active?: boolean;\n  }) {\n    if (!supabase) throw new Error('Supabase not initialized');\n\n    const data = {\n      ...categoryData,\n      slug:\n        categoryData.slug ||\n        categoryData.name.toLowerCase().replace(/\\s+/g, '-'),\n      card_type:\n        categoryData.card_type ||\n        categoryData.slug ||\n        categoryData.name.toLowerCase().replace(/\\s+/g, '-'),\n      created_at: new Date().toISOString(),\n      updated_at: new Date().toISOString(),\n      is_active: categoryData.is_active !== false,\n    };\n\n    return await (supabase as any)\n      .from('categories')\n      .insert(data)\n      .select()\n      .single();\n  },\n\n  // Topics\n  async getTopics(filters?: {\n    categoryId?: string;\n    isActive?: boolean;\n    orderBy?: string;\n    orderDirection?: 'asc' | 'desc';\n  }) {\n    if (!supabase) throw new Error('Supabase not initialized');\n\n    let query = (supabase as any).from('topics').select('*');\n\n    if (filters?.categoryId) {\n      query = query.eq('category_id', filters.categoryId);\n    }\n    if (filters?.isActive !== undefined) {\n      query = query.eq('is_active', filters.isActive);\n    }\n    if (filters?.orderBy) {\n      query = query.order(filters.orderBy, {\n        ascending: filters.orderDirection === 'asc',\n      });\n    }\n\n    return await query;\n  },\n\n  async createTopic(topicData: {\n    name: string;\n    description: string;\n    slug?: string;\n    category_id?: string;\n    order_index?: number;\n    is_active?: boolean;\n  }) {\n    if (!supabase) throw new Error('Supabase not initialized');\n\n    const data = {\n      ...topicData,\n      slug: topicData.slug || topicData.name.toLowerCase().replace(/\\s+/g, '-'),\n      created_at: new Date().toISOString(),\n      updated_at: new Date().toISOString(),\n      is_active: topicData.is_active !== false,\n    };\n\n    return await (supabase as any)\n      .from('topics')\n      .insert(data)\n      .select()\n      .single();\n  },\n\n  // Questions\n  async getQuestions(filters?: {\n    topicId?: string;\n    categoryId?: string | string[];\n    difficulty?: string;\n    questionType?: string;\n    isActive?: boolean;\n    limit?: number;\n    orderBy?: string;\n    orderDirection?: 'asc' | 'desc';\n  }) {\n    if (!supabase) throw new Error('Supabase not initialized');\n\n    let query = (supabase as any).from('questions').select('*');\n\n    if (filters?.topicId) {\n      console.log(\n        `üîç getQuestions - Applying topic_id filter: ${filters.topicId}`\n      );\n      query = query.eq('topic_id', filters.topicId);\n    } else {\n      console.log('‚ö†Ô∏è getQuestions - No topic_id filter provided');\n    }\n    if (filters?.categoryId) {\n      if (Array.isArray(filters.categoryId)) {\n        // Filter by multiple category IDs\n        query = query.in('category_id', filters.categoryId);\n      } else {\n        // Filter by single category ID\n        query = query.eq('category_id', filters.categoryId);\n      }\n    }\n    if (filters?.difficulty) {\n      query = query.eq('difficulty', filters.difficulty);\n    }\n    if (filters?.questionType) {\n      query = query.eq('question_type', filters.questionType);\n    }\n    if (filters?.isActive !== undefined) {\n      query = query.eq('is_active', filters.isActive);\n    }\n    if (filters?.orderBy) {\n      query = query.order(filters.orderBy, {\n        ascending: filters.orderDirection === 'asc',\n      });\n    }\n    if (filters?.limit) {\n      query = query.limit(filters.limit);\n    }\n\n    return await query;\n  },\n\n  async createQuestion(questionData: {\n    question_text: string;\n    explanation: string;\n    topic_id?: string;\n    difficulty?: string;\n    question_type?: string;\n    options?: string;\n    correct_answer?: string;\n    tags?: string;\n    is_active?: boolean;\n  }) {\n    if (!supabase) throw new Error('Supabase not initialized');\n\n    const data = {\n      ...questionData,\n      created_at: new Date().toISOString(),\n      updated_at: new Date().toISOString(),\n      is_active: questionData.is_active !== false,\n    };\n\n    return await (supabase as any)\n      .from('questions')\n      .insert(data)\n      .select()\n      .single();\n  },\n\n  // Learning Plans\n  async getLearningPlans(filters?: {\n    difficulty?: string;\n    isActive?: boolean;\n    orderBy?: string;\n    orderDirection?: 'asc' | 'desc';\n  }) {\n    if (!supabase) throw new Error('Supabase not initialized');\n\n    let query = (supabase as any).from('learning_plans').select('*');\n\n    if (filters?.difficulty) {\n      query = query.eq('difficulty', filters.difficulty);\n    }\n    if (filters?.isActive !== undefined) {\n      query = query.eq('is_active', filters.isActive);\n    }\n    if (filters?.orderBy) {\n      query = query.order(filters.orderBy, {\n        ascending: filters.orderDirection === 'asc',\n      });\n    }\n\n    return await query;\n  },\n\n  async createLearningPlan(planData: {\n    title: string;\n    description: string;\n    difficulty?: string;\n    estimated_time?: number;\n    is_active?: boolean;\n  }) {\n    if (!supabase) throw new Error('Supabase not initialized');\n\n    const data = {\n      ...planData,\n      created_at: new Date().toISOString(),\n      updated_at: new Date().toISOString(),\n      is_active: planData.is_active !== false,\n    };\n\n    return await (supabase as any)\n      .from('learning_plans')\n      .insert(data)\n      .select()\n      .single();\n  },\n};\n"],"names":["supabase","supabaseOperations","supabaseUrl","process","env","supabaseServiceRoleKey","createClient","auth","autoRefreshToken","persistSession","console","log","error","getLearningCards","filters","Error","query","from","select","type","eq","isActive","undefined","orderBy","order","ascending","orderDirection","limit","createLearningCard","cardData","data","created_at","Date","toISOString","updated_at","is_active","insert","single","updateLearningCard","id","updates","update","deleteLearningCard","delete","getCategories","createCategory","categoryData","slug","name","toLowerCase","replace","card_type","getTopics","categoryId","createTopic","topicData","getQuestions","topicId","Array","isArray","in","difficulty","questionType","createQuestion","questionData","getLearningPlans","createLearningPlan","planData"],"mappings":"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"}