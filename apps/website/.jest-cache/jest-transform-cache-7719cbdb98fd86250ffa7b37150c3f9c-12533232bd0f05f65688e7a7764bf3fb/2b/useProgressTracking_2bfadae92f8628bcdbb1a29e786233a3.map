{"version":3,"sources":["/Users/a.fouad/SideProjects/Elzatona-all/Elzatona-web/libs/shared-hooks/src/lib/useProgressTracking.ts"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\n\ninterface WindowWithGuidance extends Window {\n  triggerSignInGuidance?: (\n    trigger: string,\n    context: Record<string, unknown>\n  ) => void;\n}\n\ninterface ProgressData {\n  completedQuestions: number;\n  totalTimeSpent: number;\n  lastActivity: string;\n  streak: number;\n  achievements: string[];\n  roadmapSections: string[];\n  learningMode: 'guided' | 'self-directed' | null;\n}\n\nexport const useProgressTracking = () => {\n  const [progress, setProgress] = useState<ProgressData>({\n    completedQuestions: 0,\n    totalTimeSpent: 0,\n    lastActivity: new Date().toISOString(),\n    streak: 0,\n    achievements: [],\n    roadmapSections: [],\n    learningMode: null,\n  });\n\n  // Load progress from localStorage on mount\n  useEffect(() => {\n    const savedProgress = localStorage.getItem('userProgress');\n    if (savedProgress) {\n      try {\n        const parsedProgress = JSON.parse(savedProgress);\n        setProgress(parsedProgress);\n      } catch (error) {\n        console.error('Error loading progress:', error);\n      }\n    }\n  }, []);\n\n  // Save progress to localStorage whenever it changes\n  useEffect(() => {\n    localStorage.setItem('userProgress', JSON.stringify(progress));\n  }, [progress]);\n\n  const updateProgress = (updates: Partial<ProgressData>) => {\n    setProgress(prev => ({\n      ...prev,\n      ...updates,\n      lastActivity: new Date().toISOString(),\n    }));\n  };\n\n  const completeQuestion = (question_id: string, timeSpent: number = 0) => {\n    setProgress(prev => ({\n      ...prev,\n      completedQuestions: prev.completedQuestions + 1,\n      totalTimeSpent: prev.totalTimeSpent + timeSpent,\n      lastActivity: new Date().toISOString(),\n    }));\n\n    // Trigger sign-in guidance if needed\n    if (\n      typeof window !== 'undefined' &&\n      (window as WindowWithGuidance).triggerSignInGuidance\n    ) {\n      const newCount = progress.completedQuestions + 1;\n      if (newCount % 5 === 0) {\n        (window as WindowWithGuidance).triggerSignInGuidance?.('progress', {\n          progressCount: newCount,\n        });\n      }\n    }\n  };\n\n  const addAchievement = (achievement: string) => {\n    setProgress(prev => ({\n      ...prev,\n      achievements: [\n        ...prev.achievements.filter(a => a !== achievement),\n        achievement,\n      ],\n      lastActivity: new Date().toISOString(),\n    }));\n\n    // Trigger sign-in guidance for achievements\n    if (\n      typeof window !== 'undefined' &&\n      (window as WindowWithGuidance).triggerSignInGuidance\n    ) {\n      (window as WindowWithGuidance).triggerSignInGuidance?.('achievement', {\n        achievement,\n      });\n    }\n  };\n\n  const setRoadmapSections = (sections: string[]) => {\n    setProgress(prev => ({\n      ...prev,\n      roadmapSections: sections,\n      lastActivity: new Date().toISOString(),\n    }));\n\n    // Trigger sign-in guidance for roadmap\n    if (\n      typeof window !== 'undefined' &&\n      (window as WindowWithGuidance).triggerSignInGuidance &&\n      sections.length >= 3\n    ) {\n      (window as WindowWithGuidance).triggerSignInGuidance?.('roadmap', {\n        roadmapSections: sections.length,\n      });\n    }\n  };\n\n  const setLearningMode = (mode: 'guided' | 'self-directed') => {\n    setProgress(prev => ({\n      ...prev,\n      learningMode: mode,\n      lastActivity: new Date().toISOString(),\n    }));\n  };\n\n  const updateStreak = () => {\n    const today = new Date().toDateString();\n    const lastActivity = new Date(progress.lastActivity).toDateString();\n\n    if (lastActivity === today) {\n      // Already updated today\n      return;\n    }\n\n    const yesterday = new Date();\n    yesterday.setDate(yesterday.getDate() - 1);\n    const yesterdayString = yesterday.toDateString();\n\n    if (lastActivity === yesterdayString) {\n      // Continue streak\n      setProgress(prev => ({\n        ...prev,\n        streak: prev.streak + 1,\n        lastActivity: new Date().toISOString(),\n      }));\n    } else {\n      // Reset streak\n      setProgress(prev => ({\n        ...prev,\n        streak: 1,\n        lastActivity: new Date().toISOString(),\n      }));\n    }\n  };\n\n  const resetProgress = () => {\n    const resetData: ProgressData = {\n      completedQuestions: 0,\n      totalTimeSpent: 0,\n      lastActivity: new Date().toISOString(),\n      streak: 0,\n      achievements: [],\n      roadmapSections: [],\n      learningMode: null,\n    };\n    setProgress(resetData);\n    localStorage.setItem('userProgress', JSON.stringify(resetData));\n  };\n\n  return {\n    progress,\n    updateProgress,\n    completeQuestion,\n    addAchievement,\n    setRoadmapSections,\n    setLearningMode,\n    updateStreak,\n    resetProgress,\n  };\n};\n"],"names":["useProgressTracking","progress","setProgress","useState","completedQuestions","totalTimeSpent","lastActivity","Date","toISOString","streak","achievements","roadmapSections","learningMode","useEffect","savedProgress","localStorage","getItem","parsedProgress","JSON","parse","error","console","setItem","stringify","updateProgress","updates","prev","completeQuestion","question_id","timeSpent","window","triggerSignInGuidance","newCount","progressCount","addAchievement","achievement","filter","a","setRoadmapSections","sections","length","setLearningMode","mode","updateStreak","today","toDateString","yesterday","setDate","getDate","yesterdayString","resetProgress","resetData"],"mappings":"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"}