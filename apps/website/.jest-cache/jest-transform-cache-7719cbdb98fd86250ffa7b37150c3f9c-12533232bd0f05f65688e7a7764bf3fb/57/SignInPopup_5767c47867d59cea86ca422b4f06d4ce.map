{"version":3,"sources":["/Users/a.fouad/SideProjects/Elzatona-all/Elzatona-web/libs/shared-components/src/lib/auth/SignInPopup.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport { createClient } from '@supabase/supabase-js';\n\n// Use anon key for client-side auth operations (service role key is server-only)\nconst supabaseUrl = process.env['NEXT_PUBLIC_SUPABASE_URL'] || '';\nconst supabaseAnonKey = process.env['NEXT_PUBLIC_SUPABASE_ANON_KEY'] || '';\n\nconst supabase =\n  supabaseUrl && supabaseAnonKey\n    ? createClient(supabaseUrl, supabaseAnonKey, {\n        auth: {\n          autoRefreshToken: true,\n          persistSession: true,\n          detectSessionInUrl: true,\n        },\n      })\n    : null;\n\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n} from '@elzatona/shared-components';\nimport { Button } from '@elzatona/shared-components';\nimport { Input } from '@elzatona/shared-components';\nimport { Label } from '@elzatona/shared-components';\nimport { Loader2, Mail, Github, BookOpen, Eye, EyeOff } from 'lucide-react';\n\ninterface SignInPopupProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess: () => void;\n}\n\nexport const SignInPopup: React.FC<SignInPopupProps> = ({\n  isOpen,\n  onClose,\n  onSuccess,\n}) => {\n  const [isLogin, setIsLogin] = useState(true);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [showPassword, setShowPassword] = useState(false);\n  const [showConfirmPassword, setShowConfirmPassword] = useState(false);\n  const [error, setError] = useState('');\n  const [formData, setFormData] = useState({\n    email: '',\n    password: '',\n    confirmPassword: '',\n    name: '',\n  });\n\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n\n  // Check authentication status\n  useEffect(() => {\n    if (!supabase) return;\n    const checkAuth = async () => {\n      const {\n        data: { session },\n      } = await supabase.auth.getSession();\n      setIsAuthenticated(!!session);\n    };\n    checkAuth();\n  }, []);\n\n  // Close popup and call success callback when authenticated\n  useEffect(() => {\n    if (isAuthenticated) {\n      onSuccess();\n    }\n  }, [isAuthenticated, onSuccess]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!supabase) {\n      setError('Supabase client is not configured');\n      return;\n    }\n    setError('');\n    setIsSubmitting(true);\n\n    try {\n      if (isLogin) {\n        const { error } = await supabase.auth.signInWithPassword({\n          email: formData.email,\n          password: formData.password,\n        });\n        if (error) throw error;\n      } else {\n        if (formData.password !== formData.confirmPassword) {\n          setError('Passwords do not match');\n          return;\n        }\n        const { error } = await supabase.auth.signUp({\n          email: formData.email,\n          password: formData.password,\n          options: {\n            data: {\n              name: formData.name,\n            },\n          },\n        });\n        if (error) throw error;\n      }\n      setIsAuthenticated(true);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Authentication failed');\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const handleGoogleSignIn = async () => {\n    if (!supabase) {\n      setError('Supabase client is not configured');\n      return;\n    }\n    try {\n      const { error } = await supabase.auth.signInWithOAuth({\n        provider: 'google',\n      });\n      if (error) throw error;\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Google sign-in failed');\n    }\n  };\n\n  const handleGithubSignIn = async () => {\n    if (!supabase) {\n      setError('Supabase client is not configured');\n      return;\n    }\n    try {\n      const { error } = await supabase.auth.signInWithOAuth({\n        provider: 'github',\n      });\n      if (error) throw error;\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Github sign-in failed');\n    }\n  };\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setFormData(prev => ({\n      ...prev,\n      [e.target.name]: e.target.value,\n    }));\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className='sm:max-w-lg max-h-[90vh] overflow-y-auto'>\n        <DialogHeader className='space-y-4'>\n          <div className='flex items-center space-x-4'>\n            <div className='w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg'>\n              <BookOpen className='w-6 h-6 text-white' />\n            </div>\n            <div>\n              <DialogTitle className='text-2xl font-bold text-gray-900 dark:text-white'>\n                {isLogin ? 'Welcome Back!' : 'Join Elzatona'}\n              </DialogTitle>\n              <DialogDescription className='text-gray-600 dark:text-gray-400 text-base'>\n                {isLogin\n                  ? 'Sign in to access your guided learning plans'\n                  : 'Create your account to start your learning journey'}\n              </DialogDescription>\n            </div>\n          </div>\n        </DialogHeader>\n\n        <div className='space-y-6 py-2'>\n          {/* Social Sign In */}\n          <div className='space-y-3'>\n            <Button\n              onClick={handleGoogleSignIn}\n              variant='outline'\n              className='w-full h-12 text-base font-medium border-2 border-gray-200 dark:border-gray-700 hover:border-blue-300 dark:hover:border-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200 rounded-xl'\n              disabled={isSubmitting}\n            >\n              <Mail className='w-5 h-5 mr-3' />\n              Continue with Google\n            </Button>\n            <Button\n              onClick={handleGithubSignIn}\n              variant='outline'\n              className='w-full h-12 text-base font-medium border-2 border-gray-200 dark:border-gray-700 hover:border-gray-400 dark:hover:border-gray-500 hover:bg-gray-50 dark:hover:bg-gray-800 transition-all duration-200 rounded-xl'\n              disabled={isSubmitting}\n            >\n              <Github className='w-5 h-5 mr-3' />\n              Continue with Github\n            </Button>\n          </div>\n\n          <div className='relative'>\n            <div className='absolute inset-0 flex items-center'>\n              <span className='w-full border-t border-gray-200 dark:border-gray-700' />\n            </div>\n            <div className='relative flex justify-center text-sm'>\n              <span className='bg-white dark:bg-gray-900 px-4 text-gray-500 dark:text-gray-400 font-medium'>\n                Or continue with email\n              </span>\n            </div>\n          </div>\n\n          {/* Email Form */}\n          <form onSubmit={handleSubmit} className='space-y-5'>\n            {!isLogin && (\n              <div className='space-y-2'>\n                <Label\n                  htmlFor='name'\n                  className='text-sm font-semibold text-gray-700 dark:text-gray-300'\n                >\n                  Full Name\n                </Label>\n                <Input\n                  id='name'\n                  name='name'\n                  type='text'\n                  value={formData.name}\n                  onChange={handleInputChange}\n                  required={!isLogin}\n                  disabled={isSubmitting}\n                  className='h-12 text-base border-2 border-gray-200 dark:border-gray-700 focus:border-blue-500 dark:focus:border-blue-400 rounded-xl transition-colors duration-200'\n                  placeholder='Enter your full name'\n                />\n              </div>\n            )}\n\n            <div className='space-y-2'>\n              <Label\n                htmlFor='email'\n                className='text-sm font-semibold text-gray-700 dark:text-gray-300'\n              >\n                Email Address\n              </Label>\n              <Input\n                id='email'\n                name='email'\n                type='email'\n                value={formData.email}\n                onChange={handleInputChange}\n                required\n                disabled={isSubmitting}\n                className='h-12 text-base border-2 border-gray-200 dark:border-gray-700 focus:border-blue-500 dark:focus:border-blue-400 rounded-xl transition-colors duration-200'\n                placeholder='Enter your email address'\n              />\n            </div>\n\n            <div className='space-y-2'>\n              <Label\n                htmlFor='password'\n                className='text-sm font-semibold text-gray-700 dark:text-gray-300'\n              >\n                Password\n              </Label>\n              <div className='relative'>\n                <Input\n                  id='password'\n                  name='password'\n                  type={showPassword ? 'text' : 'password'}\n                  value={formData.password}\n                  onChange={handleInputChange}\n                  required\n                  disabled={isSubmitting}\n                  className='h-12 text-base border-2 border-gray-200 dark:border-gray-700 focus:border-blue-500 dark:focus:border-blue-400 rounded-xl transition-colors duration-200 pr-12'\n                  placeholder='Enter your password'\n                />\n                <button\n                  type='button'\n                  onClick={() => setShowPassword(!showPassword)}\n                  className='absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300'\n                >\n                  {showPassword ? (\n                    <EyeOff className='w-5 h-5' />\n                  ) : (\n                    <Eye className='w-5 h-5' />\n                  )}\n                </button>\n              </div>\n            </div>\n\n            {!isLogin && (\n              <div className='space-y-2'>\n                <Label\n                  htmlFor='confirmPassword'\n                  className='text-sm font-semibold text-gray-700 dark:text-gray-300'\n                >\n                  Confirm Password\n                </Label>\n                <div className='relative'>\n                  <Input\n                    id='confirmPassword'\n                    name='confirmPassword'\n                    type={showConfirmPassword ? 'text' : 'password'}\n                    value={formData.confirmPassword}\n                    onChange={handleInputChange}\n                    required={!isLogin}\n                    disabled={isSubmitting}\n                    className='h-12 text-base border-2 border-gray-200 dark:border-gray-700 focus:border-blue-500 dark:focus:border-blue-400 rounded-xl transition-colors duration-200 pr-12'\n                    placeholder='Confirm your password'\n                  />\n                  <button\n                    type='button'\n                    onClick={() => setShowConfirmPassword(!showConfirmPassword)}\n                    className='absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300'\n                  >\n                    {showConfirmPassword ? (\n                      <EyeOff className='w-5 h-5' />\n                    ) : (\n                      <Eye className='w-5 h-5' />\n                    )}\n                  </button>\n                </div>\n              </div>\n            )}\n\n            {error && (\n              <div className='text-sm text-red-600 bg-red-50 dark:bg-red-900/20 p-4 rounded-xl border border-red-200 dark:border-red-800'>\n                {error}\n              </div>\n            )}\n\n            <Button\n              type='submit'\n              className='w-full h-12 text-base font-semibold bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed'\n              disabled={isSubmitting}\n            >\n              {isSubmitting ? (\n                <Loader2 className='w-5 h-5 mr-2 animate-spin' />\n              ) : null}\n              {isLogin ? 'Sign In' : 'Create Account'}\n            </Button>\n          </form>\n\n          <div className='text-center'>\n            <button\n              type='button'\n              onClick={() => setIsLogin(!isLogin)}\n              className='text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 font-medium text-base transition-colors duration-200 hover:underline'\n            >\n              {isLogin\n                ? \"Don't have an account? Sign up\"\n                : 'Already have an account? Sign in'}\n            </button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n};\n"],"names":["SignInPopup","supabaseUrl","process","env","supabaseAnonKey","supabase","createClient","auth","autoRefreshToken","persistSession","detectSessionInUrl","isOpen","onClose","onSuccess","isLogin","setIsLogin","useState","isSubmitting","setIsSubmitting","showPassword","setShowPassword","showConfirmPassword","setShowConfirmPassword","error","setError","formData","setFormData","email","password","confirmPassword","name","isAuthenticated","setIsAuthenticated","useEffect","checkAuth","data","session","getSession","handleSubmit","e","preventDefault","signInWithPassword","signUp","options","err","Error","message","handleGoogleSignIn","signInWithOAuth","provider","handleGithubSignIn","handleInputChange","prev","target","value","Dialog","open","onOpenChange","DialogContent","className","DialogHeader","div","BookOpen","DialogTitle","DialogDescription","Button","onClick","variant","disabled","Mail","Github","span","form","onSubmit","Label","htmlFor","Input","id","type","onChange","required","placeholder","button","EyeOff","Eye","Loader2"],"mappings":"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"}