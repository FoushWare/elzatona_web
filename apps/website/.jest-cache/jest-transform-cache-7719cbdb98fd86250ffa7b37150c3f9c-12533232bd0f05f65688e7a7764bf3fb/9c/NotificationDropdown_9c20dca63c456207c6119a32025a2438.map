{"version":3,"sources":["/Users/a.fouad/SideProjects/Elzatona-all/Elzatona-web/libs/shared-components/src/lib/common/NotificationDropdown.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState } from 'react';\nimport { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env['NEXT_PUBLIC_SUPABASE_URL']!;\nconst supabaseServiceRoleKey = process.env['SUPABASE_SERVICE_ROLE_KEY']!;\nconst supabase = createClient(supabaseUrl, supabaseServiceRoleKey);\n\nimport { useNotifications } from '@elzatona/shared-contexts';\nimport {\n  Bell,\n  X,\n  Check,\n  CheckCheck,\n  Info,\n  CheckCircle,\n  AlertTriangle,\n  AlertCircle,\n  RefreshCw,\n} from 'lucide-react';\n\ninterface NotificationDropdownProps {\n  userId?: string;\n  adminId?: string;\n}\n\nexport function NotificationDropdown({\n  userId,\n  adminId,\n}: NotificationDropdownProps) {\n  const {\n    notifications,\n    unreadCount,\n    isLoading,\n    error,\n    markAsRead,\n    markAllAsRead,\n    refreshNotifications,\n  } = useNotifications();\n\n  const [isOpen, setIsOpen] = useState(false);\n\n  const getNotificationIcon = (type: string) => {\n    switch (type) {\n      case 'success':\n        return <CheckCircle className='h-4 w-4 text-green-500' />;\n      case 'warning':\n        return <AlertTriangle className='h-4 w-4 text-yellow-500' />;\n      case 'error':\n        return <AlertCircle className='h-4 w-4 text-red-500' />;\n      default:\n        return <Info className='h-4 w-4 text-blue-500' />;\n    }\n  };\n\n  const getNotificationBgColor = (type: string) => {\n    switch (type) {\n      case 'success':\n        return 'bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800';\n      case 'warning':\n        return 'bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800';\n      case 'error':\n        return 'bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800';\n      default:\n        return 'bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800';\n    }\n  };\n\n  const formatTimeAgo = (date: Date) => {\n    const now = new Date();\n    const diffInSeconds = Math.floor((now.getTime() - date.getTime()) / 1000);\n\n    if (diffInSeconds < 60) return 'Just now';\n    if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}m ago`;\n    if (diffInSeconds < 86400)\n      return `${Math.floor(diffInSeconds / 3600)}h ago`;\n    return `${Math.floor(diffInSeconds / 86400)}d ago`;\n  };\n\n  return (\n    <div className='relative'>\n      {/* Notification Bell */}\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className='relative p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors'\n      >\n        <Bell className='h-6 w-6' />\n        {unreadCount > 0 && (\n          <span className='absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center'>\n            {unreadCount > 99 ? '99+' : unreadCount}\n          </span>\n        )}\n      </button>\n\n      {/* Dropdown */}\n      {isOpen && (\n        <>\n          {/* Backdrop */}\n          <div\n            className='fixed inset-0 z-10'\n            onClick={() => setIsOpen(false)}\n          />\n\n          {/* Dropdown Content */}\n          <div className='absolute right-0 mt-2 w-80 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 z-20'>\n            {/* Header */}\n            <div className='flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700'>\n              <h3 className='text-lg font-semibold text-gray-900 dark:text-white'>\n                Notifications\n              </h3>\n              <div className='flex items-center space-x-2'>\n                <button\n                  onClick={refreshNotifications}\n                  disabled={isLoading}\n                  className='p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300'\n                >\n                  <RefreshCw\n                    className={`h-4 w-4 ${isLoading ? 'animate-spin' : ''}`}\n                  />\n                </button>\n                {unreadCount > 0 && (\n                  <button\n                    onClick={markAllAsRead}\n                    className='p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300'\n                    title='Mark all as read'\n                  >\n                    <CheckCheck className='h-4 w-4' />\n                  </button>\n                )}\n                <button\n                  onClick={() => setIsOpen(false)}\n                  className='p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300'\n                >\n                  <X className='h-4 w-4' />\n                </button>\n              </div>\n            </div>\n\n            {/* Content */}\n            <div className='max-h-96 overflow-y-auto'>\n              {isLoading ? (\n                <div className='p-4 text-center'>\n                  <RefreshCw className='h-6 w-6 animate-spin text-gray-400 mx-auto mb-2' />\n                  <p className='text-gray-500 dark:text-gray-400'>\n                    Loading notifications...\n                  </p>\n                </div>\n              ) : error ? (\n                <div className='p-4 text-center'>\n                  <AlertCircle className='h-6 w-6 text-red-500 mx-auto mb-2' />\n                  <p className='text-red-600 dark:text-red-400'>{error}</p>\n                </div>\n              ) : notifications.length === 0 ? (\n                <div className='p-4 text-center'>\n                  <Bell className='h-8 w-8 text-gray-400 mx-auto mb-2' />\n                  <p className='text-gray-500 dark:text-gray-400'>\n                    No notifications yet\n                  </p>\n                </div>\n              ) : (\n                <div className='divide-y divide-gray-200 dark:divide-gray-700'>\n                  {notifications.map(notification => (\n                    <div\n                      key={notification.id}\n                      className={`p-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors ${\n                        !notification.read\n                          ? 'bg-blue-50/50 dark:bg-blue-900/10'\n                          : ''\n                      }`}\n                    >\n                      <div className='flex items-start space-x-3'>\n                        <div className='flex-shrink-0 mt-0.5'>\n                          {getNotificationIcon(notification.type)}\n                        </div>\n                        <div className='flex-1 min-w-0'>\n                          <div className='flex items-center justify-between'>\n                            <p\n                              className={`text-sm font-medium ${\n                                !notification.read\n                                  ? 'text-gray-900 dark:text-white'\n                                  : 'text-gray-700 dark:text-gray-300'\n                              }`}\n                            >\n                              {notification.title}\n                            </p>\n                            <div className='flex items-center space-x-2'>\n                              <span className='text-xs text-gray-500 dark:text-gray-400'>\n                                {formatTimeAgo(notification.timestamp)}\n                              </span>\n                              {!notification.read && (\n                                <button\n                                  onClick={() => markAsRead(notification.id)}\n                                  className='p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300'\n                                  title='Mark as read'\n                                >\n                                  <Check className='h-3 w-3' />\n                                </button>\n                              )}\n                            </div>\n                          </div>\n                          <p\n                            className={`text-sm mt-1 ${\n                              !notification.read\n                                ? 'text-gray-800 dark:text-gray-200'\n                                : 'text-gray-600 dark:text-gray-400'\n                            }`}\n                          >\n                            {notification.message}\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n\n            {/* Footer */}\n            {notifications.length > 0 && (\n              <div className='p-4 border-t border-gray-200 dark:border-gray-700'>\n                <button\n                  onClick={() => {\n                    setIsOpen(false);\n                    // Navigate to full notifications page\n                    window.location.href = '/notifications';\n                  }}\n                  className='w-full text-center text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300'\n                >\n                  View all notifications\n                </button>\n              </div>\n            )}\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n"],"names":["NotificationDropdown","supabaseUrl","process","env","supabaseServiceRoleKey","supabase","createClient","userId","adminId","notifications","unreadCount","isLoading","error","markAsRead","markAllAsRead","refreshNotifications","useNotifications","isOpen","setIsOpen","useState","getNotificationIcon","type","CheckCircle","className","AlertTriangle","AlertCircle","Info","getNotificationBgColor","formatTimeAgo","date","now","Date","diffInSeconds","Math","floor","getTime","div","button","onClick","Bell","span","h3","disabled","RefreshCw","title","CheckCheck","X","p","length","map","notification","read","timestamp","id","Check","message","window","location","href"],"mappings":"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"}