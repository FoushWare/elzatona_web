{"version":3,"sources":["/Users/a.fouad/SideProjects/Elzatona-all/Elzatona-web/tests/admin/admin-login-api.test.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\n/**\n * Admin Login API Tests\n *\n * Tests for the /api/admin/auth endpoint to ensure:\n * - Authentication works correctly\n * - Proper error handling\n * - JWT token generation\n * - Security measures\n */\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { POST } from '@/app/api/admin/auth/route';\n\n// Mock NextResponse to ensure json() method works correctly\njest.mock('next/server', () => {\n  const actual = jest.requireActual('next/server');\n  return {\n    ...actual,\n    NextResponse: {\n      ...actual.NextResponse,\n      json: (body: any, init?: any) => {\n        const response = actual.NextResponse.json(body, init);\n        // Ensure _body is set for test compatibility\n        (response as any)._body = JSON.stringify(body);\n        return response;\n      },\n    },\n  };\n});\n\n// Helper to extract JSON from NextResponse\nasync function getResponseData(response: any): Promise<any> {\n  // NextResponse.json() stores data in response._body or response.body\n  // Check all possible locations\n\n  // Method 1: Try json() method\n  try {\n    const data = await response.json();\n    if (data && typeof data === 'object' && Object.keys(data).length > 0) {\n      return data;\n    }\n  } catch (_e) {\n    // Continue to other methods\n  }\n\n  // Method 2: Check internal _body property (NextResponse might use this)\n  if ((response as any)._body !== undefined) {\n    const body = (response as any)._body;\n    if (typeof body === 'string') {\n      try {\n        return JSON.parse(body);\n      } catch {\n        return {};\n      }\n    }\n    if (body && typeof body === 'object') {\n      return body;\n    }\n  }\n\n  // Method 3: Try text() method\n  try {\n    const text = await response.text();\n    if (text) {\n      return JSON.parse(text);\n    }\n  } catch (_e) {\n    // Continue\n  }\n\n  // Method 4: Try body ReadableStream\n  if (response.body) {\n    try {\n      const reader = response.body.getReader();\n      const { value, done } = await reader.read();\n      if (!done && value) {\n        const text = new TextDecoder().decode(value);\n        return JSON.parse(text);\n      }\n    } catch (_e) {\n      // Continue\n    }\n  }\n\n  // Method 5: Check if response has data property directly\n  if ((response as any).data) {\n    return (response as any).data;\n  }\n\n  return {};\n}\n\n// Mock Supabase - this needs to be set up before the route module is imported\n// The route handler creates the client at module load, so we need a shared instance\n// Define the mock client inside the factory to avoid hoisting issues\nconst mockSupabaseClient = {\n  from: jest.fn(),\n};\n\njest.mock('@supabase/supabase-js', () => {\n  // Create the mock client inside the factory\n  const client = {\n    from: jest.fn(),\n  };\n  return {\n    createClient: jest.fn(() => client),\n  };\n});\n\n// Export the mock client so tests can configure it\n// We'll get it from the mocked module\n\n// Mock bcrypt\njest.mock('bcryptjs', () => ({\n  compare: jest.fn(),\n  hash: jest.fn(),\n}));\n\n// Mock admin.config\njest.mock('@/admin.config', () => ({\n  adminConfig: {\n    security: {\n      saltRounds: 10,\n      sessionTimeout: 24 * 60 * 60 * 1000, // 24 hours\n    },\n    jwt: {\n      secret: 'test-jwt-secret',\n    },\n  },\n  getAdminApiUrl: jest.fn((path: string) => `http://localhost:3000${path}`),\n}));\n\ndescribe('Admin Login API', () => {\n  // eslint-disable-next-line @typescript-eslint/no-require-imports\n  const bcrypt = require('bcryptjs');\n  // eslint-disable-next-line @typescript-eslint/no-require-imports\n  const { createClient } = require('@supabase/supabase-js');\n\n  let mockSupabaseClient: any;\n  let consoleErrorSpy: jest.SpyInstance;\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    // Mock console.error globally to suppress error output during tests\n    consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation(() => {});\n    // Get the mock client instance (same one used by the route handler)\n    mockSupabaseClient = createClient();\n    // Reset the from mock for each test\n    mockSupabaseClient.from.mockClear();\n    // Set up environment variables\n    process.env.JWT_SECRET = 'test-jwt-secret';\n    process.env.NEXT_PUBLIC_SUPABASE_URL = 'https://test.supabase.co';\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = 'test-anon-key';\n    process.env.SUPABASE_SERVICE_ROLE_KEY = 'test-service-role-key';\n  });\n\n  afterEach(() => {\n    delete process.env.JWT_SECRET;\n    delete process.env.NEXT_PUBLIC_SUPABASE_URL;\n    delete process.env.SUPABASE_SERVICE_ROLE_KEY;\n  });\n\n  describe('POST /api/admin/auth', () => {\n    it('should authenticate admin with valid credentials', async () => {\n      // Mock Supabase response\n      const mockAdmin = {\n        id: 'admin_123',\n        email: 'test@example.com',\n        name: 'Test Admin',\n        role: 'super_admin',\n        password_hash: 'hashed_password',\n        is_active: true,\n        created_at: new Date().toISOString(),\n      };\n\n      const mockSingle = Promise.resolve({\n        data: mockAdmin,\n        error: null,\n      });\n\n      const mockEq = jest.fn().mockReturnValue({\n        single: () => mockSingle,\n      });\n\n      const mockSelect = jest.fn().mockReturnValue({\n        eq: mockEq,\n      });\n\n      mockSupabaseClient.from.mockReturnValue({\n        select: mockSelect,\n        update: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({ error: null }),\n        }),\n      });\n\n      // Mock bcrypt compare\n      bcrypt.compare.mockResolvedValue(true);\n\n      const request = new NextRequest('http://localhost:3000/api/admin/auth', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'testpassword123',\n        }),\n      });\n\n      const response = await POST(request);\n      const data = await getResponseData(response);\n\n      expect(response.status).toBe(200);\n      expect(data).toBeDefined();\n      expect(data.success).toBe(true);\n      expect(data.admin).toBeDefined();\n      expect(data.admin.email).toBe(mockAdmin.email);\n      expect(data.admin.token).toBeDefined();\n      expect(data.admin.token).toMatch(\n        /^[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+$/\n      );\n    });\n\n    it('should reject authentication with invalid credentials', async () => {\n      // Mock Supabase - admin not found\n      const mockSingle = jest.fn().mockResolvedValue({\n        data: null,\n        error: { message: 'Not found' },\n      });\n\n      mockSupabaseClient.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: mockSingle,\n          }),\n        }),\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/admin/auth', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'wrongpassword',\n        }),\n      });\n\n      const response = await POST(request);\n      const data = await getResponseData(response);\n\n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error).toBe('Invalid email or password');\n    });\n\n    it('should reject authentication with wrong password', async () => {\n      // Mock Supabase - admin found but wrong password\n      const mockAdmin = {\n        id: 'admin_123',\n        email: 'test@example.com',\n        password_hash: 'hashed_password',\n        is_active: true,\n      };\n\n      const mockSingle = Promise.resolve({\n        data: mockAdmin,\n        error: null,\n      });\n\n      const mockEq = jest.fn().mockReturnValue({\n        single: () => mockSingle,\n      });\n\n      const mockSelect = jest.fn().mockReturnValue({\n        eq: mockEq,\n      });\n\n      mockSupabaseClient.from.mockReturnValue({\n        select: mockSelect,\n      });\n\n      // Mock bcrypt compare - wrong password\n      bcrypt.compare.mockResolvedValue(false);\n\n      const request = new NextRequest('http://localhost:3000/api/admin/auth', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'wrongpassword',\n        }),\n      });\n\n      const response = await POST(request);\n      const data = await getResponseData(response);\n\n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error).toBe('Invalid email or password');\n    });\n\n    it('should reject authentication with missing email', async () => {\n      const request = new NextRequest('http://localhost:3000/api/admin/auth', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          password: 'testpassword123',\n        }),\n      });\n\n      const response = await POST(request);\n      const data = await getResponseData(response);\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error).toBe('Email and password are required');\n    });\n\n    it('should reject authentication with missing password', async () => {\n      const request = new NextRequest('http://localhost:3000/api/admin/auth', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          email: 'test@example.com',\n        }),\n      });\n\n      const response = await POST(request);\n      const data = await getResponseData(response);\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error).toBe('Email and password are required');\n    });\n\n    it('should handle server errors gracefully', async () => {\n      // Mock Supabase error\n      const mockSingle = Promise.reject(\n        new Error('Database connection failed')\n      );\n\n      const mockEq = jest.fn().mockReturnValue({\n        single: () => mockSingle,\n      });\n\n      const mockSelect = jest.fn().mockReturnValue({\n        eq: mockEq,\n      });\n\n      mockSupabaseClient.from.mockReturnValue({\n        select: mockSelect,\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/admin/auth', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'testpassword123',\n        }),\n      });\n\n      const response = await POST(request);\n      const data = await getResponseData(response);\n\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n      expect(data.error).toBeDefined();\n    });\n\n    it('should handle requests without Content-Type header', async () => {\n      // Mock Supabase - admin not found\n      const mockSingle = Promise.resolve({\n        data: null,\n        error: { message: 'Not found' },\n      });\n\n      const mockEq = jest.fn().mockReturnValue({\n        single: () => mockSingle,\n      });\n\n      const mockSelect = jest.fn().mockReturnValue({\n        eq: mockEq,\n      });\n\n      mockSupabaseClient.from.mockReturnValue({\n        select: mockSelect,\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/admin/auth', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'testpassword123',\n        }),\n      });\n\n      const response = await POST(request);\n      const data = await getResponseData(response);\n\n      // The route should still process the request if body is valid JSON\n      // It will fail authentication (401) since admin is not found\n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n    });\n\n    it('should generate JWT token with correct expiration', async () => {\n      const mockAdmin = {\n        id: 'admin_123',\n        email: 'test@example.com',\n        name: 'Test Admin',\n        role: 'super_admin',\n        password_hash: 'hashed_password',\n        is_active: true,\n        created_at: new Date().toISOString(),\n      };\n\n      const mockSingle = Promise.resolve({\n        data: mockAdmin,\n        error: null,\n      });\n\n      const mockEq = jest.fn().mockReturnValue({\n        single: () => mockSingle,\n      });\n\n      const mockSelect = jest.fn().mockReturnValue({\n        eq: mockEq,\n      });\n\n      mockSupabaseClient.from.mockReturnValue({\n        select: mockSelect,\n        update: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({ error: null }),\n        }),\n      });\n\n      bcrypt.compare.mockResolvedValue(true);\n\n      const request = new NextRequest('http://localhost:3000/api/admin/auth', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'testpassword123',\n        }),\n      });\n\n      const response = await POST(request);\n      const data = await getResponseData(response);\n\n      expect(response.status).toBe(200);\n      expect(data.admin.token).toBeDefined();\n      expect(data.admin.expiresAt).toBeDefined();\n\n      // Check that expiration is in the future\n      const expirationDate = new Date(data.admin.expiresAt);\n      const now = new Date();\n      expect(expirationDate.getTime()).toBeGreaterThan(now.getTime());\n    });\n\n    it('should handle multiple requests', async () => {\n      // Mock Supabase - admin not found for all requests\n      const mockSingle = Promise.resolve({\n        data: null,\n        error: { message: 'Not found' },\n      });\n\n      const mockEq = jest.fn().mockReturnValue({\n        single: () => mockSingle,\n      });\n\n      const mockSelect = jest.fn().mockReturnValue({\n        eq: mockEq,\n      });\n\n      mockSupabaseClient.from.mockReturnValue({\n        select: mockSelect,\n      });\n\n      const requests = Array(5)\n        .fill(null)\n        .map(\n          () =>\n            new NextRequest('http://localhost:3000/api/admin/auth', {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json',\n              },\n              body: JSON.stringify({\n                email: 'test@example.com',\n                password: 'wrongpassword',\n              }),\n            })\n        );\n\n      const responses = await Promise.all(requests.map(req => POST(req)));\n\n      // All requests should be handled (even if they fail)\n      responses.forEach(response => {\n        expect([400, 401]).toContain(response.status);\n      });\n    });\n  });\n});\n"],"names":["jest","mock","actual","requireActual","NextResponse","json","body","init","response","_body","JSON","stringify","client","from","fn","createClient","compare","hash","adminConfig","security","saltRounds","sessionTimeout","jwt","secret","getAdminApiUrl","path","getResponseData","data","Object","keys","length","_e","undefined","parse","text","reader","getReader","value","done","read","TextDecoder","decode","mockSupabaseClient","describe","bcrypt","require","consoleErrorSpy","beforeEach","clearAllMocks","spyOn","console","mockImplementation","mockClear","process","env","JWT_SECRET","NEXT_PUBLIC_SUPABASE_URL","NEXT_PUBLIC_SUPABASE_ANON_KEY","SUPABASE_SERVICE_ROLE_KEY","afterEach","it","mockAdmin","id","email","name","role","password_hash","is_active","created_at","Date","toISOString","mockSingle","Promise","resolve","error","mockEq","mockReturnValue","single","mockSelect","eq","select","update","mockResolvedValue","request","NextRequest","method","headers","password","POST","expect","status","toBe","toBeDefined","success","admin","token","toMatch","message","reject","Error","expiresAt","expirationDate","now","getTime","toBeGreaterThan","requests","Array","fill","map","responses","all","req","forEach","toContain"],"mappings":"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"}