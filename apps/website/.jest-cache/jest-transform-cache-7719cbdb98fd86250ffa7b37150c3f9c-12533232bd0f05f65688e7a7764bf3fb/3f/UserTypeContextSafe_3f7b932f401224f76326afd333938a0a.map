{"version":3,"sources":["/Users/a.fouad/SideProjects/Elzatona-all/Elzatona-web/libs/shared-contexts/src/lib/UserTypeContextSafe.tsx"],"sourcesContent":["'use client';\n\n// Only create Supabase client if environment variables are available\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nlet supabase: any = null;\nif (\n  process.env['NEXT_PUBLIC_SUPABASE_URL'] &&\n  process.env['SUPABASE_SERVICE_ROLE_KEY']\n) {\n  // eslint-disable-next-line @typescript-eslint/no-require-imports\n  const { createClient } = require('@supabase/supabase-js');\n  const supabaseUrl = process.env['NEXT_PUBLIC_SUPABASE_URL'];\n  const supabaseServiceRoleKey = process.env['SUPABASE_SERVICE_ROLE_KEY'];\n  supabase = createClient(supabaseUrl, supabaseServiceRoleKey);\n}\nimport React, {\n  useState,\n  useEffect,\n  ReactNode,\n  createContext,\n  useContext,\n} from 'react';\n\nexport type UserType = 'guided' | 'self-directed' | null;\n\ninterface UserTypeContextType {\n  userType: UserType;\n  setUserType: (type: UserType) => void;\n  hasCompletedOnboarding: boolean;\n  setHasCompletedOnboarding: (completed: boolean) => void;\n  isFirstVisit: boolean;\n  setIsFirstVisit: (isFirst: boolean) => void;\n  resetUserPreferences: () => void;\n}\n\nconst UserTypeContext = createContext<UserTypeContextType | undefined>(\n  undefined\n);\n\ninterface UserTypeProviderProps {\n  children: ReactNode;\n}\n\nexport const UserTypeProvider: React.FC<UserTypeProviderProps> = ({\n  children,\n}) => {\n  // Default to 'guided' when no preference exists\n  const [userType, setUserType] = useState<UserType>('guided');\n  const [hasCompletedOnboarding, setHasCompletedOnboarding] = useState(false);\n  const [isFirstVisit, setIsFirstVisit] = useState(false);\n\n  // Load user preferences from localStorage on mount\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      try {\n        // Fallback to localStorage only\n        const savedUserType = localStorage.getItem('userType') as UserType;\n        if (savedUserType) {\n          setUserType(savedUserType);\n        } else {\n          setUserType('guided');\n          localStorage.setItem('userType', 'guided');\n        }\n\n        const savedOnboarding =\n          localStorage.getItem('hasCompletedOnboarding') === 'true';\n        const savedFirstVisit = localStorage.getItem('isFirstVisit') === 'true';\n\n        setHasCompletedOnboarding(savedOnboarding);\n        setIsFirstVisit(savedFirstVisit);\n      } catch (error) {\n        console.error('Error loading user preferences:', error);\n        // Set defaults if localStorage fails\n        setUserType('guided');\n        setHasCompletedOnboarding(false);\n        setIsFirstVisit(true);\n      }\n    }\n  }, []);\n\n  // Save user preferences to localStorage when they change\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      try {\n        if (userType) {\n          localStorage.setItem('userType', userType);\n        }\n        localStorage.setItem(\n          'hasCompletedOnboarding',\n          hasCompletedOnboarding.toString()\n        );\n        localStorage.setItem('isFirstVisit', isFirstVisit.toString());\n      } catch (error) {\n        console.error('Error saving user preferences:', error);\n      }\n    }\n  }, [userType, hasCompletedOnboarding, isFirstVisit]);\n\n  const resetUserPreferences = () => {\n    setUserType('guided');\n    setHasCompletedOnboarding(false);\n    setIsFirstVisit(false);\n    if (typeof window !== 'undefined') {\n      try {\n        localStorage.removeItem('userType');\n        localStorage.removeItem('hasCompletedOnboarding');\n        localStorage.removeItem('isFirstVisit');\n      } catch (error) {\n        console.error('Error resetting user preferences:', error);\n      }\n    }\n  };\n\n  const value: UserTypeContextType = {\n    userType,\n    setUserType,\n    hasCompletedOnboarding,\n    setHasCompletedOnboarding,\n    isFirstVisit,\n    setIsFirstVisit,\n    resetUserPreferences,\n  };\n\n  return (\n    <UserTypeContext.Provider value={value}>\n      {children}\n    </UserTypeContext.Provider>\n  );\n};\n\nexport const useUserType = (): UserTypeContextType => {\n  const context = useContext(UserTypeContext);\n  if (context === undefined) {\n    throw new Error('useUserType must be used within a UserTypeProvider');\n  }\n  return context;\n};\n\nexport default UserTypeProvider;\n"],"names":["UserTypeProvider","useUserType","supabase","process","env","createClient","require","supabaseUrl","supabaseServiceRoleKey","UserTypeContext","createContext","undefined","children","userType","setUserType","useState","hasCompletedOnboarding","setHasCompletedOnboarding","isFirstVisit","setIsFirstVisit","useEffect","window","savedUserType","localStorage","getItem","setItem","savedOnboarding","savedFirstVisit","error","console","toString","resetUserPreferences","removeItem","value","Provider","context","useContext","Error"],"mappings":"AAAA;;;;;;;;;;;;QA2CaA;eAAAA;;QA+Fb;eAAA;;QARaC;eAAAA;;;;+DA7GN;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAnBP,qEAAqE;AACrE,8DAA8D;AAC9D,IAAIC,WAAgB;AACpB,IACEC,QAAQC,GAAG,CAAC,2BAA2B,IACvCD,QAAQC,GAAG,CAAC,4BAA4B,EACxC;IACA,iEAAiE;IACjE,MAAM,EAAEC,YAAY,EAAE,GAAGC,QAAQ;IACjC,MAAMC,cAAcJ,QAAQC,GAAG,CAAC,2BAA2B;IAC3D,MAAMI,yBAAyBL,QAAQC,GAAG,CAAC,4BAA4B;IACvEF,WAAWG,aAAaE,aAAaC;AACvC;AAqBA,MAAMC,gCAAkBC,IAAAA,oBAAa,EACnCC;AAOK,MAAMX,mBAAoD,CAAC,EAChEY,QAAQ,EACT;IACC,gDAAgD;IAChD,MAAM,CAACC,UAAUC,YAAY,GAAGC,IAAAA,eAAQ,EAAW;IACnD,MAAM,CAACC,wBAAwBC,0BAA0B,GAAGF,IAAAA,eAAQ,EAAC;IACrE,MAAM,CAACG,cAAcC,gBAAgB,GAAGJ,IAAAA,eAAQ,EAAC;IAEjD,mDAAmD;IACnDK,IAAAA,gBAAS,EAAC;QACR,IAAI,OAAOC,WAAW,aAAa;YACjC,IAAI;gBACF,gCAAgC;gBAChC,MAAMC,gBAAgBC,aAAaC,OAAO,CAAC;gBAC3C,IAAIF,eAAe;oBACjBR,YAAYQ;gBACd,OAAO;oBACLR,YAAY;oBACZS,aAAaE,OAAO,CAAC,YAAY;gBACnC;gBAEA,MAAMC,kBACJH,aAAaC,OAAO,CAAC,8BAA8B;gBACrD,MAAMG,kBAAkBJ,aAAaC,OAAO,CAAC,oBAAoB;gBAEjEP,0BAA0BS;gBAC1BP,gBAAgBQ;YAClB,EAAE,OAAOC,OAAO;gBACdC,QAAQD,KAAK,CAAC,mCAAmCA;gBACjD,qCAAqC;gBACrCd,YAAY;gBACZG,0BAA0B;gBAC1BE,gBAAgB;YAClB;QACF;IACF,GAAG,EAAE;IAEL,yDAAyD;IACzDC,IAAAA,gBAAS,EAAC;QACR,IAAI,OAAOC,WAAW,aAAa;YACjC,IAAI;gBACF,IAAIR,UAAU;oBACZU,aAAaE,OAAO,CAAC,YAAYZ;gBACnC;gBACAU,aAAaE,OAAO,CAClB,0BACAT,uBAAuBc,QAAQ;gBAEjCP,aAAaE,OAAO,CAAC,gBAAgBP,aAAaY,QAAQ;YAC5D,EAAE,OAAOF,OAAO;gBACdC,QAAQD,KAAK,CAAC,kCAAkCA;YAClD;QACF;IACF,GAAG;QAACf;QAAUG;QAAwBE;KAAa;IAEnD,MAAMa,uBAAuB;QAC3BjB,YAAY;QACZG,0BAA0B;QAC1BE,gBAAgB;QAChB,IAAI,OAAOE,WAAW,aAAa;YACjC,IAAI;gBACFE,aAAaS,UAAU,CAAC;gBACxBT,aAAaS,UAAU,CAAC;gBACxBT,aAAaS,UAAU,CAAC;YAC1B,EAAE,OAAOJ,OAAO;gBACdC,QAAQD,KAAK,CAAC,qCAAqCA;YACrD;QACF;IACF;IAEA,MAAMK,QAA6B;QACjCpB;QACAC;QACAE;QACAC;QACAC;QACAC;QACAY;IACF;IAEA,qBACE,qBAACtB,gBAAgByB,QAAQ;QAACD,OAAOA;kBAC9BrB;;AAGP;AAEO,MAAMX,cAAc;IACzB,MAAMkC,UAAUC,IAAAA,iBAAU,EAAC3B;IAC3B,IAAI0B,YAAYxB,WAAW;QACzB,MAAM,IAAI0B,MAAM;IAClB;IACA,OAAOF;AACT;MAEA,WAAenC"}