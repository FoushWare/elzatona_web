{"version":3,"sources":["/Users/a.fouad/SideProjects/Elzatona-all/Elzatona-web/apps/website/src/app/api/questions/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { supabaseOperations, supabase } from '@/lib/supabase-server';\n\n// GET /api/questions - Get all questions with optional filtering\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const cardType = searchParams.get('cardType');\n    const category = searchParams.get('category');\n    const categories = searchParams.getAll('categories'); // Support multiple categories\n    const topic = searchParams.get('topic');\n    const subtopic = searchParams.get('subtopic'); // Support subtopic slug\n    const difficulty = searchParams.get('difficulty');\n    const type = searchParams.get('type');\n    const limit = searchParams.get('limit');\n\n    // Validate topic is a UUID, or resolve subtopic slug to topic ID\n    let topicId: string | undefined = undefined;\n\n    // Check if topic is a valid UUID format\n    const isValidUUID = (str: string) => {\n      const uuidRegex =\n        /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;\n      return uuidRegex.test(str);\n    };\n\n    if (topic && isValidUUID(topic)) {\n      topicId = topic;\n    } else if (subtopic || (topic && !isValidUUID(topic))) {\n      // Resolve topic/subtopic slug to topic ID\n      try {\n        const { data: topics, error: topicsError } =\n          await supabaseOperations.getTopics({\n            isActive: true,\n          });\n\n        if (!topicsError && topics) {\n          const slugToFind = subtopic || topic || '';\n          const slugLower = slugToFind.toLowerCase();\n\n          console.log(`ðŸ” API: Searching for topic/subtopic \"${slugToFind}\"`);\n\n          // Normalize slug for better matching (remove plural 's', handle common variations)\n          const normalizeForMatch = (str: string) => {\n            return str\n              .toLowerCase()\n              .replace(/s$/, '') // Remove trailing 's' for plural matching\n              .replace(/\\s+/g, '-')\n              .replace(/[^a-z0-9-]/g, '');\n          };\n\n          const slugNormalized = normalizeForMatch(slugLower);\n\n          // Try multiple matching strategies\n          const matchingTopic = (topics as any[]).find((t: any) => {\n            const topicSlug = t.slug?.toLowerCase() || '';\n            const topicName = t.name?.toLowerCase() || '';\n            const topicNameSlug = topicName.replace(/\\s+/g, '-');\n            const topicSlugNormalized = normalizeForMatch(topicSlug);\n            const topicNameNormalized = normalizeForMatch(topicName);\n\n            // Exact matches\n            if (\n              topicSlug === slugLower ||\n              topicNameSlug === slugLower ||\n              t.id?.toLowerCase() === slugLower\n            ) {\n              return true;\n            }\n\n            // Check if slug contains the subtopic (e.g., \"js-scope-closure\" contains \"closure\")\n            if (\n              topicSlug.includes(slugLower) ||\n              topicSlug.includes(slugNormalized)\n            ) {\n              return true;\n            }\n\n            // Check normalized matching (handles plural/singular)\n            if (\n              topicSlugNormalized.includes(slugNormalized) ||\n              slugNormalized.includes(topicSlugNormalized)\n            ) {\n              return true;\n            }\n\n            // Check if the subtopic appears as a word boundary in the slug\n            const escapedSlug = slugLower.replace(\n              /[.*+?^${}()|[\\]\\\\]/g,\n              '\\\\$&'\n            );\n            const escapedSlugNormalized = slugNormalized.replace(\n              /[.*+?^${}()|[\\]\\\\]/g,\n              '\\\\$&'\n            );\n\n            if (\n              new RegExp(`(^|-)${escapedSlug}(-|$)`).test(topicSlug) ||\n              new RegExp(`(^|-)${escapedSlugNormalized}(-|$)`).test(topicSlug)\n            ) {\n              return true;\n            }\n\n            // Check name matching\n            if (\n              topicName.includes(slugLower.replace(/-/g, ' ')) ||\n              topicNameNormalized.includes(slugNormalized) ||\n              slugNormalized.includes(topicNameNormalized)\n            ) {\n              return true;\n            }\n\n            return false;\n          });\n\n          if (matchingTopic) {\n            topicId = matchingTopic.id;\n            console.log(\n              `âœ… Resolved topic/subtopic \"${slugToFind}\" to topic: \"${matchingTopic.name}\" (ID: ${topicId})`\n            );\n          } else {\n            console.warn(\n              `âš ï¸ Could not resolve topic/subtopic \"${slugToFind}\" to a topic ID`\n            );\n            console.log(\n              'Available topics:',\n              (topics as any[]).slice(0, 10).map((t: any) => ({\n                id: t.id,\n                name: t.name,\n                slug: t.slug,\n              }))\n            );\n          }\n        }\n      } catch (error) {\n        console.error('Error resolving topic:', error);\n      }\n    }\n\n    const filters = {\n      topicId: topicId,\n      categoryId:\n        categories.length > 0 ? categories : category ? [category] : undefined,\n      difficulty: difficulty || undefined,\n      questionType: type || undefined,\n      is_active: true,\n      limit: limit ? parseInt(limit, 10) : undefined,\n      orderBy: 'created_at',\n      orderDirection: 'desc' as const,\n    };\n\n    // Log the filters being applied\n    console.log('ðŸ” API Questions Route - Applied Filters:', {\n      topicId: topicId || 'none',\n      categoryId: filters.categoryId || 'none',\n      difficulty: filters.difficulty || 'none',\n      questionType: filters.questionType || 'none',\n      limit: filters.limit || 'none',\n    });\n\n    // Get the filtered count (same filters, without limit)\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n\n    let countQuery = supabase\n      .from('questions')\n      .select('*', { count: 'exact', head: true });\n\n    countQuery = countQuery.eq('is_active', true);\n\n    if (filters.categoryId) {\n      if (Array.isArray(filters.categoryId)) {\n        countQuery = countQuery.in('category_id', filters.categoryId);\n      } else {\n        countQuery = countQuery.eq('category_id', filters.categoryId);\n      }\n    }\n    if (filters.difficulty) {\n      countQuery = countQuery.eq('difficulty', filters.difficulty);\n    }\n    if (filters.questionType) {\n      countQuery = countQuery.eq('question_type', filters.questionType);\n    }\n    if (filters.topicId) {\n      console.log(`ðŸ“Œ Applying topic_id filter: ${filters.topicId}`);\n      countQuery = countQuery.eq('topic_id', filters.topicId);\n    } else {\n      console.log('âš ï¸ No topic_id filter applied');\n    }\n\n    const { count: filteredCount } = await countQuery;\n\n    const { data: questions, error } =\n      await supabaseOperations.getQuestions(filters);\n\n    if (error) {\n      console.error('Supabase error fetching questions:', error);\n      throw new Error(\n        error.message || 'Failed to fetch questions from database'\n      );\n    }\n\n    // Handle null or undefined questions\n    if (!questions) {\n      console.warn('No questions returned from database');\n      return NextResponse.json({\n        success: true,\n        data: [],\n        count: 0,\n        totalCount: filteredCount || 0,\n      });\n    }\n\n    // Log the results for debugging\n    console.log(`ðŸ“Š Questions fetched: ${questions.length || 0}`);\n    if (filters.topicId && questions.length > 0) {\n      console.log(\n        'Sample question topic_ids:',\n        questions.slice(0, 3).map((q: any) => q.topic_id || 'NULL')\n      );\n    }\n\n    // Transform data to match expected format\n    const transformedQuestions =\n      (questions as any[])\n        ?.map(question => {\n          try {\n            // Try multiple possible field names for question text\n            const questionText =\n              question.question_text ||\n              question.question ||\n              question.title ||\n              question.content ||\n              question.text ||\n              '';\n\n            if (!questionText) {\n              console.warn('Question missing text field:', {\n                id: question.id,\n                availableFields: Object.keys(question),\n              });\n            }\n\n            return {\n              id: question.id,\n              question: questionText,\n              question_text: questionText, // Also include raw field for backward compatibility\n              answer: question.correct_answer,\n              explanation: question.explanation || '',\n              topicId: question.topic_id,\n              categoryId: question.category_id,\n              difficulty: question.difficulty,\n              type: question.question_type,\n              questionType: question.question_type,\n              options: question.options\n                ? typeof question.options === 'string'\n                  ? JSON.parse(question.options)\n                  : question.options\n                : null,\n              correctAnswer: question.correct_answer,\n              tags: question.tags\n                ? typeof question.tags === 'string'\n                  ? JSON.parse(question.tags)\n                  : question.tags\n                : [],\n              is_active: question.is_active,\n              created_at: question.created_at\n                ? new Date(question.created_at)\n                : new Date(),\n              updated_at: question.updated_at\n                ? new Date(question.updated_at)\n                : new Date(),\n            };\n          } catch (parseError) {\n            console.error('Error parsing question:', question.id, parseError);\n            return null;\n          }\n        })\n        .filter(q => q !== null && q.question) || []; // Filter out questions without text\n\n    // Additional filters that aren't handled by Supabase (already filtered by categoryId above)\n    const filteredQuestions = transformedQuestions;\n\n    if (cardType && cardType !== 'all') {\n      // This would need to be handled by joining with learning_cards table\n      // For now, we'll skip this filter\n    }\n\n    return NextResponse.json({\n      success: true,\n      data: filteredQuestions,\n      count: filteredCount || filteredQuestions.length, // Actual filtered count from database\n      totalCount: filteredCount || filteredQuestions.length, // Total count after filtering\n    });\n  } catch (error) {\n    console.error('Error fetching questions:', error);\n    const errorMessage =\n      error instanceof Error ? error.message : 'Failed to fetch questions';\n    return NextResponse.json(\n      {\n        success: false,\n        error: errorMessage,\n        details: error instanceof Error ? error.stack : String(error),\n      },\n      { status: 500 }\n    );\n  }\n}\n\n// POST /api/questions - Create a new question\nexport async function POST(request: NextRequest) {\n  try {\n    const questionData = await request.json();\n\n    // Transform data to match Supabase schema\n    const supabaseQuestionData = {\n      question_text: questionData.question,\n      explanation: questionData.explanation || '',\n      topic_id: questionData.topicId || undefined,\n      difficulty: questionData.difficulty || 'easy',\n      question_type:\n        questionData.type || questionData.questionType || 'multiple_choice',\n      options: questionData.options\n        ? JSON.stringify(questionData.options)\n        : undefined,\n      correct_answer:\n        questionData.answer || questionData.correctAnswer || undefined,\n      tags: questionData.tags ? JSON.stringify(questionData.tags) : undefined,\n      is_active: questionData.isActive !== false,\n    };\n\n    const { data: newQuestion, error } =\n      await supabaseOperations.createQuestion(supabaseQuestionData);\n\n    if (error) {\n      throw new Error(error.message);\n    }\n\n    // Transform response to match expected format\n    const transformedQuestion = {\n      id: (newQuestion as any).id,\n      question: (newQuestion as any).question_text,\n      answer: (newQuestion as any).correct_answer,\n      explanation: (newQuestion as any).explanation,\n      topicId: (newQuestion as any).topic_id,\n      difficulty: (newQuestion as any).difficulty,\n      type: (newQuestion as any).question_type,\n      questionType: (newQuestion as any).question_type,\n      options: (newQuestion as any).options\n        ? JSON.parse((newQuestion as any).options)\n        : null,\n      correctAnswer: (newQuestion as any).correct_answer,\n      tags: (newQuestion as any).tags\n        ? JSON.parse((newQuestion as any).tags)\n        : null,\n      is_active: (newQuestion as any).is_active,\n      created_at: new Date((newQuestion as any).created_at),\n      updated_at: new Date((newQuestion as any).updated_at),\n    };\n\n    return NextResponse.json({\n      success: true,\n      data: transformedQuestion,\n      message: 'Question created successfully',\n    });\n  } catch (error) {\n    console.error('Error creating question:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to create question' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":["GET","POST","request","searchParams","URL","url","cardType","get","category","categories","getAll","topic","subtopic","difficulty","type","limit","topicId","undefined","isValidUUID","str","uuidRegex","test","data","topics","error","topicsError","supabaseOperations","getTopics","isActive","slugToFind","slugLower","toLowerCase","console","log","normalizeForMatch","replace","slugNormalized","matchingTopic","find","t","topicSlug","slug","topicName","name","topicNameSlug","topicSlugNormalized","topicNameNormalized","id","includes","escapedSlug","escapedSlugNormalized","RegExp","warn","slice","map","filters","categoryId","length","questionType","is_active","parseInt","orderBy","orderDirection","supabase","Error","countQuery","from","select","count","head","eq","Array","isArray","in","filteredCount","questions","getQuestions","message","NextResponse","json","success","totalCount","q","topic_id","transformedQuestions","question","questionText","question_text","title","content","text","availableFields","Object","keys","answer","correct_answer","explanation","category_id","question_type","options","JSON","parse","correctAnswer","tags","created_at","Date","updated_at","parseError","filter","filteredQuestions","errorMessage","details","stack","String","status","questionData","supabaseQuestionData","stringify","newQuestion","createQuestion","transformedQuestion"],"mappings":"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"}