{"version":3,"sources":["/Users/a.fouad/SideProjects/Elzatona-all/Elzatona-web/libs/shared-hooks/src/lib/useUnifiedQuestions.ts"],"sourcesContent":["// v1.0 - Unified Questions Hook\n// React hook for managing questions from the unified Firebase system\n\nimport { useState, useEffect, useCallback } from 'react';\nimport {\n  UnifiedQuestion,\n  BulkQuestionData,\n  QuestionStats,\n  LearningPath,\n} from '@elzatona/shared-types';\n\ninterface UseUnifiedQuestionsOptions {\n  autoLoad?: boolean;\n  initialFilters?: {\n    category?: string;\n    subcategory?: string;\n    difficulty?: string;\n    learningPath?: string;\n    topic?: string;\n    sectionId?: string;\n    isActive?: boolean;\n    isComplete?: boolean;\n    limit?: number;\n  };\n}\n\ninterface UseUnifiedQuestionsReturn {\n  // Data\n  questions: UnifiedQuestion[];\n  currentQuestion: UnifiedQuestion | null;\n  learningPaths: LearningPath[];\n  stats: QuestionStats | null;\n\n  // Loading states\n  isLoading: boolean;\n  isCreating: boolean;\n  isUpdating: boolean;\n  isDeleting: boolean;\n\n  // Error states\n  error: string | null;\n\n  // Pagination state\n  currentPage: number;\n  pageSize: number;\n  totalCount: number;\n  totalPages: number;\n  hasNext: boolean;\n  hasPrev: boolean;\n\n  // Actions\n  loadQuestions: (\n    filters?: UseUnifiedQuestionsOptions['initialFilters']\n  ) => Promise<void>;\n  loadQuestion: (id: string) => Promise<void>;\n  loadLearningPaths: () => Promise<void>;\n  loadStats: () => Promise<void>;\n  createQuestion: (\n    questionData: Omit<UnifiedQuestion, 'id' | 'createdAt' | 'updatedAt'>\n  ) => Promise<string | null>;\n  updateQuestion: (\n    id: string,\n    updates: Partial<UnifiedQuestion>\n  ) => Promise<void>;\n  deleteQuestion: (id: string) => Promise<void>;\n  bulkImportQuestions: (\n    questions: BulkQuestionData[]\n  ) => Promise<{ success: number; failed: number; errors: string[] }>;\n  searchQuestions: (\n    searchTerm: string,\n    filters?: UseUnifiedQuestionsOptions['initialFilters']\n  ) => Promise<void>;\n  getRandomQuestions: (\n    count: number,\n    filters?: UseUnifiedQuestionsOptions['initialFilters']\n  ) => Promise<void>;\n\n  // Pagination actions\n  goToPage: (page: number) => void;\n  nextPage: () => void;\n  prevPage: () => void;\n  changePageSize: (pageSize: number) => void;\n\n  // Utilities\n  clearError: () => void;\n  clearQuestions: () => void;\n}\n\nexport function useUnifiedQuestions(\n  options: UseUnifiedQuestionsOptions = {}\n): UseUnifiedQuestionsReturn {\n  const { autoLoad = true, initialFilters } = options;\n\n  // State\n  const [questions, setQuestions] = useState<UnifiedQuestion[]>([]);\n  const [currentQuestion, setCurrentQuestion] =\n    useState<UnifiedQuestion | null>(null);\n  const [learningPaths, setLearningPaths] = useState<LearningPath[]>([]);\n  const [stats, setStats] = useState<QuestionStats | null>(null);\n\n  // Loading states\n  const [isLoading, setIsLoading] = useState(false);\n  const [isCreating, setIsCreating] = useState(false);\n  const [isUpdating, setIsUpdating] = useState(false);\n  const [isDeleting, setIsDeleting] = useState(false);\n\n  // Error state\n  const [error, setError] = useState<string | null>(null);\n\n  // Pagination state\n  const [currentPage, setCurrentPage] = useState(1);\n  const [pageSize, setPageSize] = useState(10);\n  const [totalCount, setTotalCount] = useState(0);\n  const [totalPages, setTotalPages] = useState(0);\n  const [hasNext, setHasNext] = useState(false);\n  const [hasPrev, setHasPrev] = useState(false);\n\n  // API calls\n  const apiCall = useCallback(\n    async (url: string, options: RequestInit = {}) => {\n      try {\n        const response = await fetch(url, {\n          headers: {\n            'Content-Type': 'application/json',\n            ...options.headers,\n          },\n          ...options,\n        });\n\n        if (!response.ok) {\n          const errorData = await response\n            .json()\n            .catch(() => ({ error: 'Unknown error' }));\n          throw new Error(errorData.error || `HTTP ${response.status}`);\n        }\n\n        return response.json();\n      } catch (err) {\n        // Handle Firebase \"Target ID already exists\" errors gracefully\n        if (\n          err instanceof Error &&\n          err.message.includes('Target ID already exists')\n        ) {\n          console.warn(\n            'Firebase listener conflict, retrying in 500ms...',\n            err.message\n          );\n          // Wait a bit and retry once\n          await new Promise(resolve => setTimeout(resolve, 500));\n          const response = await fetch(url, {\n            headers: {\n              'Content-Type': 'application/json',\n              ...options.headers,\n            },\n            ...options,\n          });\n\n          if (!response.ok) {\n            const errorData = await response\n              .json()\n              .catch(() => ({ error: 'Unknown error' }));\n            throw new Error(errorData.error || `HTTP ${response.status}`);\n          }\n\n          return response.json();\n        }\n        throw err;\n      }\n    },\n    []\n  );\n\n  // Load questions\n  const loadQuestions = useCallback(\n    async (\n      filters?: UseUnifiedQuestionsOptions['initialFilters'],\n      page: number = currentPage\n    ) => {\n      console.log(\n        'ðŸ”„ useUnifiedQuestions: loadQuestions called with filters:',\n        filters,\n        'page:',\n        page\n      );\n      setIsLoading(true);\n      setError(null);\n\n      try {\n        const queryParams = new URLSearchParams();\n\n        // Add pagination parameters\n        queryParams.append('page', String(page));\n        queryParams.append('pageSize', String(pageSize));\n        queryParams.append('includePagination', 'true');\n\n        if (filters) {\n          Object.entries(filters).forEach(([key, value]) => {\n            if (value !== undefined && value !== null) {\n              queryParams.append(key, String(value));\n            }\n          });\n        }\n\n        const url = `/api/questions/unified${queryParams.toString() ? `?${queryParams.toString()}` : ''}`;\n        console.log('ðŸ”„ useUnifiedQuestions: Making API call to:', url);\n        const response = await apiCall(url);\n        console.log('ðŸ”„ useUnifiedQuestions: API response received:', response);\n\n        if (response.success) {\n          console.log(\n            'âœ… useUnifiedQuestions: Questions loaded successfully:',\n            response.data\n          );\n          console.log(\n            'âœ… useUnifiedQuestions: Setting questions with data length:',\n            response.data?.length\n          );\n          setQuestions(response.data);\n\n          // Update pagination state\n          if (response.pagination) {\n            setCurrentPage(response.pagination.page);\n            setTotalCount(response.pagination.totalCount);\n            setTotalPages(response.pagination.totalPages);\n            setHasNext(response.pagination.hasNext);\n            setHasPrev(response.pagination.hasPrev);\n            console.log('ðŸ“„ Pagination updated:', response.pagination);\n          }\n        } else {\n          console.error(\n            'âŒ useUnifiedQuestions: Failed to load questions:',\n            response.error\n          );\n          throw new Error(response.error || 'Failed to load questions');\n        }\n      } catch (err) {\n        const errorMessage =\n          err instanceof Error ? err.message : 'Failed to load questions';\n        setError(errorMessage);\n        console.error('Error loading questions:', err);\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [apiCall, currentPage, pageSize]\n  );\n\n  // Load single question\n  const loadQuestion = useCallback(async (id: string) => {\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const response = await apiCall(`/api/questions/unified/${id}`);\n\n      if (response.success) {\n        setCurrentQuestion(response.data);\n      } else {\n        throw new Error(response.error || 'Failed to load question');\n      }\n    } catch (err) {\n      const errorMessage =\n        err instanceof Error ? err.message : 'Failed to load question';\n      setError(errorMessage);\n      console.error('Error loading question:', err);\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n\n  // Load learning paths\n  const loadLearningPaths = useCallback(async () => {\n    try {\n      const response = await apiCall('/api/questions/learning-paths');\n\n      if (response.success) {\n        setLearningPaths(response.data);\n      } else {\n        throw new Error(response.error || 'Failed to load learning paths');\n      }\n    } catch (err) {\n      const errorMessage =\n        err instanceof Error ? err.message : 'Failed to load learning paths';\n      setError(errorMessage);\n      console.error('Error loading learning paths:', err);\n      // Don't throw the error to prevent breaking the component\n    }\n  }, [apiCall]);\n\n  // Load statistics\n  const loadStats = useCallback(async () => {\n    try {\n      const response = await apiCall('/api/questions/stats');\n\n      if (response.success) {\n        setStats(response.data);\n      } else {\n        throw new Error(response.error || 'Failed to load statistics');\n      }\n    } catch (err) {\n      const errorMessage =\n        err instanceof Error ? err.message : 'Failed to load statistics';\n      setError(errorMessage);\n      console.error('Error loading statistics:', err);\n      // Don't throw the error to prevent breaking the component\n    }\n  }, [apiCall]);\n\n  // Create question\n  const createQuestion = useCallback(\n    async (\n      questionData: Omit<UnifiedQuestion, 'id' | 'createdAt' | 'updatedAt'>\n    ): Promise<string | null> => {\n      setIsCreating(true);\n      setError(null);\n\n      try {\n        const response = await apiCall('/api/questions/unified', {\n          method: 'POST',\n          body: JSON.stringify(questionData),\n        });\n\n        if (response.success) {\n          // Reload questions to include the new one\n          await loadQuestions(initialFilters);\n          return response.data.id;\n        } else {\n          throw new Error(response.error || 'Failed to create question');\n        }\n      } catch (err) {\n        const errorMessage =\n          err instanceof Error ? err.message : 'Failed to create question';\n        setError(errorMessage);\n        console.error('Error creating question:', err);\n        return null;\n      } finally {\n        setIsCreating(false);\n      }\n    },\n    [loadQuestions, initialFilters]\n  );\n\n  // Update question\n  const updateQuestion = useCallback(\n    async (id: string, updates: Partial<UnifiedQuestion>) => {\n      setIsUpdating(true);\n      setError(null);\n\n      try {\n        const response = await apiCall(`/api/questions/unified/${id}`, {\n          method: 'PUT',\n          body: JSON.stringify(updates),\n        });\n\n        if (response.success) {\n          // Update local state\n          setQuestions(prev =>\n            prev.map(q => (q.id === id ? { ...q, ...updates } : q))\n          );\n          if (currentQuestion?.id === id) {\n            setCurrentQuestion(prev => (prev ? { ...prev, ...updates } : null));\n          }\n        } else {\n          throw new Error(response.error || 'Failed to update question');\n        }\n      } catch (err) {\n        const errorMessage =\n          err instanceof Error ? err.message : 'Failed to update question';\n        setError(errorMessage);\n        console.error('Error updating question:', err);\n      } finally {\n        setIsUpdating(false);\n      }\n    },\n    [currentQuestion]\n  );\n\n  // Delete question\n  const deleteQuestion = useCallback(\n    async (id: string) => {\n      setIsDeleting(true);\n      setError(null);\n\n      try {\n        const response = await apiCall(`/api/questions/unified/${id}`, {\n          method: 'DELETE',\n        });\n\n        if (response.success) {\n          // Remove from local state\n          setQuestions(prev => prev.filter(q => q.id !== id));\n          if (currentQuestion?.id === id) {\n            setCurrentQuestion(null);\n          }\n        } else {\n          throw new Error(response.error || 'Failed to delete question');\n        }\n      } catch (err) {\n        const errorMessage =\n          err instanceof Error ? err.message : 'Failed to delete question';\n        setError(errorMessage);\n        console.error('Error deleting question:', err);\n      } finally {\n        setIsDeleting(false);\n      }\n    },\n    [currentQuestion]\n  );\n\n  // Bulk import questions\n  const bulkImportQuestions = useCallback(\n    async (\n      questionsData: BulkQuestionData[]\n    ): Promise<{ success: number; failed: number; errors: string[] }> => {\n      setIsCreating(true);\n      setError(null);\n\n      try {\n        // Flatten all questions from all BulkQuestionData objects\n        const allQuestions = questionsData.flatMap(\n          bulkData => bulkData.questions\n        );\n\n        console.log('ðŸš€ Sending questions to API:', {\n          totalQuestions: allQuestions.length,\n          firstQuestion: allQuestions[0]?.title || 'No title',\n          questionsDataLength: questionsData.length,\n        });\n\n        const response = await apiCall('/api/questions/unified', {\n          method: 'POST',\n          body: JSON.stringify({\n            questions: allQuestions,\n            isBulkImport: true,\n          }),\n        });\n\n        console.log('ðŸ“¥ API Response:', response);\n\n        if (response.success) {\n          // Reload questions to include the new ones\n          await loadQuestions(initialFilters);\n          return {\n            success: response.data?.length || allQuestions.length,\n            failed: 0,\n            errors: [],\n          };\n        } else {\n          throw new Error(response.error || 'Failed to bulk import questions');\n        }\n      } catch (err) {\n        const errorMessage =\n          err instanceof Error\n            ? err.message\n            : 'Failed to bulk import questions';\n        setError(errorMessage);\n        console.error('Error bulk importing questions:', err);\n        return {\n          success: 0,\n          failed: questionsData.flatMap(bd => bd.questions).length,\n          errors: [errorMessage],\n        };\n      } finally {\n        setIsCreating(false);\n      }\n    },\n    [loadQuestions, initialFilters]\n  );\n\n  // Search questions\n  const searchQuestions = useCallback(\n    async (\n      searchTerm: string,\n      filters?: UseUnifiedQuestionsOptions['initialFilters']\n    ) => {\n      setIsLoading(true);\n      setError(null);\n\n      try {\n        const queryParams = new URLSearchParams();\n        queryParams.append('search', searchTerm);\n\n        if (filters) {\n          Object.entries(filters).forEach(([key, value]) => {\n            if (value !== undefined && value !== null) {\n              queryParams.append(key, String(value));\n            }\n          });\n        }\n\n        const url = `/api/questions/unified/search?${queryParams.toString()}`;\n        const response = await apiCall(url);\n\n        if (response.success) {\n          setQuestions(response.data);\n        } else {\n          throw new Error(response.error || 'Failed to search questions');\n        }\n      } catch (err) {\n        const errorMessage =\n          err instanceof Error ? err.message : 'Failed to search questions';\n        setError(errorMessage);\n        console.error('Error searching questions:', err);\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    []\n  );\n\n  // Get random questions\n  const getRandomQuestions = useCallback(\n    async (\n      count: number,\n      filters?: UseUnifiedQuestionsOptions['initialFilters']\n    ) => {\n      setIsLoading(true);\n      setError(null);\n\n      try {\n        const queryParams = new URLSearchParams();\n        queryParams.append('random', 'true');\n        queryParams.append('count', String(count));\n\n        if (filters) {\n          Object.entries(filters).forEach(([key, value]) => {\n            if (value !== undefined && value !== null) {\n              queryParams.append(key, String(value));\n            }\n          });\n        }\n\n        const url = `/api/questions/unified?${queryParams.toString()}`;\n        const response = await apiCall(url);\n\n        if (response.success) {\n          setQuestions(response.data);\n        } else {\n          throw new Error(response.error || 'Failed to get random questions');\n        }\n      } catch (err) {\n        const errorMessage =\n          err instanceof Error ? err.message : 'Failed to get random questions';\n        setError(errorMessage);\n        console.error('Error getting random questions:', err);\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    []\n  );\n\n  // Utility functions\n  const clearError = useCallback(() => {\n    setError(null);\n  }, []);\n\n  const clearQuestions = useCallback(() => {\n    setQuestions([]);\n    setCurrentQuestion(null);\n  }, []);\n\n  // Auto-load on mount\n  useEffect(() => {\n    console.log(\n      'ðŸ”„ useUnifiedQuestions: useEffect called with autoLoad:',\n      autoLoad\n    );\n    if (autoLoad) {\n      console.log(\n        'ðŸ”„ useUnifiedQuestions: autoLoad is true, calling loadQuestions'\n      );\n\n      // Load questions first, then other data with delays to prevent Firebase conflicts\n      const loadDataSequentially = async () => {\n        try {\n          await loadQuestions(initialFilters);\n\n          // Add small delays between API calls to prevent Firebase \"Target ID already exists\" errors\n          setTimeout(() => {\n            loadLearningPaths().catch(err =>\n              console.error('Error loading learning paths:', err)\n            );\n          }, 100);\n\n          setTimeout(() => {\n            loadStats().catch(err =>\n              console.error('Error loading stats:', err)\n            );\n          }, 200);\n        } catch (err) {\n          console.error('Error in sequential data loading:', err);\n        }\n      };\n\n      loadDataSequentially();\n    }\n  }, [autoLoad, loadQuestions, loadLearningPaths, loadStats, initialFilters]);\n\n  // Pagination functions\n  const goToPage = useCallback(\n    (page: number) => {\n      if (page >= 1 && page <= totalPages) {\n        setCurrentPage(page);\n        loadQuestions(initialFilters, page);\n      }\n    },\n    [totalPages, loadQuestions, initialFilters]\n  );\n\n  const nextPage = useCallback(() => {\n    if (hasNext) {\n      goToPage(currentPage + 1);\n    }\n  }, [hasNext, currentPage, goToPage]);\n\n  const prevPage = useCallback(() => {\n    if (hasPrev) {\n      goToPage(currentPage - 1);\n    }\n  }, [hasPrev, currentPage, goToPage]);\n\n  const changePageSize = useCallback(\n    (newPageSize: number) => {\n      setPageSize(newPageSize);\n      setCurrentPage(1);\n      loadQuestions(initialFilters, 1);\n    },\n    [loadQuestions, initialFilters]\n  );\n\n  return {\n    // Data\n    questions,\n    currentQuestion,\n    learningPaths,\n    stats,\n\n    // Loading states\n    isLoading,\n    isCreating,\n    isUpdating,\n    isDeleting,\n\n    // Error state\n    error,\n\n    // Pagination state\n    currentPage,\n    pageSize,\n    totalCount,\n    totalPages,\n    hasNext,\n    hasPrev,\n\n    // Actions\n    loadQuestions,\n    loadQuestion,\n    loadLearningPaths,\n    loadStats,\n    createQuestion,\n    updateQuestion,\n    deleteQuestion,\n    bulkImportQuestions,\n    searchQuestions,\n    getRandomQuestions,\n\n    // Pagination actions\n    goToPage,\n    nextPage,\n    prevPage,\n    changePageSize,\n\n    // Utilities\n    clearError,\n    clearQuestions,\n  };\n}\n\n// export default useUnifiedQuestions; // Removed default export, use named export instead\n"],"names":["useUnifiedQuestions","options","autoLoad","initialFilters","questions","setQuestions","useState","currentQuestion","setCurrentQuestion","learningPaths","setLearningPaths","stats","setStats","isLoading","setIsLoading","isCreating","setIsCreating","isUpdating","setIsUpdating","isDeleting","setIsDeleting","error","setError","currentPage","setCurrentPage","pageSize","setPageSize","totalCount","setTotalCount","totalPages","setTotalPages","hasNext","setHasNext","hasPrev","setHasPrev","apiCall","useCallback","url","response","fetch","headers","ok","errorData","json","catch","Error","status","err","message","includes","console","warn","Promise","resolve","setTimeout","loadQuestions","filters","page","log","queryParams","URLSearchParams","append","String","Object","entries","forEach","key","value","undefined","toString","success","data","length","pagination","errorMessage","loadQuestion","id","loadLearningPaths","loadStats","createQuestion","questionData","method","body","JSON","stringify","updateQuestion","updates","prev","map","q","deleteQuestion","filter","bulkImportQuestions","questionsData","allQuestions","flatMap","bulkData","totalQuestions","firstQuestion","title","questionsDataLength","isBulkImport","failed","errors","bd","searchQuestions","searchTerm","getRandomQuestions","count","clearError","clearQuestions","useEffect","loadDataSequentially","goToPage","nextPage","prevPage","changePageSize","newPageSize"],"mappings":"AAAA,gCAAgC;AAChC,qEAAqE;;;;;+BAuFrDA;;;eAAAA;;;uBArFiC;AAqF1C,SAASA,oBACdC,UAAsC,CAAC,CAAC;IAExC,MAAM,EAAEC,WAAW,IAAI,EAAEC,cAAc,EAAE,GAAGF;IAE5C,QAAQ;IACR,MAAM,CAACG,WAAWC,aAAa,GAAGC,IAAAA,eAAQ,EAAoB,EAAE;IAChE,MAAM,CAACC,iBAAiBC,mBAAmB,GACzCF,IAAAA,eAAQ,EAAyB;IACnC,MAAM,CAACG,eAAeC,iBAAiB,GAAGJ,IAAAA,eAAQ,EAAiB,EAAE;IACrE,MAAM,CAACK,OAAOC,SAAS,GAAGN,IAAAA,eAAQ,EAAuB;IAEzD,iBAAiB;IACjB,MAAM,CAACO,WAAWC,aAAa,GAAGR,IAAAA,eAAQ,EAAC;IAC3C,MAAM,CAACS,YAAYC,cAAc,GAAGV,IAAAA,eAAQ,EAAC;IAC7C,MAAM,CAACW,YAAYC,cAAc,GAAGZ,IAAAA,eAAQ,EAAC;IAC7C,MAAM,CAACa,YAAYC,cAAc,GAAGd,IAAAA,eAAQ,EAAC;IAE7C,cAAc;IACd,MAAM,CAACe,OAAOC,SAAS,GAAGhB,IAAAA,eAAQ,EAAgB;IAElD,mBAAmB;IACnB,MAAM,CAACiB,aAAaC,eAAe,GAAGlB,IAAAA,eAAQ,EAAC;IAC/C,MAAM,CAACmB,UAAUC,YAAY,GAAGpB,IAAAA,eAAQ,EAAC;IACzC,MAAM,CAACqB,YAAYC,cAAc,GAAGtB,IAAAA,eAAQ,EAAC;IAC7C,MAAM,CAACuB,YAAYC,cAAc,GAAGxB,IAAAA,eAAQ,EAAC;IAC7C,MAAM,CAACyB,SAASC,WAAW,GAAG1B,IAAAA,eAAQ,EAAC;IACvC,MAAM,CAAC2B,SAASC,WAAW,GAAG5B,IAAAA,eAAQ,EAAC;IAEvC,YAAY;IACZ,MAAM6B,UAAUC,IAAAA,kBAAW,EACzB,OAAOC,KAAapC,UAAuB,CAAC,CAAC;QAC3C,IAAI;YACF,MAAMqC,WAAW,MAAMC,MAAMF,KAAK;gBAChCG,SAAS;oBACP,gBAAgB;oBAChB,GAAGvC,QAAQuC,OAAO;gBACpB;gBACA,GAAGvC,OAAO;YACZ;YAEA,IAAI,CAACqC,SAASG,EAAE,EAAE;gBAChB,MAAMC,YAAY,MAAMJ,SACrBK,IAAI,GACJC,KAAK,CAAC,IAAO,CAAA;wBAAEvB,OAAO;oBAAgB,CAAA;gBACzC,MAAM,IAAIwB,MAAMH,UAAUrB,KAAK,IAAI,CAAC,KAAK,EAAEiB,SAASQ,MAAM,EAAE;YAC9D;YAEA,OAAOR,SAASK,IAAI;QACtB,EAAE,OAAOI,KAAK;YACZ,+DAA+D;YAC/D,IACEA,eAAeF,SACfE,IAAIC,OAAO,CAACC,QAAQ,CAAC,6BACrB;gBACAC,QAAQC,IAAI,CACV,oDACAJ,IAAIC,OAAO;gBAEb,4BAA4B;gBAC5B,MAAM,IAAII,QAAQC,CAAAA,UAAWC,WAAWD,SAAS;gBACjD,MAAMf,WAAW,MAAMC,MAAMF,KAAK;oBAChCG,SAAS;wBACP,gBAAgB;wBAChB,GAAGvC,QAAQuC,OAAO;oBACpB;oBACA,GAAGvC,OAAO;gBACZ;gBAEA,IAAI,CAACqC,SAASG,EAAE,EAAE;oBAChB,MAAMC,YAAY,MAAMJ,SACrBK,IAAI,GACJC,KAAK,CAAC,IAAO,CAAA;4BAAEvB,OAAO;wBAAgB,CAAA;oBACzC,MAAM,IAAIwB,MAAMH,UAAUrB,KAAK,IAAI,CAAC,KAAK,EAAEiB,SAASQ,MAAM,EAAE;gBAC9D;gBAEA,OAAOR,SAASK,IAAI;YACtB;YACA,MAAMI;QACR;IACF,GACA,EAAE;IAGJ,iBAAiB;IACjB,MAAMQ,gBAAgBnB,IAAAA,kBAAW,EAC/B,OACEoB,SACAC,OAAelC,WAAW;QAE1B2B,QAAQQ,GAAG,CACT,8DACAF,SACA,SACAC;QAEF3C,aAAa;QACbQ,SAAS;QAET,IAAI;YACF,MAAMqC,cAAc,IAAIC;YAExB,4BAA4B;YAC5BD,YAAYE,MAAM,CAAC,QAAQC,OAAOL;YAClCE,YAAYE,MAAM,CAAC,YAAYC,OAAOrC;YACtCkC,YAAYE,MAAM,CAAC,qBAAqB;YAExC,IAAIL,SAAS;gBACXO,OAAOC,OAAO,CAACR,SAASS,OAAO,CAAC,CAAC,CAACC,KAAKC,MAAM;oBAC3C,IAAIA,UAAUC,aAAaD,UAAU,MAAM;wBACzCR,YAAYE,MAAM,CAACK,KAAKJ,OAAOK;oBACjC;gBACF;YACF;YAEA,MAAM9B,MAAM,CAAC,sBAAsB,EAAEsB,YAAYU,QAAQ,KAAK,CAAC,CAAC,EAAEV,YAAYU,QAAQ,IAAI,GAAG,IAAI;YACjGnB,QAAQQ,GAAG,CAAC,+CAA+CrB;YAC3D,MAAMC,WAAW,MAAMH,QAAQE;YAC/Ba,QAAQQ,GAAG,CAAC,kDAAkDpB;YAE9D,IAAIA,SAASgC,OAAO,EAAE;gBACpBpB,QAAQQ,GAAG,CACT,yDACApB,SAASiC,IAAI;gBAEfrB,QAAQQ,GAAG,CACT,8DACApB,SAASiC,IAAI,EAAEC;gBAEjBnE,aAAaiC,SAASiC,IAAI;gBAE1B,0BAA0B;gBAC1B,IAAIjC,SAASmC,UAAU,EAAE;oBACvBjD,eAAec,SAASmC,UAAU,CAAChB,IAAI;oBACvC7B,cAAcU,SAASmC,UAAU,CAAC9C,UAAU;oBAC5CG,cAAcQ,SAASmC,UAAU,CAAC5C,UAAU;oBAC5CG,WAAWM,SAASmC,UAAU,CAAC1C,OAAO;oBACtCG,WAAWI,SAASmC,UAAU,CAACxC,OAAO;oBACtCiB,QAAQQ,GAAG,CAAC,0BAA0BpB,SAASmC,UAAU;gBAC3D;YACF,OAAO;gBACLvB,QAAQ7B,KAAK,CACX,oDACAiB,SAASjB,KAAK;gBAEhB,MAAM,IAAIwB,MAAMP,SAASjB,KAAK,IAAI;YACpC;QACF,EAAE,OAAO0B,KAAK;YACZ,MAAM2B,eACJ3B,eAAeF,QAAQE,IAAIC,OAAO,GAAG;YACvC1B,SAASoD;YACTxB,QAAQ7B,KAAK,CAAC,4BAA4B0B;QAC5C,SAAU;YACRjC,aAAa;QACf;IACF,GACA;QAACqB;QAASZ;QAAaE;KAAS;IAGlC,uBAAuB;IACvB,MAAMkD,eAAevC,IAAAA,kBAAW,EAAC,OAAOwC;QACtC9D,aAAa;QACbQ,SAAS;QAET,IAAI;YACF,MAAMgB,WAAW,MAAMH,QAAQ,CAAC,uBAAuB,EAAEyC,IAAI;YAE7D,IAAItC,SAASgC,OAAO,EAAE;gBACpB9D,mBAAmB8B,SAASiC,IAAI;YAClC,OAAO;gBACL,MAAM,IAAI1B,MAAMP,SAASjB,KAAK,IAAI;YACpC;QACF,EAAE,OAAO0B,KAAK;YACZ,MAAM2B,eACJ3B,eAAeF,QAAQE,IAAIC,OAAO,GAAG;YACvC1B,SAASoD;YACTxB,QAAQ7B,KAAK,CAAC,2BAA2B0B;QAC3C,SAAU;YACRjC,aAAa;QACf;IACF,GAAG,EAAE;IAEL,sBAAsB;IACtB,MAAM+D,oBAAoBzC,IAAAA,kBAAW,EAAC;QACpC,IAAI;YACF,MAAME,WAAW,MAAMH,QAAQ;YAE/B,IAAIG,SAASgC,OAAO,EAAE;gBACpB5D,iBAAiB4B,SAASiC,IAAI;YAChC,OAAO;gBACL,MAAM,IAAI1B,MAAMP,SAASjB,KAAK,IAAI;YACpC;QACF,EAAE,OAAO0B,KAAK;YACZ,MAAM2B,eACJ3B,eAAeF,QAAQE,IAAIC,OAAO,GAAG;YACvC1B,SAASoD;YACTxB,QAAQ7B,KAAK,CAAC,iCAAiC0B;QAC/C,0DAA0D;QAC5D;IACF,GAAG;QAACZ;KAAQ;IAEZ,kBAAkB;IAClB,MAAM2C,YAAY1C,IAAAA,kBAAW,EAAC;QAC5B,IAAI;YACF,MAAME,WAAW,MAAMH,QAAQ;YAE/B,IAAIG,SAASgC,OAAO,EAAE;gBACpB1D,SAAS0B,SAASiC,IAAI;YACxB,OAAO;gBACL,MAAM,IAAI1B,MAAMP,SAASjB,KAAK,IAAI;YACpC;QACF,EAAE,OAAO0B,KAAK;YACZ,MAAM2B,eACJ3B,eAAeF,QAAQE,IAAIC,OAAO,GAAG;YACvC1B,SAASoD;YACTxB,QAAQ7B,KAAK,CAAC,6BAA6B0B;QAC3C,0DAA0D;QAC5D;IACF,GAAG;QAACZ;KAAQ;IAEZ,kBAAkB;IAClB,MAAM4C,iBAAiB3C,IAAAA,kBAAW,EAChC,OACE4C;QAEAhE,cAAc;QACdM,SAAS;QAET,IAAI;YACF,MAAMgB,WAAW,MAAMH,QAAQ,0BAA0B;gBACvD8C,QAAQ;gBACRC,MAAMC,KAAKC,SAAS,CAACJ;YACvB;YAEA,IAAI1C,SAASgC,OAAO,EAAE;gBACpB,0CAA0C;gBAC1C,MAAMf,cAAcpD;gBACpB,OAAOmC,SAASiC,IAAI,CAACK,EAAE;YACzB,OAAO;gBACL,MAAM,IAAI/B,MAAMP,SAASjB,KAAK,IAAI;YACpC;QACF,EAAE,OAAO0B,KAAK;YACZ,MAAM2B,eACJ3B,eAAeF,QAAQE,IAAIC,OAAO,GAAG;YACvC1B,SAASoD;YACTxB,QAAQ7B,KAAK,CAAC,4BAA4B0B;YAC1C,OAAO;QACT,SAAU;YACR/B,cAAc;QAChB;IACF,GACA;QAACuC;QAAepD;KAAe;IAGjC,kBAAkB;IAClB,MAAMkF,iBAAiBjD,IAAAA,kBAAW,EAChC,OAAOwC,IAAYU;QACjBpE,cAAc;QACdI,SAAS;QAET,IAAI;YACF,MAAMgB,WAAW,MAAMH,QAAQ,CAAC,uBAAuB,EAAEyC,IAAI,EAAE;gBAC7DK,QAAQ;gBACRC,MAAMC,KAAKC,SAAS,CAACE;YACvB;YAEA,IAAIhD,SAASgC,OAAO,EAAE;gBACpB,qBAAqB;gBACrBjE,aAAakF,CAAAA,OACXA,KAAKC,GAAG,CAACC,CAAAA,IAAMA,EAAEb,EAAE,KAAKA,KAAK;4BAAE,GAAGa,CAAC;4BAAE,GAAGH,OAAO;wBAAC,IAAIG;gBAEtD,IAAIlF,iBAAiBqE,OAAOA,IAAI;oBAC9BpE,mBAAmB+E,CAAAA,OAASA,OAAO;4BAAE,GAAGA,IAAI;4BAAE,GAAGD,OAAO;wBAAC,IAAI;gBAC/D;YACF,OAAO;gBACL,MAAM,IAAIzC,MAAMP,SAASjB,KAAK,IAAI;YACpC;QACF,EAAE,OAAO0B,KAAK;YACZ,MAAM2B,eACJ3B,eAAeF,QAAQE,IAAIC,OAAO,GAAG;YACvC1B,SAASoD;YACTxB,QAAQ7B,KAAK,CAAC,4BAA4B0B;QAC5C,SAAU;YACR7B,cAAc;QAChB;IACF,GACA;QAACX;KAAgB;IAGnB,kBAAkB;IAClB,MAAMmF,iBAAiBtD,IAAAA,kBAAW,EAChC,OAAOwC;QACLxD,cAAc;QACdE,SAAS;QAET,IAAI;YACF,MAAMgB,WAAW,MAAMH,QAAQ,CAAC,uBAAuB,EAAEyC,IAAI,EAAE;gBAC7DK,QAAQ;YACV;YAEA,IAAI3C,SAASgC,OAAO,EAAE;gBACpB,0BAA0B;gBAC1BjE,aAAakF,CAAAA,OAAQA,KAAKI,MAAM,CAACF,CAAAA,IAAKA,EAAEb,EAAE,KAAKA;gBAC/C,IAAIrE,iBAAiBqE,OAAOA,IAAI;oBAC9BpE,mBAAmB;gBACrB;YACF,OAAO;gBACL,MAAM,IAAIqC,MAAMP,SAASjB,KAAK,IAAI;YACpC;QACF,EAAE,OAAO0B,KAAK;YACZ,MAAM2B,eACJ3B,eAAeF,QAAQE,IAAIC,OAAO,GAAG;YACvC1B,SAASoD;YACTxB,QAAQ7B,KAAK,CAAC,4BAA4B0B;QAC5C,SAAU;YACR3B,cAAc;QAChB;IACF,GACA;QAACb;KAAgB;IAGnB,wBAAwB;IACxB,MAAMqF,sBAAsBxD,IAAAA,kBAAW,EACrC,OACEyD;QAEA7E,cAAc;QACdM,SAAS;QAET,IAAI;YACF,0DAA0D;YAC1D,MAAMwE,eAAeD,cAAcE,OAAO,CACxCC,CAAAA,WAAYA,SAAS5F,SAAS;YAGhC8C,QAAQQ,GAAG,CAAC,gCAAgC;gBAC1CuC,gBAAgBH,aAAatB,MAAM;gBACnC0B,eAAeJ,YAAY,CAAC,EAAE,EAAEK,SAAS;gBACzCC,qBAAqBP,cAAcrB,MAAM;YAC3C;YAEA,MAAMlC,WAAW,MAAMH,QAAQ,0BAA0B;gBACvD8C,QAAQ;gBACRC,MAAMC,KAAKC,SAAS,CAAC;oBACnBhF,WAAW0F;oBACXO,cAAc;gBAChB;YACF;YAEAnD,QAAQQ,GAAG,CAAC,oBAAoBpB;YAEhC,IAAIA,SAASgC,OAAO,EAAE;gBACpB,2CAA2C;gBAC3C,MAAMf,cAAcpD;gBACpB,OAAO;oBACLmE,SAAShC,SAASiC,IAAI,EAAEC,UAAUsB,aAAatB,MAAM;oBACrD8B,QAAQ;oBACRC,QAAQ,EAAE;gBACZ;YACF,OAAO;gBACL,MAAM,IAAI1D,MAAMP,SAASjB,KAAK,IAAI;YACpC;QACF,EAAE,OAAO0B,KAAK;YACZ,MAAM2B,eACJ3B,eAAeF,QACXE,IAAIC,OAAO,GACX;YACN1B,SAASoD;YACTxB,QAAQ7B,KAAK,CAAC,mCAAmC0B;YACjD,OAAO;gBACLuB,SAAS;gBACTgC,QAAQT,cAAcE,OAAO,CAACS,CAAAA,KAAMA,GAAGpG,SAAS,EAAEoE,MAAM;gBACxD+B,QAAQ;oBAAC7B;iBAAa;YACxB;QACF,SAAU;YACR1D,cAAc;QAChB;IACF,GACA;QAACuC;QAAepD;KAAe;IAGjC,mBAAmB;IACnB,MAAMsG,kBAAkBrE,IAAAA,kBAAW,EACjC,OACEsE,YACAlD;QAEA1C,aAAa;QACbQ,SAAS;QAET,IAAI;YACF,MAAMqC,cAAc,IAAIC;YACxBD,YAAYE,MAAM,CAAC,UAAU6C;YAE7B,IAAIlD,SAAS;gBACXO,OAAOC,OAAO,CAACR,SAASS,OAAO,CAAC,CAAC,CAACC,KAAKC,MAAM;oBAC3C,IAAIA,UAAUC,aAAaD,UAAU,MAAM;wBACzCR,YAAYE,MAAM,CAACK,KAAKJ,OAAOK;oBACjC;gBACF;YACF;YAEA,MAAM9B,MAAM,CAAC,8BAA8B,EAAEsB,YAAYU,QAAQ,IAAI;YACrE,MAAM/B,WAAW,MAAMH,QAAQE;YAE/B,IAAIC,SAASgC,OAAO,EAAE;gBACpBjE,aAAaiC,SAASiC,IAAI;YAC5B,OAAO;gBACL,MAAM,IAAI1B,MAAMP,SAASjB,KAAK,IAAI;YACpC;QACF,EAAE,OAAO0B,KAAK;YACZ,MAAM2B,eACJ3B,eAAeF,QAAQE,IAAIC,OAAO,GAAG;YACvC1B,SAASoD;YACTxB,QAAQ7B,KAAK,CAAC,8BAA8B0B;QAC9C,SAAU;YACRjC,aAAa;QACf;IACF,GACA,EAAE;IAGJ,uBAAuB;IACvB,MAAM6F,qBAAqBvE,IAAAA,kBAAW,EACpC,OACEwE,OACApD;QAEA1C,aAAa;QACbQ,SAAS;QAET,IAAI;YACF,MAAMqC,cAAc,IAAIC;YACxBD,YAAYE,MAAM,CAAC,UAAU;YAC7BF,YAAYE,MAAM,CAAC,SAASC,OAAO8C;YAEnC,IAAIpD,SAAS;gBACXO,OAAOC,OAAO,CAACR,SAASS,OAAO,CAAC,CAAC,CAACC,KAAKC,MAAM;oBAC3C,IAAIA,UAAUC,aAAaD,UAAU,MAAM;wBACzCR,YAAYE,MAAM,CAACK,KAAKJ,OAAOK;oBACjC;gBACF;YACF;YAEA,MAAM9B,MAAM,CAAC,uBAAuB,EAAEsB,YAAYU,QAAQ,IAAI;YAC9D,MAAM/B,WAAW,MAAMH,QAAQE;YAE/B,IAAIC,SAASgC,OAAO,EAAE;gBACpBjE,aAAaiC,SAASiC,IAAI;YAC5B,OAAO;gBACL,MAAM,IAAI1B,MAAMP,SAASjB,KAAK,IAAI;YACpC;QACF,EAAE,OAAO0B,KAAK;YACZ,MAAM2B,eACJ3B,eAAeF,QAAQE,IAAIC,OAAO,GAAG;YACvC1B,SAASoD;YACTxB,QAAQ7B,KAAK,CAAC,mCAAmC0B;QACnD,SAAU;YACRjC,aAAa;QACf;IACF,GACA,EAAE;IAGJ,oBAAoB;IACpB,MAAM+F,aAAazE,IAAAA,kBAAW,EAAC;QAC7Bd,SAAS;IACX,GAAG,EAAE;IAEL,MAAMwF,iBAAiB1E,IAAAA,kBAAW,EAAC;QACjC/B,aAAa,EAAE;QACfG,mBAAmB;IACrB,GAAG,EAAE;IAEL,qBAAqB;IACrBuG,IAAAA,gBAAS,EAAC;QACR7D,QAAQQ,GAAG,CACT,2DACAxD;QAEF,IAAIA,UAAU;YACZgD,QAAQQ,GAAG,CACT;YAGF,kFAAkF;YAClF,MAAMsD,uBAAuB;gBAC3B,IAAI;oBACF,MAAMzD,cAAcpD;oBAEpB,2FAA2F;oBAC3FmD,WAAW;wBACTuB,oBAAoBjC,KAAK,CAACG,CAAAA,MACxBG,QAAQ7B,KAAK,CAAC,iCAAiC0B;oBAEnD,GAAG;oBAEHO,WAAW;wBACTwB,YAAYlC,KAAK,CAACG,CAAAA,MAChBG,QAAQ7B,KAAK,CAAC,wBAAwB0B;oBAE1C,GAAG;gBACL,EAAE,OAAOA,KAAK;oBACZG,QAAQ7B,KAAK,CAAC,qCAAqC0B;gBACrD;YACF;YAEAiE;QACF;IACF,GAAG;QAAC9G;QAAUqD;QAAesB;QAAmBC;QAAW3E;KAAe;IAE1E,uBAAuB;IACvB,MAAM8G,WAAW7E,IAAAA,kBAAW,EAC1B,CAACqB;QACC,IAAIA,QAAQ,KAAKA,QAAQ5B,YAAY;YACnCL,eAAeiC;YACfF,cAAcpD,gBAAgBsD;QAChC;IACF,GACA;QAAC5B;QAAY0B;QAAepD;KAAe;IAG7C,MAAM+G,WAAW9E,IAAAA,kBAAW,EAAC;QAC3B,IAAIL,SAAS;YACXkF,SAAS1F,cAAc;QACzB;IACF,GAAG;QAACQ;QAASR;QAAa0F;KAAS;IAEnC,MAAME,WAAW/E,IAAAA,kBAAW,EAAC;QAC3B,IAAIH,SAAS;YACXgF,SAAS1F,cAAc;QACzB;IACF,GAAG;QAACU;QAASV;QAAa0F;KAAS;IAEnC,MAAMG,iBAAiBhF,IAAAA,kBAAW,EAChC,CAACiF;QACC3F,YAAY2F;QACZ7F,eAAe;QACf+B,cAAcpD,gBAAgB;IAChC,GACA;QAACoD;QAAepD;KAAe;IAGjC,OAAO;QACL,OAAO;QACPC;QACAG;QACAE;QACAE;QAEA,iBAAiB;QACjBE;QACAE;QACAE;QACAE;QAEA,cAAc;QACdE;QAEA,mBAAmB;QACnBE;QACAE;QACAE;QACAE;QACAE;QACAE;QAEA,UAAU;QACVsB;QACAoB;QACAE;QACAC;QACAC;QACAM;QACAK;QACAE;QACAa;QACAE;QAEA,qBAAqB;QACrBM;QACAC;QACAC;QACAC;QAEA,YAAY;QACZP;QACAC;IACF;AACF,EAEA,0FAA0F"}