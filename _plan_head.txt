# Implementation Plan: Comprehensive Security & Code Quality Fixes

**Branch**: `008-security-fixes-plan` | **Date**: 2026-02-15 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/008-security-fixes-plan/spec.md`

## Summary

Resolve all security vulnerabilities and code quality issues in the elzatona_web repository to achieve Constitution compliance: 0 Critical/High vulnerabilities and SonarQube quality gate PASS. This plan produces **10 PRs** organized by priority, targeting 3 Trivy CVEs, ~97 Gitleaks secret alerts, and 93 SonarQube HIGH/BLOCKER issues. Additionally, 8 existing fix PRs (#7510–#7517) need pipeline resolution.

## Technical Context

**Language/Version**: TypeScript 5.x, Node.js 20+, Next.js 16.1.0 → 16.1.5
**Primary Dependencies**: Next.js (App Router), React 19, Supabase, Firebase, Nx 21.x, Tailwind CSS
**Storage**: Supabase (PostgreSQL), Firebase Firestore
**Testing**: Vitest (unit), Playwright (E2E)
**Target Platform**: Vercel (production), Linux containers (CI)
**Project Type**: Web (Nx monorepo with 2 apps + 11 libs)
**Performance Goals**: N/A (security/quality remediation, no new features)
**Constraints**: All PRs must pass SonarCloud CI, Prettier formatting, TypeScript strict mode
**Scale/Scope**: ~100 files affected across 10 PRs, resolving ~193 total alerts

## Constitution Check

_GATE: Must pass before Phase 0 research. Re-check after Phase 1 design._

- [x] **Spec-Driven**: Feature has a detailed spec in `specs/008-security-fixes-plan/spec.md`
- [x] **Testable**: Each PR contract includes verification steps; existing tests must not break
- [x] **Strict Types**: No `any` types introduced; strict mode maintained throughout
- [x] **Security**: All fixes directly address security vulnerabilities (CVEs, leaked secrets, code smells)
- [x] **Predictable**: Each PR maps to specific alerts with measurable outcomes (alert count → 0)

### Post-Design Re-Evaluation ✅

- [x] **Spec-Driven**: 10 detailed PR contracts created in `contracts/`
- [x] **Testable**: Each contract specifies verification commands (`npx next build`, SonarQube scan)
- [x] **Strict Types**: Refactored functions maintain type safety; no `any` introduced
- [x] **Security**: Covers all 3 CVEs, ~97 secrets, 93 code quality issues, 8 PR pipeline fixes
- [x] **Predictable**: Execution order defined with dependencies in quickstart.md

## Project Structure

### Documentation (this feature)

```text
specs/008-security-fixes-plan/
├── plan.md              # This file (implementation plan)
├── spec.md              # Feature specification
├── research.md          # Phase 0: research findings
├── data-model.md        # Phase 1: affected code inventory
├── quickstart.md        # Phase 1: 10-PR execution overview
├── contracts/
│   ├── PR01-nextjs-cve-upgrade.md
│   ├── PR02-sonar-blocker-auth-config.md
│   ├── PR03-sonar-quick-fixes.md
│   ├── PR04-sonar-nested-functions.md
│   ├── PR05-sonar-complexity-api-routes.md
│   ├── PR06-sonar-complexity-ui-components.md
│   ├── PR07-sonar-complexity-utils.md
│   ├── PR08-gitleaks-docs-secrets.md
│   ├── PR09-gitleaks-scripts-secrets.md
│   └── PR10-gitleaks-artifacts-cleanup.md
└── tasks.md             # Phase 2 output (NOT created by /speckit.plan)
```

### Source Code (repository root)

```text
# Nx Monorepo — Files Affected by This Plan
apps/
├── admin/
│   ├── package.json                          # PR01: Next.js upgrade
│   └── src/app/
│       ├── (app)/api/unified/route.ts        # PR05: CC=246 (most complex)
│       ├── (app)/api/plans/route.ts          # PR05: CC=48
│       ├── (app)/api/plan-details/[planId]/route.ts  # PR05: CC=48,41,38
│       ├── (app)/api/questions/route.ts      # PR05: CC=37
│       ├── (app)/api/dashboard/stats/route.ts # PR05: CC=31
│       ├── (app)/api/plans/[id]/hierarchy/route.ts   # PR04,05
│       └── (app)/components/
│           ├── NavbarSimple.tsx               # PR06: CC=35
│           ├── PlansManager.tsx               # PR04: nested funcs
│           ├── LearningCardsManager.tsx       # PR04: nested funcs
│           └── admin-learning-cards/editors/  # PR06
├── website/
│   ├── package.json                          # PR01: Next.js upgrade
│   └── src/app/components/
│       └── ErrorBoundary.tsx                 # PR03: void operator
libs/
├── utilities/src/lib/
│   ├── markdown-question-parser.ts           # PR07: CC=71
