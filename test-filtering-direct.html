<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Guided Learning Filtering - Direct API Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .plan { border: 1px solid #ccc; margin: 10px 0; padding: 10px; border-radius: 5px; }
        .day-based { background-color: #e8f5e8; border-color: #4caf50; }
        .other { background-color: #fff3e0; border-color: #ff9800; }
        .stats { background-color: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { background-color: #ffebee; border: 1px solid #f44336; color: #c62828; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>Test Guided Learning Plan Filtering - Direct API Test</h1>
    <div id="loading">Testing API connection...</div>
    <div id="content" style="display: none;">
        <div class="stats">
            <h3>Statistics</h3>
            <p>Total plans: <span id="total-count">0</span></p>
            <p>Day-based plans: <span id="day-based-count">0</span></p>
            <p>Other plans: <span id="other-count">0</span></p>
        </div>
        
        <h3>Day-Based Plans (Should be shown on guided learning page):</h3>
        <div id="day-based-plans"></div>
        
        <h3>Other Plans (Should be hidden on guided learning page):</h3>
        <div id="other-plans"></div>
    </div>

    <script>
        async function testFiltering() {
            try {
                console.log('Testing API connection...');
                const response = await fetch('/api/guided-learning/plans');
                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('API response:', data);
                
                if (data.success) {
                    const allPlans = data.plans;
                    const dayBasedPlanIds = [
                        '1-day-plan',
                        '2-day-plan',
                        '3-day-plan',
                        '4-day-plan',
                        '5-day-plan',
                        '6-day-plan',
                        '7-day-plan',
                    ];
                    
                    const dayBasedPlans = allPlans.filter(plan => 
                        dayBasedPlanIds.includes(plan.id)
                    );
                    const otherPlans = allPlans.filter(plan => 
                        !dayBasedPlanIds.includes(plan.id)
                    );
                    
                    console.log('Filtering results:', {
                        total: allPlans.length,
                        dayBased: dayBasedPlans.length,
                        other: otherPlans.length
                    });
                    
                    // Update statistics
                    document.getElementById('total-count').textContent = allPlans.length;
                    document.getElementById('day-based-count').textContent = dayBasedPlans.length;
                    document.getElementById('other-count').textContent = otherPlans.length;
                    
                    // Display day-based plans
                    const dayBasedContainer = document.getElementById('day-based-plans');
                    dayBasedPlans.forEach(plan => {
                        const div = document.createElement('div');
                        div.className = 'plan day-based';
                        div.innerHTML = `
                            <strong>${plan.name}</strong> (${plan.id})<br>
                            Duration: ${plan.duration} day(s)<br>
                            Questions: ${plan.totalQuestions}<br>
                            Difficulty: ${plan.difficulty}
                        `;
                        dayBasedContainer.appendChild(div);
                    });
                    
                    // Display other plans
                    const otherContainer = document.getElementById('other-plans');
                    otherPlans.forEach(plan => {
                        const div = document.createElement('div');
                        div.className = 'plan other';
                        div.innerHTML = `
                            <strong>${plan.name}</strong> (${plan.id})<br>
                            Duration: ${plan.duration} day(s)<br>
                            Questions: ${plan.totalQuestions}<br>
                            Difficulty: ${plan.difficulty}
                        `;
                        otherContainer.appendChild(div);
                    });
                    
                    // Hide loading, show content
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('content').style.display = 'block';
                } else {
                    throw new Error(data.error || 'API returned success: false');
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('loading').innerHTML = `
                    <div class="error">
                        <strong>Error:</strong> ${error.message}<br>
                        <small>Check the browser console for more details.</small>
                    </div>
                `;
            }
        }
        
        // Test immediately
        testFiltering();
    </script>
</body>
</html>
